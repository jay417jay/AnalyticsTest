var TcHmi;!function(t){let e;!function(e){let s;!function(e){class s extends t.Controls.Analytics.AnalyticsControl{constructor(t,e,s){super(t,e,s),this.__linearGrad="linearGradStateChart",this.__onResized=()=>(t,e)=>{let s=super.__getScaleFactor();if(0==this.__hasLicense)return;const i=this.getRenderedWidth();null==i||i<20||(this.__elementNameAlias.css("padding-bottom",5*s),this.__showReset?this.__elementNameAlias.css("padding-right","16px"):this.__elementNameAlias.css("padding-right","5px"),this.__elementSvg.css("padding-bottom",5*s),this.__elementSvg.css("width",i-20),this.__elementSvg.css("height",120*s),this.__elementSvg.css("padding",0*s),!1===this.__showTitle&&this.__elementSvg.css("margin-top",15*s),this.__elementSvg[0].setAttribute("viewBox","0 0 "+i+" 120"),this.__elementSvg[0].setAttribute("width",(i-20).toString()),this.__processStateNames())}}__previnit(){super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=150,this.__defaultHeight=150,this.__elementSvg=this.__elementTemplateRoot.find(".tchmi-state-chart-svg"),this.__elementSvgDefs=this.__elementTemplateRoot.find(".tchmi-state-chart-defs"),this.__elementSvgState=this.__elementTemplateRoot.find(".tchmi-state-chart-state"),this.__elementSvgStateText1=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-1"),this.__elementSvgStateText2=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-2"),this.__elementSvgStateTextPercentage=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-percentage"))}__init(){let t=[new e.Property(this,"StateColor","State Color",e.E_DataType.SOLIDCOLOR),new e.Property(this,"OffColor","Off Color",e.E_DataType.SOLIDCOLOR)];super.setEditableProperties(t),super.__init()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}setStateAlias(e){var s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("StateAlias")),s!==this.__stateAlias&&(this.__stateAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getStateAlias"]),this.__processStateAlias(),t.EventProvider.raise(`${this.__id}.onResized`,null))}getStateAlias(){return this.__stateAlias}__processStateAlias(){this.__processStateNames()}setStateColor(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("StateColor")),s!==this.__stateColor&&(this.__stateColor=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getStateColor"]),this.__processStateColor())}getStateColor(){return this.__stateColor}__processStateColor(){this.__processColor()}setOffColor(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("OffColor")),s!==this.__offColor&&(this.__offColor=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getOffColor"]),this.__processOffColor())}getOffColor(){return this.__offColor}__processOffColor(){this.__processColor()}setShowInvalid(e){var s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("ShowInvalid")),s!==this.__showInvalid&&(this.__showInvalid=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowInvalid"]),this.__processShowInvalid())}getShowInvalid(){return this.__showInvalid}__processShowInvalid(){this.__processStateNames()}setState(e){var s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("State")),s!==this.__state&&(this.__state=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getState"]),this.__processState())}getState(){return this.__state}__processState(){this.__processColor()}setPercentages(e){var s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("Percentages")),JSON.stringify(s)!==JSON.stringify(this.__percentages)&&(this.__percentages=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getPercentages"]),this.__processPercentages())}getPercentages(){return this.__percentages}__processPercentages(){this.__processStateNames()}setStateNames(e){var s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("StateNames")),JSON.stringify(s)!==JSON.stringify(this.__stateNames)&&(this.__stateNames=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getStateNames"]),this.__processStateNames())}getStateNames(){return this.__stateNames}__processStateNames(){if(void 0!==this.__percentages&&void 0!==this.__stateNames){let i=this.__percentages;var e=[];let a=0;for(let t=0;t<i.length;t++)a+=i[t];if(100===a)e=tchmi_clone_object(i);else for(let t=0;t<i.length;t++)e.push(i[t]/a*100);if(i=t.ValueConverter.toObject(e),this.__stateNames)for(var s=this.__stateNames.length;s<i.length;s++)this.__stateNames[s]="Alias State "+(s+1);if(this.__stateNames.length>i.length)for(s=i.length;s<this.__stateNames.length;s++)i[s]=0;for(s=this.__stateNames.length;s>=0;s--)0===i[s]&&-1!==this.__stateNames[s].indexOf("Alias State")&&(i.splice(s,1),this.__stateNames.splice(s,1));void 0!==i&&void 0!==this.__stateNames&&void 0!==this.__stateAlias&&(0==i.length&&(i=[20.2,79.8]),this.getRenderedWidth()>20&&this.DrawStateChart(this.getRenderedWidth()-20,i,this.__stateNames,this.__stateAlias))}}__processColorGradient(){this.__processColor()}__processColor(){if(this.__elementSvgStateText1.css("fill",this.__fontColor),this.__elementSvgStateText2.css("fill",this.__fontColor),this.__elementSvgStateTextPercentage.css("fill",this.__fontColor),this.__elementSvgState=this.__elementTemplateRoot.find(".tchmi-state-chart-state"),void 0!==this.__stateColor&&void 0!==this.__controlColorMiddle&&void 0!==this.__offColor.color&&void 0!==this.__colorGradient){this.__elementSvgDefs[0].innerHTML="",this.CreateLinearGradient(this.hexToRgbA(this.__controlColorMiddle),this.__elementSvgDefs[0],this.__colorGradient,this.__linearGrad+this.__secureId+"GreyColor"),this.CreateLinearGradient(this.__stateColor.color,this.__elementSvgDefs[0],this.__colorGradient,this.__linearGrad+this.__secureId+"StateColor"),this.CreateLinearGradient(this.__offColor.color,this.__elementSvgDefs[0],this.__colorGradient,this.__linearGrad+this.__secureId+"OffColor"),this.CreateLinearGradient(this.__fontColor,this.__elementSvgDefs[0],this.__colorGradient,this.__linearGrad+this.__secureId+"FontColor");for(var t=0;t<4;t++)this.__elementSvgDefs[0].children[t].setAttribute("x2","0%"),this.__elementSvgDefs[0].children[t].setAttribute("y2","100%"),this.__elementSvgDefs[0].children[t].children[1].setAttribute("offset","35%")}this.__elementSvgState.css("stroke","url(#"+this.__linearGrad+this.__secureId+"FontColor)");for(t=0;t<this.__elementSvgState.length;t++)0===this.__state?this.__elementSvgState[t].setAttribute("fill","url(#"+this.__linearGrad+this.__secureId+"GreyColor)"):this.__state===t+1?this.__elementSvgState[t].setAttribute("fill","url(#"+this.__linearGrad+this.__secureId+"StateColor)"):this.__elementSvgState[t].setAttribute("fill","url(#"+this.__linearGrad+this.__secureId+"OffColor)")}DrawStateChart(t,e,s,i){for(let t=s.length;t<e.length;t++)s.push(i+" "+(t+1));for(var a=0;a<s.length;a++)s[a].includes("Alias State")&&(s[a]=s[a].replace("Alias State",i));let r=t;for(this.__elementSvgState=this.__elementTemplateRoot.find(".tchmi-state-chart-state");this.__elementSvgState.length>0;)this.__elementSvgState[0].parentNode.removeChild(this.__elementSvgState[0]),this.__elementSvgState=this.__elementTemplateRoot.find(".tchmi-state-chart-state");for(this.__elementSvgStateText1=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-1");this.__elementSvgStateText1.length>0;)this.__elementSvgStateText1[0].parentNode.removeChild(this.__elementSvgStateText1[0]),this.__elementSvgStateText1=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-1");for(this.__elementSvgStateText2=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-2");this.__elementSvgStateText2.length>0;)this.__elementSvgStateText2[0].parentNode.removeChild(this.__elementSvgStateText2[0]),this.__elementSvgStateText2=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-2");for(this.__elementSvgStateTextPercentage=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-percentage");this.__elementSvgStateTextPercentage.length>0;)this.__elementSvgStateTextPercentage[0].parentNode.removeChild(this.__elementSvgStateTextPercentage[0]),this.__elementSvgStateTextPercentage=this.__elementTemplateRoot.find(".tchmi-state-chart-state-text-percentage");for(let t=1;t<=e.length;t++){let i=(r-2)/e.length,a=120,C=(t-1)*i+3,x=.2*i+(t-1)*i+3,A=a/2-2.5,T=a-5,b=.85*i+(t-1)*i+3,w=1.05*i+(t-1)*i+3;var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.classList.add("tchmi-state-chart-state");var n="M"+C+",2 L"+x+","+A+" L"+C+","+T+" L"+b+","+T+" L"+w+","+A+" L"+b+",2 L"+C+",2 z";_.setAttribute("d",n),this.__elementSvg[0].appendChild(_);let N=14,R=s[t-1];var l=document.createElement("canvas").getContext("2d");l.font=N.toString()+"px sans-serif";let y=l.measureText(R).width;if(y<i-i/7){(m=document.createElementNS("http://www.w3.org/2000/svg","text")).classList.add("tchmi-state-chart-state-text-1","tchmi-analytics-text"),m.textContent=R,m.setAttribute("x",x-.11*i+"px"),m.setAttribute("y",.07*a+N+"px"),m.setAttribute("font-size",N+"px"),this.__elementSvg[0].appendChild(m)}else{if(y>=2*i-i/7&&y>0&&i-i/7>0)for(;y>=2*i-i/7&&N>2;)N-=.5,l.font="bold "+N.toString()+"px sans-serif",y=l.measureText(R).width;var h=12.5,o=16.5;e.length<=2&&(h=20,o=25);for(var c=R.split(" "),g=c[0],d=1;l.measureText(g+" "+c[d]).width<i-h&&d<c.length&&(g=g+" "+c[d],!((d+=1)>c.length)););var m,S="";if(d<c.length)for(S=c[d],d+=1;d<c.length&&l.measureText(S+" "+c[d]).width<i-o&&(S=S+" "+c[d],!((d+=1)>=c.length)););(m=document.createElementNS("http://www.w3.org/2000/svg","text")).classList.add("tchmi-state-chart-state-text-1","tchmi-analytics-text");var v=document.createElementNS("http://www.w3.org/2000/svg","text");v.classList.add("tchmi-state-chart-state-text-2","tchmi-analytics-text"),this.__elementSvg[0].appendChild(m),d>=c.length?(v.textContent=S,v.setAttribute("x",x-.02*i+"px"),v.setAttribute("y",.27*a+N+"px"),m.textContent=g,m.setAttribute("x",x-.11*i+"px"),m.setAttribute("y",.07*a+N+"px")):(m.textContent=R.substring(0,R.length/2+1),m.setAttribute("x",x-.11*i+"px"),m.setAttribute("y",.07*a+N+"px"),v.textContent=R.substring(R.length/2+1,R.length),v.setAttribute("x",x-.02*i+"px"),v.setAttribute("y",.27*a+N+"px")),m.setAttribute("font-size",N+"px"),v.setAttribute("font-size",N+"px"),this.__elementSvg[0].appendChild(m),this.__elementSvg[0].appendChild(v)}var u=this.getTrimmedNumberWithUnit(e[t-1],"%");let I=i;for(var f=18.5;I>=.85*(i-5);)f-=.5,l.font="bold "+f.toString()+"px sans-serif",I=l.measureText(u).width;var p=document.createElementNS("http://www.w3.org/2000/svg","text");p.classList.add("tchmi-state-chart-state-text-percentage","tchmi-analytics-text"),p.textContent=u,p.setAttribute("x",x-.07*i+"px"),p.setAttribute("y",.7*a+f+"px"),p.setAttribute("font-size",f+"px"),this.__elementSvg[0].appendChild(p)}this.__processColor()}}e.StateChart=s}(s=e.Analytics||(e.Analytics={})),e.registerEx("StateChart","TcHmi.Controls.Analytics",s.StateChart)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));