var TcHmi;!function(t){let e;!function(e){let s;!function(e){class s extends t.Controls.Analytics.AnalyticsControl{constructor(t,e,s){super(t,e,s),this.__timeRangeInMin=60,this.__onResized=()=>(t,e)=>{super.__getScaleFactor();0!=this.__hasLicense&&(this.__showReset?this.__elementNameAlias.css("padding-right","16px"):this.__elementNameAlias.css("padding-right","5px"),this.__showTitle)}}__previnit(){super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=630,this.__defaultHeight=470,this.__lastValueTimestamp=e.DCTimestruct.fromDate(new Date),this.__lineChart=t.Controls.get(this.__id+"_LineChart"),this.__elButtons=this.__elementTemplateRoot.find(".tchmi-trend-line-chart-button"),this.__elCheckboxContainer=this.__elementTemplateRoot.find(".tchmi-trend-line-chart-check-box-container"),this.__elStartTime=this.__elementTemplateRoot.find(".tchmi-trend-line-chart-start-time"),this.__elAvgTime=this.__elementTemplateRoot.find(".tchmi-trend-line-chart-avg-time"),this.__elEndTime=this.__elementTemplateRoot.find(".tchmi-trend-line-chart-end-time"),this.__elCheckboxLabels=$([]))}__init(){super.setEditableProperties([]),super.__init();for(let t=0;t<5;++t)this.addEventListener(this.__elButtons[t],"mousedown",this.__onButtonClicked(t),!1)}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}setRawData(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("RawData")),s!==this.__rawData&&(this.__rawData=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getRawData"]),this.__processRawData())}getRawData(){return this.__rawData}__processRawData(){if(null==this.__drawVariables||null==this.__drawVariables||this.__drawVariables.length!=this.__rawData.length){this.__drawVariables=[];for(let t=0;t<this.__rawData.length;++t)this.__drawVariables.push(!0);this.__elCheckboxContainer.find(".tchmi-trend-line-chart-cb").prop("checked",!0)}this.__drawCharting()}setLastValueTimestamp(s){let i=Object.assign(new e.DCTimestruct,s);null===i&&(i=Object.assign(new e.DCTimestruct,this.getAttributeDefaultValueInternal("LastValueTimestamp"))),i.getTime()!==this.__lastValueTimestamp.getTime()&&(this.__lastValueTimestamp=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getLastValueTimestamp"]),this.__processTimestamps())}getLastValueTimestamp(){return this.__lastValueTimestamp}__processLastValueTimestamp(){null!=this.__monthAlias&&this.__processTimestamps()}__processTimestamps(){if(null!=this.__monthAlias){let t=this.__lastValueTimestamp;t.isValid()?(this.__elEndTime.html(this.__lastValueTimestamp.toString()),this.__elStartTime.html(t.getClone(-1*this.__timeRangeInMin*60*1e3).toString()),this.__elAvgTime.html(t.getClone(-1*this.__timeRangeInMin*60*1e3/2).toString())):(this.__elEndTime.html(""),this.__elStartTime.html(""),this.__elStartTime.html(""))}}setCountValues(e){let s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("CountValues")),JSON.stringify(s)!==JSON.stringify(this.__countValues)&&(this.__countValues=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getCountValues"]),this.__processCountValues())}getCountValues(){return this.__countValues}__processCountValues(){this.__drawCharting()}setYAxis(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("YAxis")),s!==this.__yAxis&&(this.__yAxis=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getYAxis"]),this.__processYAxis())}getYAxis(){return this.__yAxis}__processYAxis(){this.__drawCharting()}setYMainTickSteps(e){let s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("YMainTickSteps")),s!==this.__yMainTickSteps&&(this.__yMainTickSteps=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getYMainTickSteps"]),this.__processYMainTickSteps())}getYMainTickSteps(){return this.__yMainTickSteps}__processYMainTickSteps(){this.__lineChart.setYMainTickSteps(this.__yMainTickSteps)}setShowYSubTicks(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("ShowYSubTicks")),s!==this.__showYSubTicks&&(this.__showYSubTicks=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowYSubTicks"]),this.__processShowYSubTicks())}getShowYSubTicks(){return this.__showYSubTicks}__processShowYSubTicks(){this.__lineChart.setShowYSubTicks(this.__showYSubTicks)}setYSubTickSteps(e){let s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("YSubTickSteps")),s!==this.__ySubTickSteps&&(this.__ySubTickSteps=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getYSubTickSteps"]),this.__processYSubTickSteps())}getYSubTickSteps(){return this.__ySubTickSteps}__processYSubTickSteps(){this.__lineChart.setYSubTickSteps(this.__ySubTickSteps)}setLineColors(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("LineColors")),s!==this.__lineColors&&(this.__lineColors=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getLineColors"]),this.__processLineColors())}getLineColors(){return this.__lineColors}__processLineColors(){this.__drawCharting()}setDisplayNames(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("DisplayNames")),s!==this.__displayNames&&(this.__displayNames=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDisplayNames"]),this.__processDisplayNames())}getDisplayNames(){return this.__displayNames}__processDisplayNames(){this.__drawCharting()}__processFontColor(){if(super.__processFontColor(),void 0!==this.__solidFontColor&&null!==this.__solidFontColor){this.__lineChart.setXAxisColor(this.__solidFontColor),this.__lineChart.setXLabelFontColor(this.__solidFontColor),this.__lineChart.setGridLineColor(this.__solidFontColor);const t=tchmi_clone_object(this.__lineChart.getYAxis()),e=this;t.forEach((function(t){t.axisColor=e.__solidFontColor,t.axisNameFontColor=e.__solidFontColor,t.labelFontColor=e.__solidFontColor})),this.__lineChart.setYAxis(t)}}__processColor(){if(void 0!==this.__controlColorMiddle&&null!==this.__controlColorMiddle){const t="rgba(128, 128, 128, 0.7)";this.__elButtons.hover((function(){$(this).css("background-color")!==t&&$(this).css("background-color","rgba(128, 128, 128, 0.45)")}),(function(){$(this).css("background-color")!==t&&$(this).css("background-color","rgba(128, 128, 128, 0.3)")}))}}__processLocal(){null!=this.__dayAlias&&null!=this.__daysAlias&&null!=this.__hourAlias&&null!=this.__hoursAlias&&(this.__elButtons[0].innerHTML="1 "+this.__hourAlias,this.__elButtons[1].innerHTML="12 "+this.__hoursAlias,this.__elButtons[2].innerHTML="1 "+this.__dayAlias,this.__elButtons[3].innerHTML="3 "+this.__daysAlias,this.__elButtons[4].innerHTML="7 "+this.__daysAlias)}setHourAlias(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("HourAlias")),s!==this.__hourAlias&&(this.__hourAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getHourAlias"]),this.__processHourAlias())}getHourAlias(){return this.__hourAlias}__processHourAlias(){this.__processLocal()}setHoursAlias(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("HoursAlias")),s!==this.__hoursAlias&&(this.__hoursAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getHourAlias"]),this.__processHoursAlias())}getHoursAlias(){return this.__hoursAlias}__processHoursAlias(){this.__processLocal()}setDayAlias(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("DayAlias")),s!==this.__dayAlias&&(this.__dayAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDayAlias"]),this.__processDayAlias())}getDayAlias(){return this.__dayAlias}__processDayAlias(){this.__processLocal()}setDaysAlias(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("DaysAlias")),s!==this.__daysAlias&&(this.__daysAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDaysAlias"]),this.__processDaysAlias())}getDaysAlias(){return this.__daysAlias}__processDaysAlias(){this.__processLocal()}setMonthAlias(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("MonthAlias")),s!==this.__monthAlias&&(this.__monthAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMonthAlias"]),this.__processMonthAlias())}getMonthAlias(){return this.__monthAlias}__processMonthAlias(){e.DCTimestruct.monthAlias=this.__monthAlias,this.__processTimestamps()}__drawCharting(){if(null==this.__drawVariables||null==this.__drawVariables)return;let t=1,e="min";this.__timeRangeInMin>=2879?(e="d",t=1440):this.__timeRangeInMin>119&&(e="h",t=60);const s=[],i={yAxisId:1,lineWidth:1,pointDot:!1,pointDotRadius:3,pointDotStrokeWidth:1,lineColor:{color:"rgba(71, 148, 218, 0)"},pointDotFillColor:{color:"rgba(71, 148, 218, 0)"},pointDotStrokeColor:{color:"rgba(71, 148, 218, 0)"}};void 0!==this.__rawData&&null!==this.__rawData||(this.__rawData=[[]]);const _=this.__rawData[0].length,a=_-this.__timeRangeInMin;let n;n=this.__timeRangeInMin<this.__countValues?a:_-this.__countValues;const l=[];let r=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;for(let e=0;e<this.__rawData.length;++e)if(this.__drawVariables[e]){const h=[],c=tchmi_clone_object(i);if(c.lineColor={color:this.__lineColors[e%this.__lineColors.length]},c.pointDotFillColor={color:this.__lineColors[e%this.__lineColors.length]},c.pointDotStrokeColor={color:this.__lineColors[e%this.__lineColors.length]},s.push(c),a>=0)for(let s=n;s<_;++s)h.push({x:(s+1-a)/t,y:this.__rawData[e][s]}),this.__rawData[e][s]<o&&(o=this.__rawData[e][s]),this.__rawData[e][s]>r&&(r=this.__rawData[e][s]);l.push(h)}if(null==this.__yAxis){r<o?(r=100,o=0):r-o<.1?(r+=.05,o-=.05):(0!==r&&(r+=.05*(r-o)),0!==o&&(o-=.05*(r-o)));const t=tchmi_clone_object(this.__lineChart.getYAxis());t.forEach((function(t){t.mainTickMinValue=o,t.mainTickMaxValue=r})),this.__lineChart.setYAxis(t)}else this.__lineChart.setYAxis([this.__yAxis]);const h=this.__timeRangeInMin/t;let c;if(this.__lineChart.setLineGraphDescriptions(tchmi_clone_object(s)),this.__lineChart.setXMainTickMaxValue(h),this.__lineChart.setXAxisUnit(e),this.__lineChart.setLineGraphData(l),this.__elCheckboxContainer.find(".tchmi-trend-line-chart-cb").length!==this.__rawData.length){this.__elCheckboxContainer.empty();for(let t=0;t<this.__rawData.length;++t){c=this.__displayNames.length>t&&this.__displayNames[t].length>0?this.__displayNames[t]:"Value "+(t+1),this.__elCheckboxContainer.append(`<div class="tchmi-trend-line-chart-cb-item">\n                                    <input type="checkbox" class="tchmi-trend-line-chart-cb tchmi-trend-line-chart-cb${t}" checked>\n                                    <div class="tchmi-trend-line-chart-cb-color-element" style="background-color: ${this.__lineColors[t%this.__lineColors.length]}"></div>\n                                    <label class="tchmi-trend-line-chart-cb-text tchmi-analytics-text">${c}</label>\n                                </div>`),this.__elementsText=this.__elementTemplateRoot.find(".tchmi-analytics-text"),this.__processFontColor();const e=this.__elCheckboxContainer.find(".tchmi-trend-line-chart-cb"+t),s=this;!function(t){e.click((function(){s.__drawVariables[t]=!s.__drawVariables[t],s.__drawCharting()}))}(t)}this.__elCheckboxLabels=this.__elCheckboxContainer.find(".tchmi-trend-line-chart-cb-text")}else for(let t=0;t<this.__elCheckboxLabels.length;++t)c=this.__displayNames.length>t&&this.__displayNames[t].length>0?this.__displayNames[t]:"Value "+(t+1),this.__elCheckboxLabels[t].innerHTML=c}__processSizes(){this.__elementTemplateRoot.toggleClass("tchmi-trend-line-chart-small",this.__height<this.__defaultMinHeight)}__processHeight(){super.__processHeight(),this.__processSizes()}__processDefaultMinHeight(){super.__processDefaultMinHeight(),this.__processSizes()}__onButtonClicked(t){return()=>{switch(t){case 0:this.__timeRangeInMin=60,this.__lineChart.setXMainTickSteps(3),this.__lineChart.setXSubTickSteps(2);break;case 1:this.__timeRangeInMin=720,this.__lineChart.setXMainTickSteps(3),this.__lineChart.setXSubTickSteps(5);break;case 2:this.__timeRangeInMin=1440,this.__lineChart.setXMainTickSteps(5),this.__lineChart.setXSubTickSteps(5);break;case 3:this.__timeRangeInMin=4320,this.__lineChart.setXMainTickSteps(4),this.__lineChart.setXSubTickSteps(3);break;case 4:this.__timeRangeInMin=10080,this.__lineChart.setXMainTickSteps(8),this.__lineChart.setXSubTickSteps(1)}for(let e=0;e<5;++e)e!=t&&($(this.__elButtons[e]).css("border-color","rgba(64,64,64,0)"),$(this.__elButtons[e]).css("background-color","rgba(128, 128, 128, 0.3)"));$(this.__elButtons[t]).css("border-color","rgba(64,64,64,0.5)"),$(this.__elButtons[t]).css("background-color","rgba(128, 128, 128, 0.7)"),this.__processTimestamps(),this.__drawCharting()}}}e.TrendLineChart=s}(s=e.Analytics||(e.Analytics={})),e.registerEx("TrendLineChart","TcHmi.Controls.Analytics",s.TrendLineChart)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));