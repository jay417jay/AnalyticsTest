var TcHmi;!function(t){let e;!function(e){let s;!function(e){class s extends t.Controls.Analytics.AnalyticsControl{constructor(e,s,i){super(e,s,i),this.__svgSize={width:280,height:270},this.__linearGrad="linearGradHistogram",this.YNAME_OFFSET=15,this.__onResized=()=>(t,e)=>{const s=super.__onResizedBase(t,e);if(!s.valid)return;const i=super.__getScaleFactor();if(0==this.__hasLicense)return;this.__showReset?this.__elementNameAlias.css("padding-right","16px"):this.__elementNameAlias.css("padding-right","5px"),this.__elSvgUnitButton.css("font-size",14*i),this.__elSvgUnitButton.css("width",32*i),this.__elSvgUnitButton.css("height",18*i);this.__elTemplateContainer[0].getBoundingClientRect();this.__svgSize.width=s.vpWidth,this.__svgSize.height=s.vpHeight,this.__elSvg[0].setAttribute("viewBox",`0 0 ${this.__svgSize.width} ${this.__svgSize.height}`),this.__elSvg[0].setAttribute("width",this.__svgSize.width.toString()),this.__elSvg[0].setAttribute("height",this.__svgSize.height.toString()),this.__processBins()},this.__bins2Resolved=[],this.__bins2ResolvedOld=null,this.__onResolverForBins2WatchCallback=e=>{this.__isAttached||this.__suspendObjectResolver("Bins2"),tchmi_equal(e.value,this.__bins2Resolved)||(this.__bins2Resolved=e.value||[],t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getBins2Resolved"]),this.__processBins2())}}__previnit(){super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=310,this.__defaultHeight=310,this.__elSvg=this.__elementTemplateRoot.find(".tchmi-histogram-svg"),this.__elSvgDefs=this.__elementTemplateRoot.find(".tchmi-histogram-defs"),this.__elSvgCoordinateSystem=this.__elementTemplateRoot.find(".tchmi-histogram-svg-line-coordinate-system"),this.__elUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-unit-button"),this.__elSvgYAxisLabel=$([]),this.__elSvgBin=$([]),this.__elSvgBinTooltip=$([]),this.__elSvgBinValue=$([]),this.__elSvgBinLabel=$([]),this.__addEventListeners())}__init(){const t=[new e.Property(this,"ColorGradient","Color Gradient",e.E_DataType.INTEGER),new e.Property(this,"YAxisName","Y Axis Name",e.E_DataType.STRING),new e.Property(this,"Unit","Unit",e.E_DataType.STRING),new e.Property(this,"ShowOuterBins","Show Outer Bins",e.E_DataType.BOOLEAN),new e.Property(this,"ShowValues","Show Values",e.E_DataType.BOOLEAN),new e.Property(this,"ShowColors","Show Colors",e.E_DataType.BOOLEAN),new e.Property(this,"Relative","Relative",e.E_DataType.BOOLEAN),new e.Property(this,"WriteLabelsVertical","Write Labels Vertical",e.E_DataType.BOOLEAN),new e.Property(this,"Bins2","Bin Names",e.E_DataType.STRING,{subName:"name",subDisplayName:"Name"})];super.setEditableProperties(t),super.__init()}__attach(){super.__attach(),this.__processBins()}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}setColorsHist(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("ColorsHist")),JSON.stringify(s)!==JSON.stringify(this.__colorsHist)&&(this.__colorsHist=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getColorsHist"]),this.__processColorsHist())}getColorsHist(){return this.__colorsHist}__processColorsHist(){this.__processShowColors()}setControlType(e){let s=t.ValueConverter.toString(e);null!==s?s!==this.__controlType&&(this.__controlType=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getControlType"]),this.__processControlType()):s=this.getAttributeDefaultValueInternal("ControlType")}getControlType(){return this.__controlType}__processControlType(){this.__displayNone(this.__elSvgUnitButton,"SectionTimer"!==this.__controlType)}setHistogramUnit(e){let s=t.ValueConverter.toString(e);null!==s?s!==this.__histogramUnit&&(this.__histogramUnit=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getHistogramUnit"]),this.__processBins()):s=this.getAttributeDefaultValueInternal("HistogramUnit")}getHistogramUnit(){return this.__histogramUnit}setUnit(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("Unit")),s!==this.__unit&&(this.__unit=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getUnit"]),this.__processUnit())}getUnit(){return this.__unit}__processUnit(){this.__processBins()}setYAxisName(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("YAxisName")),s!==this.__yAxisName&&(this.__yAxisName=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getYAxisName"]),this.__processYAxisName())}getYAxisName(){return this.__yAxisName}__processYAxisName(){this.__processBins(!0)}setLabels(e){let s=t.ValueConverter.toString(e);null!==s?s!==this.__labels&&(this.__labels=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getLabels"]),this.__processBins()):s=this.getAttributeDefaultValueInternal("Labels")}getLabels(){return this.__labels}__processLabels(){this.__processBins()}setBins(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("Bins")),s!==this.__bins&&(this.__bins=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getBins"]),this.__processBins())}getBins(){return this.__bins}getBinsLabel(){return this.__binsLabel}setBinsLabel(e){let s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("BinsLabel")),s!==this.__binsLabel&&(this.__binsLabel=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getBinsLabel"]),this.__processBinsLabel())}__processBinsLabel(){this.__processBins()}setBins2(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("Bins2")),this.__bins2=s;const i=this.__objectResolvers.get("Bins2");i&&(i.watchDestroyer&&i.watchDestroyer(),i.resolver.destroy());const r=new t.Symbol.ObjectResolver(s);this.__objectResolvers.set("Bins2",{resolver:r,watchCallback:this.__onResolverForBins2WatchCallback,watchDestroyer:r.watch(this.__onResolverForBins2WatchCallback)})}getBins2Resolved(){return this.__bins2Resolved}getBins2(){return this.__bins2}__processBins2(){this.__processBins()}getSectionsUpperBorders(){return this.__sectionsUpperBorders}setSectionsUpperBorders(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("SectionsUpperBorders")),s!==this.__sectionsUpperBorders&&(this.__sectionsUpperBorders=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getSectionsUpperBorders"]),this.__processBorders())}setRelative(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("Relative")),s!==this.__relative&&(this.__relative=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getRelative"]),this.__processRelative())}getRelative(){return this.__relative}__processRelative(){this.__resetGetAutoGrowValue("maxValue"),this.__processBins()}setSectionsLowerBorder(e){let s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("SectionsLowerBorder")),s!==this.__sectionsLowerBorder&&(this.__sectionsLowerBorder=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getSectionsUpperBorders"]),this.__processBorders())}getSectionsLowerBorder(){return this.__sectionsLowerBorder}__processBorders(){if(null!=this.__sectionsLowerBorder&&null!=this.__sectionsLowerBorder&&null!=this.__sectionsUpperBorders&&null!=this.__sectionsUpperBorders){this.__sectionsBorders=[],this.__sectionsBorders[0]=this.__sectionsLowerBorder;for(let t=1;t<=this.__sectionsUpperBorders.length;t++)this.__sectionsBorders[t]=this.__sectionsUpperBorders[t-1];this.__processBins()}}setShowOuterBins(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("ShowOuterBins")),s!==this.__showOuterBins&&(this.__showOuterBins=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowOuterBins"]),this.__processShowOuterBins())}getShowOuterBins(){return this.__showOuterBins}__processShowOuterBins(){this.__resetGetAutoGrowValue("maxValue"),this.__processBins(!0)}__processBins(t=!1){!this.__isAttached||null==this.__histogramUnit||null==this.__colorGradient||null==this.__sectionsBorders||null==this.__showAxis||null==this.__colorsHist||null==this.__writeLabelsVertical||null==this.__labels||null==this.__showOuterBins||null==this.__controlType||null==this.__bins&&null==this.__bins2Resolved||this.__processHistogram(t)}setShowColors(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("ShowColors")),s!==this.__showColors&&(this.__showColors=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowColors"]),this.__processShowColors())}getShowColors(){return this.__showColors}__processShowColors(){this.__showColors?this.__processBins(!0):this.__processColor()}setShowValues(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("ShowValues")),s!==this.__showValues&&(this.__showValues=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowValues"]),this.__processShowValues())}getShowValues(){return this.__showValues}__processShowValues(){1==this.__showValues?this.__elSvgBinValue.css("visibility","visible"):this.__elSvgBinValue.css("visibility","hidden")}setWriteLabelsVertical(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("WriteLabelsVertical")),s!==this.__writeLabelsVertical&&(this.__writeLabelsVertical=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getWriteLabelsVertical"]),this.__processWriteLabelsVertical())}getWriteLabelsVertical(){return this.__writeLabelsVertical}__processWriteLabelsVertical(){this.__processBins(!0)}setShowAxis(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("ShowAxis")),s!==this.__showAxis&&(this.__showAxis=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowAxis"]),this.__processShowAxis())}getShowAxis(){return this.__showAxis}__processShowAxis(){this.__processBins(!0)}__processHistogram(t=!1){const e=this.__getBinData(),s=t||this.__histogramShapeChanged();this.__drawHistogram(e.unit,this.__colorGradient,e.bins,e.binDisplayValues,e.binTooltips,e.binLabels,this.__showAxis,this.__colorsHist,this.__writeLabelsVertical,this.__labels,this.__showOuterBins,this.__controlType,s),this.__processShowValues(),this.__processColor(),this.__bins2ResolvedOld=this.__bins2Resolved}__drawHistogram(t,s,i,r,n,o,l,_,h,a,u,c,g){g&&this.__clearHistogramElements();const{drawWidth:d,drawHeight:v,xStart:p,yStart:S,yEnd:b}=this.__getHistogramParams(l),m=i.length,B=[];for(let t=0;t<m;t++){const e=this.getColors();let s=t;u||(s+=1),s<_.length&&null!=_[s].binColor?B[t]=_[s].binColor.color:B[t]=e[s%15]}const w=B,C=d/m;let A=this.__getAutoGrowValue(Math.max.apply(null,i),"maxValue");A<1&&(A=1),this.__elSvgDefs[0].innerHTML="";let f=14;for(let l=0;l<i.length;l++){let _=0;if(i.length>l&&(_=i[l]),!e.Utilities.isNumber(_))return;let a=0;0!==A&&(a=v*Math.abs(_)/A);const u=C-5,c=l*C+5;let d;w.length>l&&(d=w[l]);const b=d;let m,B,L,x,y=C/this.getTrimmedNumberWithUnit(r[l],t).length*1.6;y>14&&(y=14),y<4&&(y=0),g?(m=document.createElementNS("http://www.w3.org/2000/svg","rect"),m.classList.add("tchmi-histogram-svg-bin-rect"),this.__elSvgBin=this.__elSvgBin.add(m),B=document.createElementNS("http://www.w3.org/2000/svg","title"),this.__elSvgBinTooltip=this.__elSvgBinTooltip.add(B),m.appendChild(B),this.__elSvg[0].appendChild(m),L=document.createElementNS("http://www.w3.org/2000/svg","text"),L.classList.add("tchmi-histogram-svg-value"),L.style.fill="#000000",this.__elSvgBinValue=this.__elSvgBinValue.add(L),this.__elSvg[0].appendChild(L),x=document.createElementNS("http://www.w3.org/2000/svg","text"),x.classList.add("tchmi-histogram-svg-label"),this.__elSvgBinLabel=this.__elSvgBinLabel.add(x),this.__elSvg[0].appendChild(x)):(m=this.__elSvgBin[l],B=this.__elSvgBinTooltip[l],L=this.__elSvgBinValue[l],x=this.__elSvgBinLabel[l]),this.CreateLinearGradient(this.hexToRgbA(b),this.__elSvgDefs[0],s,this.__linearGrad+this.__secureId+l.toString()),m.setAttribute("fill","url(#"+this.__linearGrad+this.__secureId+l.toString()+")"),m.setAttribute("x",p+c+"px"),m.setAttribute("y",v-a+S+"px"),m.setAttribute("width",u+"px"),m.setAttribute("height",a+1+"px"),B.innerHTML=n[l],L.setAttribute("x",p+c+C/2-2.5+"px"),L.textContent=this.getTrimmedNumberWithUnit(r[l],t),L.setAttribute("font-size",`${y}px`),y+5<a?L.setAttribute("y",v-a+6+S+y/2+"px"):(L.setAttribute("y",v-a-3+S+"px"),L.classList.add("tchmi-histogram-svg-value-outer"),L.style.fill=this.__fontColor),x.style.fill=this.__fontColor,x.textContent=o[l];let V=f;const E=document.createElement("canvas").getContext("2d");if(E.font=e.Str.pxFont(V),x.setAttribute("x",e.Str.px(p+c+C/2-4)),x.setAttribute("y",e.Str.px(v+18+S)),!0===h){for(x.setAttribute("text-anchor","end");E.measureText(o[l]).width>40;)V-=.5,E.font=e.Str.pxFont(V);V<f&&(f=V);const t="rotate(-90,"+(p+c+C/2-V/2)+", "+(v+10+S)+")";x.setAttribute("transform",t)}else{for(x.setAttribute("text-anchor","middle");V>C-2&&V>2;)V-=.5,E.font=e.Str.pxFont(V);V<f&&(f=V)}x.setAttribute("font-size",e.Str.px(f))}if(l){const s=[];if(A<=6)for(let t=0;t<=A;t++)s.push(t);else if(A<=10)for(let t=0;t<=A;t+=2)s.push(t);else if(A<=20)for(let t=0;t<=A;t+=4)s.push(t);else{A-=A%4;const t=A/4;for(let e=0;e<=4;e++){let i=e*t;i>A&&(i=A),s.push(i)}}this.__elSvgYAxisLabel.remove(),this.__elSvgYAxisLabel=$([]);let i=30/this.__yAxisName.length*1.75;i>14&&(i=14);const r=document.createElementNS("http://www.w3.org/2000/svg","text");r.textContent=this.__yAxisName,r.classList.add("tchmi-histogram-y-axis-label"),r.style.fill=this.__fontColor,r.setAttribute("text-anchor","end"),r.setAttribute("font-size",e.Str.px(i)),r.setAttribute("x",e.Str.px(p-12)),r.setAttribute("y",e.Str.px(i)),this.__elSvg[0].appendChild(r);let n=30/s.sort((function(t,e){return e.toString().length-t.toString().length}))[0].toString().length*1.75;n>14&&(n=14);const o=s.length-1;for(let i=0;i<=o;i++){const r=s[i];0==A&&(A=1);const o=v-v*parseFloat(s[i])/A,l=document.createElementNS("http://www.w3.org/2000/svg","text");l.classList.add("tchmi-histogram-y-axis-label"),l.style.fill=this.__fontColor,l.setAttribute("text-anchor","end"),l.setAttribute("font-size",e.Str.px(n)),l.textContent="%"===t?`${r.toString()}${t}`:`${r.toString()} ${t}`,l.setAttribute("x",e.Str.px(p-12)),l.setAttribute("y",e.Str.px(o+S+n/2)),this.__elSvg[0].appendChild(l)}this.__elSvgYAxisLabel=this.__elSvg.find(".tchmi-histogram-y-axis-label")}const L="M "+p+","+(b+S)+" L"+(this.__svgSize.width-2)+","+(b+S)+" L"+(this.__svgSize.width-9)+","+(b+S-7)+" L"+(this.__svgSize.width-2)+","+(b+S)+" L"+(this.__svgSize.width-9)+","+(b+S+7);this.__elSvgCoordinateSystem[0].setAttribute("d",L);const x="M "+p+","+(b+S)+" L"+p+",2 L"+(p+7)+",9 L"+p+",2 L"+(p-7)+",9";this.__elSvgCoordinateSystem[1].setAttribute("d",x)}__clearHistogramElements(){this.__elements={binElements:[]},this.__elSvgBin.remove(),this.__elSvgBin=$([]),this.__elSvgBinTooltip.remove(),this.__elSvgBinTooltip=$([]),this.__elSvgBinValue.remove(),this.__elSvgBinValue=$([]),this.__elSvgBinLabel.remove(),this.__elSvgBinLabel=$([]),this.__elSvgYAxisLabel.remove(),this.__elSvgYAxisLabel=$([])}__getHistogramParams(t){let e,s;t?(s=65,e=this.__svgSize.width-s-15):(e=this.__svgSize.width-15,s=8);const i=.8*this.__svgSize.height-this.YNAME_OFFSET;return{drawWidth:e,drawHeight:i,xStart:s,yStart:10+this.YNAME_OFFSET,yEnd:i+2.5}}__getCalculatedBinsAndLabels(t,e,s){const n=new Array(t.length),o=new Array(t.length),l=new Array(t.length);for(let _=0;_<n.length;_++)if(s===r.SECTION_TIMER){let s=t[_],r=1;const h=60,a=60*h,u=24*a;switch(e){case i.MINUTE:r=h;break;case i.HOUR:r=a;break;case i.DAY:r=u}const c=t[_]/r;n[_]=c;const g=Math.floor(s/u);s%=u;const d=`${g}d`,v=Math.floor(s/a);s%=a;let p=v.toString();v<10&&(p=`0${p}`);const S=Math.floor(s/h);let b=S.toString();S<10&&(b=`0${S}`);const m=s%60;let B=m.toString();m<10&&(B=`0${m}`),g>0||r>=u?(l[_]=`${d} ${p}:${b}:${B}`,o[_]=`${d} ${p}:${b}`):v>0||r>=a?(l[_]=`${p}:${b}:${B}`,o[_]=`${p}:${b}`):S>0||r>=h?(l[_]=`${b}:${B}`,o[_]=`${b}:${B}`):(l[_]=B,o[_]=B)}else n[_]=t[_],l[_]=t[_],o[_]=t[_];return{newHistBins:n,binsDisplayValue:o,binsTooltip:l}}__getBinData(){let t,e;null==this.__bins?(t=this.__bins2Resolved.map(t=>t.value),e=this.__bins2Resolved.map(t=>t.name)):(t=this.__bins,e=this.__binsLabel.split(","),null==e&&(e=[])),this.__showOuterBins||(t=t.slice(1,t.length-1),e=e.slice(1,e.length-1));const s=t.some(t=>t<0),i=t.map(t=>Math.abs(t));let r;if(s?this.drawWarning("At least one bin value is negative."):this.removeWarning(),"Section"==this.__labels)r="";else if(this.__relative){r="%";const e=i.reduce((t,e)=>t+e,0);for(let s=0;s<t.length;s++)t[s]=100*t[s]/e}else r=this.__unit;let{newHistBins:o,binsDisplayValue:l,binsTooltip:_}=this.__getCalculatedBinsAndLabels(t,this.__histogramUnit,this.__controlType),h=[];for(let t=0;t<o.length;t++){let s="";switch(this.__labels){case n.VALUE:e.length>t&&(s=e[t]);break;case n.SECTION:if(e[t])s=e[t];else{const e=this.__sectionsBorders;s=this.__showOuterBins?0===t?`< ${e[0]}`:t===e.length?`>= ${e[e.length-1]}`:t>e.length?"":`[${e[t-1]}..${e[t]})`:`[${e[t]}..${e[t+1]})`}break;case n.MANUAL:default:e.length>t&&(s=e[t])}h.push(s)}return{bins:o,binLabels:h,binDisplayValues:l,binTooltips:_,unit:r,negativeValue:s}}__histogramShapeChanged(){return null===this.__bins2ResolvedOld||this.__bins2Resolved.length!=this.__bins2ResolvedOld.length}__processColorGradient(){super.__processColorGradient(),this.__processBins()}__processColor(){this.__elSvgCoordinateSystem.css("stroke",this.__fontColor);const t=this.__elementTemplateRoot.find(".tchmi-histogram-svg-value-outer");this.__elSvgUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-unit-button"),this.__elSvgYAxisLabel.css("fill",this.__fontColor),this.__elSvgBinValue.css("fill","#000000"),t.css("fill",this.__fontColor),this.__elSvgBinLabel.css("fill",this.__fontColor),this.__elSvgBin.css("stroke","none"),this.__elSvgUnitButton.css("color",this.__fontColor),0==this.__showColors&&(this.__elSvgDefs[0].innerHTML="",null!=this.__colorGradient&&null!=this.__controlColorMiddle&&this.CreateLinearGradient(this.hexToRgbA(this.__controlColorMiddle),this.__elSvgDefs[0],this.__colorGradient,this.__linearGrad+this.__secureId),this.__elSvgBin.css("fill","url(#"+this.__linearGrad+this.__secureId+")"))}__addEventListeners(){this.addEventListener(this.__elUnitButton[0],"click",()=>{this.__unitButtonClicked()})}__unitButtonClicked(){let t;switch(this.__histogramUnit){case i.SECOND:t=i.MINUTE;break;case i.MINUTE:t=i.HOUR;break;case i.HOUR:t=i.DAY;break;case i.DAY:t=i.SECOND}this.__resetGetAutoGrowValue("maxValue"),this.__elSvgUnitButton[0].innerHTML=t,this.setHistogramUnit(t),this.__processColor()}}let i,r,n;e.Histogram=s,function(t){t.SECOND="s",t.MINUTE="m",t.HOUR="h",t.DAY="d"}(i||(i={})),function(t){t.DEFAULT="Default",t.SECTION_TIMER="SectionTimer"}(r||(r={})),function(t){t.MANUAL="Manual",t.VALUE="Value",t.SECTION="Section"}(n||(n={}))}(s=e.Analytics||(e.Analytics={})),e.registerEx("Histogram","TcHmi.Controls.Analytics",s.Histogram)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));