var TcHmi;!function(e){let t;!function(t){let s;!function(t){class s extends e.Controls.Analytics.AnalyticsControl{constructor(t,s,i){super(t,s,i),this.__radialGrad="radialGradPieChart",this.controlWidth=470,this.__onResized=()=>(e,t)=>{const s=super.__getScaleFactor();0!=this.__hasLicense&&(this.__showReset?this.__elementNameAlias.css("padding-right","16px"):this.__elementNameAlias.css("padding-right","5px"),this.__elLegend.maxFontSize=12*s)},this.__onResolverForValuesWatchCallback=t=>{this.__isAttached||this.__suspendObjectResolver("Values"),tchmi_equal(t.value,this.__valuesResolved)||(this.__valuesResolved=t.value||null,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getValuesResolved"]),this.__processValues())}}__previnit(){super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=470,this.__defaultHeight=310,this.__elementSvgChart=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-chart"),this.__elementSvgCirclePaths=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-circle-path"),this.__elementSvgCircleLabel=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-text"),this.__elementSvgChartDefs=this.__elementTemplateRoot.find(".tchmi-pie-chart-defs-chart"),this.__elementSvgChartCircle=this.__elementTemplateRoot.find(".tchmi-pie-chart-circle"),this.__elementContent=this.__elementTemplateRoot.find(".tchmi-pie-chart-charting"),this.__elLegend=this.__elementTemplateRoot[0].querySelector(".tchmi-pie-chart-legend"),this.__elLegend.amountDecimals=this.__amountDecimals,this.__elLegend.initDataList(4),this.__elLegend.showBullets=!0,this.__elLegend.spaceBetween=!1,this.__elLegend.bold=!1,this.__elLegend.bulletStyle=CustomElements.MultiValue.BulletStyle.SQUARE)}__init(){const e=[new t.Property(this,"AmountDecimals","Amount Decimals",t.E_DataType.INTEGER),new t.Property(this,"ShowInvalid","Show Outer States",t.E_DataType.BOOLEAN),new t.Property(this,"Relative","Relative",t.E_DataType.BOOLEAN)];super.setEditableProperties(e),super.__init()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}getFontScaleFactor(e,t){return e/this.controlWidth>t/this.controlHeight?t/this.controlHeight:e/this.controlWidth}setValueType(t){let s=e.ValueConverter.toString(t);null!==s?s!==this.__valueType&&(this.__valueType=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getValueType"]),this.__processValueType()):s=this.getAttributeDefaultValueInternal("ValueType")}getValueType(){return this.__valueType}__processValueType(){this.__processLabels()}setLabels(t){let s=e.ValueConverter.toObject(t);null===s&&(s=this.getAttributeDefaultValueInternal("Labels")),JSON.stringify(s)!==JSON.stringify(this.__labels)&&(this.__labels=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getLabels"]),this.__processValueType())}getLabels(){return this.__labels}getLabel2ST(){return this.__label2st}setLabel2ST(t){let s=e.ValueConverter.toNumber(t);null===s&&(s=this.getAttributeDefaultValueInternal("Label2ST")),JSON.stringify(s)!==JSON.stringify(this.__label2st)&&(this.__label2st=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getLabel2ST"]),this.__processValueType())}setShowInvalid(t){let s=e.ValueConverter.toBoolean(t);null===s&&(s=this.getAttributeDefaultValueInternal("ShowInvalid")),s!==this.__showInvalid&&(this.__showInvalid=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowInvalid"]),this.__processShowInvalid())}getShowInvalid(){return this.__showInvalid}__processShowInvalid(){this.__processValueType()}setUnit(t){let s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("Unit")),s!==this.__unit&&(this.__unit=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getUnit"]),this.__processUnit())}getUnit(){return this.__unit}__processUnit(){this.__processValueType()}setRelative(t){let s=e.ValueConverter.toBoolean(t);null===s&&(s=this.getAttributeDefaultValueInternal("Relative")),s!==this.__relative&&(this.__relative=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getRelative"]),this.__processRelative())}getRelative(){return this.__relative}__processRelative(){this.__processValueType()}setValues(t){let s=e.ValueConverter.toObject(t);if(null===s&&(s=this.getAttributeDefaultValueInternal("Values")),s===this.__values)return;this.__values=s;const i=this.__objectResolvers.get("Values");i&&(i.watchDestroyer&&i.watchDestroyer(),i.resolver.destroy());const l=new e.Symbol.ObjectResolver(s);this.__objectResolvers.set("Values",{resolver:l,watchCallback:this.__onResolverForValuesWatchCallback,watchDestroyer:l.watch(this.__onResolverForValuesWatchCallback)})}getValues(){return this.__values}__processValues(){this.__processLabels()}setTimes(t){let s=e.ValueConverter.toObject(t);null===s&&(s=this.getAttributeDefaultValueInternal("Times")),s!==this.__times&&(this.__times=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getTimes"]),this.__processTimes())}getTimes(){return this.__times}__processTimes(){this.__processLabels()}setValueAlias(t){let s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("ValueAlias")),s!==this.__valueAlias&&(this.__valueAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getValueAlias"]),this.__processValueAlias())}getValueAlias(){return this.__valueAlias}__processValueAlias(){this.__processLabels()}setSectionAlias(t){let s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("SectionAlias")),s!==this.__sectionAlias&&(this.__sectionAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getSectionAlias"]),this.__processSectionAlias())}getSectionAlias(){return this.__sectionAlias}__processSectionAlias(){this.__processLabels()}setInvalidAlias(t){let s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("InvalidAlias")),s!==this.__invalidAlias&&(this.__invalidAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getInvalidAlias"]),this.__processInvalidAlias())}getInvalidAlias(){return this.__invalidAlias}__processInvalidAlias(){this.__processLabels()}__processAmountDecimals(){super.__processAmountDecimals(),this.__elLegend.amountDecimals=this.__amountDecimals}__processColorGradient(){this.__processColor()}__processColor(){this.__elementSvgChartCircle.css("fill",this.__controlColorLightPlus),this.__elementSvgChartCircle.css("stroke",this.__controlColorMiddle),this.__elLegend.fontColor=this.__fontColor,this.__processLabels()}__processLabels(){if(this.__isAttached&&null!=this.__valueType&&null!=this.__valuesResolved&&null!=this.__labels&&null!=this.__unit){let e;const t=this.__valueType;if("Times"===t)e=this.__times;else{this.__valuesResolved.some(e=>e<0)?this.drawWarning("At least one pie value is negative."):this.removeWarning(),e=this.__valuesResolved.map(e=>Math.abs(e))}let s=new Array(e.length);const i=new Array(e.length),l=new Array(e.length),a=new Array(e.length);if("Times"===t)for(let t=0;t<e.length;t++)if(-1!==e[t].toString().indexOf(":")){const i=e[t].split(":");let l=60*+i[0]*60+60*+i[1]+ +i[2];"NaN"===l.toString()&&(l=0),s[t]=l}else s[t]=e[t];else s=e;for(let e=0;e<s.length;e++){const t=this.getColors();a[e]=t[e%15],null!==this.__label2st?0===e?i[e]=`${this.__sectionAlias} ${e+1}: < ${this.__label2st}`:1===e?this.__labels.length>1?i[e]=`${this.__sectionAlias} ${e+1}: [${this.__label2st}..${this.__labels[e-1]})`:1==this.__labels.length?i[e]=`${this.__sectionAlias} ${e+1}: >= ${this.__labels[e-1]}`:i[e]=`${this.__sectionAlias} ${e+1}`:e>this.__labels.length+1?i[e]=`${this.__sectionAlias} ${e+1}`:e===s.length-1||e===this.__labels.length+2?i[e]=`${this.__sectionAlias} ${e+1}: >= ${this.__labels[e-2]}`:i[e]=`${this.__sectionAlias} ${e+1}: [${this.__labels[e-2]}..${this.__labels[e-1]})`:e<this.__labels.length?null!==this.__labels[e]&&""!==this.__labels[e]?i[e]=this.__labels[e]:i[e]="":i[e]=this.__valueAlias+" "+e.toString(),l[e]=s[e]}let _=a,n=i,r=l;this.__showInvalid||(_=_.slice(1,r.length-1),n=n.slice(1,r.length-1),r=r.slice(1,r.length-1));let h=[],o=0;for(let e=0;e<r.length;e++)"number"==typeof r[e]&&(o+=r[e]);if(1===o)h=tchmi_clone_object(r);else for(let e=0;e<r.length;e++)h.push(r[e]/o);const c=tchmi_clone_object(h);if("Times"===t)for(let e=0;e<r.length;e++){const t=r[e],s=Math.floor(t/3600),i=Math.floor((t-3600*s)/60),l=t-3600*s-60*i;let a=s.toString(),_=i.toString(),n=l.toString();s<10&&(a="0"+s),i<10&&(_="0"+i),l<10&&(n="0"+l),r[e]=a+":"+_+":"+n}null!=this.__relative&&null!=this.__valueType&&this.DrawPieChart(c,_,n,r,this.__relative,this.__valueType)}}DrawPieChart(e,s,i,l,a,_){for(this.__elementSvgCirclePaths=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-circle-path");this.__elementSvgCirclePaths.length>0;)this.__elementSvgCirclePaths[0].parentNode.removeChild(this.__elementSvgCirclePaths[0]),this.__elementSvgCirclePaths=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-circle-path");for(this.__elementSvgCircleLabel=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-text");this.__elementSvgCircleLabel.length>0;)this.__elementSvgCircleLabel[0].parentNode.removeChild(this.__elementSvgCircleLabel[0]),this.__elementSvgCircleLabel=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-text");let n=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-circle-all");for(;n.length>0;)n[0].parentNode.removeChild(n[0]),n=this.__elementTemplateRoot.find(".tchmi-pie-chart-svg-circle-all");this.__elementSvgChartDefs[0].innerHTML="";let r=0,h=0,o=0,c=0,u=0;let g=0;for(let e=0;e<l.length;e++)l[e].toString().length>g&&(g=t.Utilities.isNumber(l[e])?this.getTrimmedNumber(l[e]).length:l[e].toString().length);void 0!==this.__oldPercentage&&this.__oldPercentage.length===e.length||(this.__oldPercentage=e);this.__elLegend.style.height=["25%","50%","75%"][e.length-1]||"100%",this.__elLegend.initDataList(e.length);for(let t=0;t<e.length;t++){const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.classList.add("tchmi-pie-chart-svg-circle-path"),r=360*u,h=360*(u+e[t]),n.setAttribute("d",this.describeArc(140,140,90,r,h)+" L140 140z"),n.setAttribute("fill",s[t]),this.__elementSvgChart[0].appendChild(n),u+=e[t];const g=this.getTrimmedNumberWithUnit(100*e[t],"%"),d=(h-r)/2+r;let v=g,m=g;if(a||(v=this.getTrimmedNumberWithUnit(l[t],this.__unit,"",!0),m=this.getTrimmedNumberWithUnit(l[t],this.__unit)),e[t]>.005){let i,l;const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("fill",s[t]),n.classList.add("tchmi-pie-chart-svg-text"),e.length>10||"Times"===_&&!a?n.setAttribute("font-size","10px"):n.setAttribute("font-size","14px");const r=(d-90)*Math.PI/180;let h;i=140+90*Math.cos(r),l=140+90*Math.sin(r),h=t>0?e[t-1]:e[e.length-1],e[t]<.02&&h<.02?(i=140+90*Math.cos(r+.1*c),l=140+90*Math.sin(r+.1*c),o=c%2==0?.1:-.1,c+=1):c=0,d<90?(i*=1.05+o,l*=.95-o,n.setAttribute("text-anchor","start")):d<180?(i*=1.05+o,l*=1.15+o,n.setAttribute("text-anchor","start")):d<270?(i*=.85-o,l*=1.15+o,n.setAttribute("text-anchor","end")):(i*=.85-o,l*=.95-o,n.setAttribute("text-anchor","end")),l>270&&(l=270),l<15&&(l=15),i>250&&(i=250),i<30&&(i=30),n.textContent=m.toString(),n.setAttribute("x",i.toString()+"px"),n.setAttribute("y",l.toString()+"px"),this.__elementSvgChart[0].appendChild(n)}this.__elLegend.setData(t,{value:i[t],alias:null,bulletColor:s[t]})}const d=document.createElementNS("http://www.w3.org/2000/svg","circle");d.setAttribute("cx","140px"),d.setAttribute("cy","140px"),d.setAttribute("r","90px"),d.classList.add("tchmi-pie-chart-svg-circle-all");let v=this.__colorGradient/100;v<0&&(v*=-1),v>1&&(v=1),this.CreateRadialGradient("rgba(255,255,255,1)",this.__elementSvgChartDefs[0],this.__colorGradient,`${this.__radialGrad}_CHART_${this.__secureId}`,0,v,0),d.setAttribute("fill",`url(#${this.__radialGrad}_CHART_${this.__secureId})`),this.__elementSvgChart[0].appendChild(d)}}t.PieChart=s}(s=t.Analytics||(t.Analytics={})),t.registerEx("PieChart","TcHmi.Controls.Analytics",s.PieChart)}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));