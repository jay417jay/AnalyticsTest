var TcHmi;!function(t){let e;!function(e){let s;!function(e){class s extends t.Controls.Analytics.AnalyticsControl{constructor(e,s,i){super(e,s,i),this.__colors=[],this.__editingMode=!1,this.__maxValueFontSize=62,this.__maxValueLabelFontSize=18,this.__rectHeight=100,this.__rectCount=3,this.__valueScaleFactor=.6,this.__fontSizeValue=14,this.__resultsArray=[],this.__linearGrad="linearGradMultiValue",this.__processControlExecuting=0,this.__oldLength=0,this.controlWidth=150,this.controlHeight=310,this.__onResized=()=>(t,e)=>{super.__getScaleFactor();if(0!=this.__hasLicense){this.getRenderedHeight(),this.__elTitleArea[0].getBoundingClientRect().height,this.controlHeight,this.getRenderedWidth(),this.controlWidth;this.__resetAutoSizeValues(),this.__processControl(!1,!0)}},this.__onResolverForInputDataWatchCallback=e=>{!1===this.__isAttached&&this.__suspendObjectResolver("InputData"),tchmi_equal(e.value,this.__inputData)||(this.__inputData=e.value||null,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getInputData"]),this.__processInputData())}}__previnit(){super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=150,this.__defaultHeight=310,this.__elementRectsContainer=this.__elementTemplateRoot.find(".tchmi-multi-value-rects-container"),this.__elementRects=$([]),this.__elementTexts=$([]),this.__elementTextLabels=$([]),super.__previnit())}__init(){let t=[new e.Property(this,"AmountDecimals","Amount Decimals",e.E_DataType.NUMBER),new e.Property(this,"ShowMilliseconds","Show Milliseconds",e.E_DataType.BOOLEAN),new e.Property(this,"ControlBackgroundColorStart","Control Backgroundcolor Start",e.E_DataType.SOLIDCOLOR),new e.Property(this,"ControlBackgroundColorEnd","Control Backgroundcolor End",e.E_DataType.SOLIDCOLOR),new e.Property(this,"InputData","Input Data",e.E_DataType.STRING,{subName:"displayName",subDisplayName:"Name"})];super.setEditableProperties(t),super.__init()}__attach(){super.__attach(),this.__onResized()(void 0,void 0),this.__processControl()}__detach(){super.__detach(),cancelAnimationFrame(this.__processControlExecuting)}destroy(){this.__keepAlive||super.destroy()}setControlBackgroundColorStart(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("ControlBackgroundColorStart")),s!==this.__controlBackgroundColorStart&&(this.__controlBackgroundColorStart=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getControlBackgroundColorStart"]),this.__processControlBackgroundColorStart())}getControlBackgroundColorStart(){return this.__controlBackgroundColorStart}__processControlBackgroundColorStart(){this.__processControl(!0)}setControlBackgroundColorEnd(e){let s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("ControlBackgroundColorEnd")),s!==this.__controlBackgroundColorEnd&&(this.__controlBackgroundColorEnd=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getControlBackgroundColorEnd"]),this.__processControlBackgroundColorEnd())}getControlBackgroundColorEnd(){return this.__controlBackgroundColorEnd}__processControlBackgroundColorEnd(){this.__processControl(!0)}setControlType(e){var s=t.ValueConverter.toString(e);null!==s?s!==this.__controlType&&(this.__controlType=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getControlType"]),this.__processControl()):s=this.getAttributeDefaultValueInternal("ControlType")}getControlType(){return this.__controlType}setChannelAlias(e){var s=t.ValueConverter.toString(e);null!==s?s!==this.__channelAlias&&(this.__channelAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getChannelAlias"]),this.__processControl()):s=this.getAttributeDefaultValueInternal("ChannelAlias")}getChannelAlias(){return this.__channelAlias}setDefaultAlias(e){var s=t.ValueConverter.toString(e);null!==s?s!==this.__defaultAlias&&(this.__defaultAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDefaultAlias"]),this.__processControl()):s=this.getAttributeDefaultValueInternal("DefaultAlias")}getDefaultAlias(){return this.__defaultAlias}setNumChannels(e){var s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("NumChannels")),s!==this.__numChannels&&(this.__numChannels=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getNumChannels"]),this.__processNumChannels())}getNumChannels(){return this.__numChannels}__processNumChannels(){this.__processCurrentResult}setCurrentChannel(e){var s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("CurrentChannel")),s!==this.__currentChannel&&(this.__currentChannel=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getCurrentChannel"]),this.__processCurrentResult())}getCurrentChannel(){return this.__currentChannel}setResult(e){var s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("Result")),s!==this.__result&&(this.__result=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getResult"]),this.__processCurrentResult())}getResult(){return this.__result}setDefaultValue(e){var s=t.ValueConverter.toNumber(e);null===s&&(s=this.getAttributeDefaultValueInternal("DefaultValue")),s!==this.__defaultValue&&(this.__defaultValue=s,t.EventProvider.raise(this.__id+".onFunctionDefaultValueChanged",["getDefaultValue"]),this.__processCurrentResult())}getDefaultValue(){return this.__defaultValue}__processCurrentResult(){if(null!=this.__defaultValue&&null!=this.__numChannels&&null!=this.__result){for(;this.__resultsArray.length<=this.__numChannels;)this.__resultsArray.push("");this.__resultsArray[this.__numChannels]=this.__defaultValue.toString(),null==this.__currentChannel?this.__currentChannel=this.__numChannels:this.__currentChannel<this.__numChannels?this.__resultsArray[this.__currentChannel]=this.__result.toString():this.__currentChannel=0,this.__processControl()}}setInputData(e){var s=t.ValueConverter.toObject(e);null===s&&(s=this.getAttributeDefaultValueInternal("InputData"));let i=this.__objectResolvers.get("InputData");i&&(i.watchDestroyer&&i.watchDestroyer(),i.resolver.destroy());let l=new t.Symbol.ObjectResolver(s);this.__objectResolvers.set("InputData",{resolver:l,watchCallback:this.__onResolverForInputDataWatchCallback,watchDestroyer:l.watch(this.__onResolverForInputDataWatchCallback)})}getInputData(){return this.__inputData}__processInputData(){this.__processControl()}setMonthAlias(e){var s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("MonthAlias")),s!==this.__monthAlias&&(this.__monthAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMonthAlias"]),this.__processMonthAlias())}getMonthAlias(){return this.__monthAlias}__processMonthAlias(){e.DCTimestruct.monthAlias=this.__monthAlias,this.__processControl()}setShowMilliseconds(e){let s=t.ValueConverter.toBoolean(e);null===s&&(s=this.getAttributeDefaultValueInternal("ShowMilliseconds")),s!==this.__showMilliseconds&&(this.__showMilliseconds=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowMilliseconds"]),this.__processShowMilliseconds())}getShowMilliseconds(){return this.__showMilliseconds}__processShowMilliseconds(){this.__processControl()}setDayAlias(e){var s=t.ValueConverter.toString(e);null===s&&(s=this.getAttributeDefaultValueInternal("DayAlias")),s!==this.__dayAlias&&(this.__dayAlias=s,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDayAlias"]),this.__processDayAlias())}getDayAlias(){return this.__dayAlias}__processDayAlias(){}__processControl(t=!1,e=!1){0===this.__processControlExecuting&&(this.__processControlExecuting=requestAnimationFrame(()=>{this.__processControlExecuting=0,this.__processControlDirectly(t,e)}))}__processControlDirectly(t,e=!1){if(!this.__isAttached||null==this.__inputData||this.__editingMode)return;let s;s=this.__isDarkTheme?this.GetColorGradientLighter(this.__controlBackgroundColorStart.color,-40):this.__controlBackgroundColorStart.color,this.__element.css("background-color",s),this.__element.css("background-image","");let i=0;i="Arraytype"==this.__controlType?this.__inputData.length:this.__numChannels+1,(this.__oldLength!==i||t)&&(this.__oldLength=i,this.__redraw(),setTimeout(()=>{this.__updateValues(t||e)},10)),this.__updateValues(t||e)}__redraw(){const t=this.__oldLength;this.__resetAutoSizeValues();var e=this.__controlBackgroundColorStart.color,s=this.__controlBackgroundColorEnd.color;for(this.__isDarkTheme&&(e=this.GetColorGradientLighter(this.__controlBackgroundColorStart.color,-40),s=this.GetColorGradientLighter(this.__controlBackgroundColorEnd.color,-40)),this.__colors=this.generateColor(e,s,t);this.__elementRects.length>0;)this.__elementRects[0].parentNode.removeChild(this.__elementRects[0]),this.__elementRects=this.__elementTemplateRoot.find(".tchmi-multi-value-rect");for(;this.__elementTexts.length>0;)this.__elementTexts[0].parentNode.removeChild(this.__elementTexts[0]),this.__elementTexts=this.__elementTemplateRoot.find(".tchmi-multi-value-text");for(;this.__elementTextLabels.length>0;)this.__elementTextLabels[0].parentNode.removeChild(this.__elementTextLabels[0]),this.__elementTextLabels=this.__elementTemplateRoot.find(".tchmi-multi-value-text-label");"Arraytype"==this.__controlType?this.__rectCount=this.__inputData.length:this.__rectCount=this.__numChannels+1;const i=this.getRenderedHeight(),l=this.__elTitleArea[0].getBoundingClientRect().height;this.__rectHeight=null!=i?(i-l)/this.__rectCount:this.__defaultHeight/this.__rectCount;for(var n=0;n<t;n++){const t=document.createElement("div");t.setAttribute("class","tchmi-multi-value-rect"),t.style.height=(100/this.__rectCount).toString()+"%",this.__colors.length>n?t.style.backgroundColor=this.__colors[n]:t.style.backgroundColor=this.__colors[0],"Multiplexer"==this.__controlType&&n==this.__currentChannel&&(t.style.borderColor="rgb(239,0,0)",null!=this.__borderRadius&&0==n&&(!this.__showTitle||this.__fontsizeTitle<5)&&(t.style.borderTopLeftRadius=this.__borderRadius.topLeft.toString()+"px",t.style.borderTopRightRadius=this.__borderRadius.topLeft.toString()+"px"));const e=document.createElement("div");e.setAttribute("class","tchmi-multi-value-text-container"),t.appendChild(e);const s=document.createElement("div");s.setAttribute("class","tchmi-multi-value-text"),e.appendChild(s);const i=document.createElement("div");i.setAttribute("class","tchmi-multi-value-text-label"),t.appendChild(i),this.__elementRectsContainer[0].appendChild(t)}this.__elementRects=this.__elementTemplateRoot.find(".tchmi-multi-value-rect"),this.__elementTexts=this.__elementTemplateRoot.find(".tchmi-multi-value-text"),this.__elementTextLabels=this.__elementTemplateRoot.find(".tchmi-multi-value-text-label"),this.__processColor()}__updateValues(s){const i=this.__oldLength;for(var l=0;l<i;l++){if(!s&&null!=this.__oldInputData&&this.__oldInputData.length>l&&this.__oldInputData[l].displayName==this.__inputData[l].displayName&&this.__oldInputData[l].sValue==this.__inputData[l].sValue)continue;const i=this.__elementRectsContainer[0].children.item(l),n=i.querySelector(".tchmi-multi-value-text-container"),o=n.querySelector(".tchmi-multi-value-text"),r=i.querySelector(".tchmi-multi-value-text-label"),_=this,a=l.toString();"Arraytype"==this.__controlType?null!=this.__inputData[l].sValue?e.Utilities.isSymbol(this.__inputData[l].sValue)?t.Symbol.readEx2(this.__inputData[l].sValue,(function(e){if(e.error===t.Errors.NONE){var s=e.value;o.textContent=_.getFormattedString(s,_.__monthAlias,_.__dayAlias,_.__showMilliseconds,a)}else o.textContent=""})):o.textContent=this.getFormattedString(this.__inputData[l].sValue,this.__monthAlias,this.__dayAlias,this.__showMilliseconds,a):o.textContent="":o.textContent=this.getFormattedString(this.__resultsArray[l],this.__monthAlias,this.__dayAlias,this.__showMilliseconds,a),this.__fontSizeValue=this.__rectHeight*this.__valueScaleFactor,this.__fontSizeValue>this.__maxValueFontSize&&(this.__fontSizeValue=this.__maxValueFontSize),o.innerHTML=o.textContent.split(",").join(", ");const h=o.textContent;let u=!1;if(isNaN(h)||isNaN(parseFloat(h))||(u=!0),this.__autoSize(n,o,"fontSize",{namespace:`value${l}`}),"Arraytype"==this.__controlType)if(void 0!==this.__inputData[l].displayName&&null!==this.__inputData[l].displayName)if(this.__inputData[l].displayName.startsWith("%")){let e=t.Symbol.readEx(this.__inputData[l].displayName);r.textContent=this.getFormattedString(e,this.__monthAlias,this.__dayAlias,this.__showMilliseconds,a)}else r.textContent=this.getFormattedString(this.__inputData[l].displayName,this.__monthAlias,this.__dayAlias,this.__showMilliseconds,a);else r.textContent="";else l==this.__numChannels?r.textContent=this.__defaultAlias:r.textContent=this.__channelAlias+" "+l;let c=this.__fontsizeTitle;c>this.__maxValueLabelFontSize&&(c=this.__maxValueLabelFontSize),c=this.__autoSize(i,r,"fontSize",{namespace:"label",max:c}),this.__fontSizeLabel=c}this.__oldInputData=this.__inputData}__processAmountDecimals(){super.__processAmountDecimals(),this.__processControl()}__processColorGradient(){this.__processColor()}__processColor(){this.__elementTexts.css("color",this.__fontColor),this.__elementTextLabels.css("color",this.__fontColor),void 0!==this.__colorGradient&&(0!==this.__colorGradient?this.__elementTexts.css("text-shadow",this.__controlColorDark+" -3px 3px 3px"):this.__elementTexts.css("text-shadow","none"))}__processBorderRadius(){super.__processBorderRadius(),null!=this.__borderRadius&&(this.__elTemplateContainer.css("border-bottom-left-radius",this.__borderRadius.bottomLeft),this.__elTemplateContainer.css("border-bottom-right-radius",this.__borderRadius.bottomRight))}__resetAutoSizeValues(){if(null!=this.__inputData)for(let t=0;t<this.__inputData.length;t++)this.__resetAutoSize(`value${t}`);this.__resetAutoSize("label")}}e.MultiValueControl=s}(s=e.Analytics||(e.Analytics={})),e.registerEx("MultiValueControl","TcHmi.Controls.Analytics",s.MultiValueControl)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));