var TcHmi;!function(e){!function(e){!function(e){class t extends e.TimeCompareGridBasedChart{constructor(e,t,i){super(e,t,i),this.__timeDifferencesInTc=[],this.__options=i}createInitChart(){this.__preCreateInitChart(),this.__options.compareType=e.ECompareChartCompareTypes.RELATIVE_TIME,this.__options.compareInterval={rangeValue:1,rangeUnit:e.TimeIntervalStrings.Second_s},this.__options.barIntervalWidth={rangeValue:1,rangeUnit:e.TimeIntervalStrings.Second_s},this.createChart(this.__initData),this.__postCreateInitChart()}createChart(t){this.__preCreateChart(t),this.__channelValues=[],this.__intervalSizes=this.__options.timeranges.map(t=>e.TimeConverter.getToTcTime(t,this.__props.dataRequestTime,this.__options.compareInterval)-e.TimeConverter.getFromTcTime(t,this.__props.dataRequestTime)),this.__maxIntervalSize=Math.max(...this.__intervalSizes),this.__options.compareType==e.ECompareChartCompareTypes.ABSOLUTE_TIME?this.__numberOfXAxes=Math.round(this.__options.timeranges.length*new Set(this.__options.channelConfigurations.map(e=>e.sourceID)).size/2):this.__numberOfXAxes=1,this.__createYAxes(),this.__createTimeSeriesBarChart(t),this.__channelValues.sort((e,t)=>e.offsetLeft<t.offsetLeft?1:-1),this.__postCreateChart()}__getChannelWidth(e,t,i){return(i.x-t.x)/(e.numberOfBars*this.__getVisibleChannels()+e.numberOfBars+1)}__getVisibleChannels(){let t=0;const i=e.ChannelConfigHelper.ExtractFrom_I_SE_ChannelEntry(this.__options.channelConfigurations);for(let s=0;s<this.__options.timeranges.length;s++)if(this.__options.timeranges[s].isVisible)for(const n of i)n.visibility.length>=s&&n.visibility[s]&&n.sourceID!=e.Guid.EMPTY_GUID&&t++;return t}__createTimeSeriesBarChart(t){var i;const s=e.AlyMath.max(this.__yAxes.map(e=>e.left+e.width))+this.__props.defaultAxisMargin;let n=1==this.__yAxes.length&&1==this.__numberOfXAxes?this.__yAxes[0].top:this.elParent.clientHeight;n+=this.__props.defaultAxisMargin;let a=new e.Point(s,n),_=new e.Point(this.elParent.clientWidth-this.__props.svgChartBorderdistance-this.__yAxes[0].width,n);const r=this.__getBarDefinition(),o=this.__getChannelWidth(r,a,_);if(this.__options.compareType==e.ECompareChartCompareTypes.MATCHING_START||this.__options.compareType==e.ECompareChartCompareTypes.MATCHING_END){const t=new e.XIntervalAxis(this.elParent,this.__props,this.__options);this.__xAxes.push(t),t.drawBarAxis(a,_,Math.max(...this.__intervalSizes),o,!0,r,this.__getVisibleChannels(),!1,this.__options.compareInterval)}else{let t=(1==this.__yAxes.length&&this.__numberOfXAxes,this.__yAxes[0].top);t+=this.__props.defaultAxisMargin,a=new e.Point(s,t),_=new e.Point(this.elParent.clientWidth-this.__props.svgChartBorderdistance-this.__yAxes[0].width,t);const i=new e.XIntervalAxis(this.elParent,this.__props,this.__options);this.__xAxes.push(i),i.drawBarAxis(a,_,Math.max(...this.__intervalSizes),o,!1,r,this.__getVisibleChannels(),!0,this.__options.compareInterval)}this.__createChartBackground();let h=a.x;for(let s=0;s<r.numberOfBars;s++){const n=this.__createBarSession();n.offsetLeft=h;let a=0;for(const _ of this.__options.timeranges){const r=0;if(!_.isVisible){a+=t.symbols.length;continue}let l=[];for(let m=0;m<t.symbols.length;m++){let p=t.data.map(e=>Object.assign(Object.assign({},e),{values:[e.values[m]]}));if(!1===this.__options.channelConfigurations[a].isVisible){a++;continue}if(p=null===(i=this.__channelDataValues.find(e=>e.barSetIndex==s&&e.timerange==_&&e.channelConfig==this.__options.channelConfigurations[a]))||void 0===i?void 0:i.channelData,null==p){a++;continue}h+=o,l.push(...p);const c=new e.BarChannel(t.symbols[m],this.__elChartBackground,this.__props,o,h,-this.__yAxes[r].stepDistance,this.__yAxes[r].nullpoint,this.__options.channelConfigurations[a],this.__options);if(c.drawChannel(p),n.channels.push(c),a++,this.__channels.push(c),-1==n.data.findIndex(e=>e.timestamp==l[l.length-1].timestamp)){const e={timestamp:l[l.length-1].timestamp,values:[]};n.data.push(e)}n.data.find(e=>e.timestamp==l[l.length-1].timestamp).values[m]=l[l.length-1].values[0]}}this.__channelValues.push(n),h+=o}if(this.__options.compareType==e.ECompareChartCompareTypes.ABSOLUTE_TIME){const t=this.__xAxes[0].axisLabels[0].y,i=this.__xAxes[0].axisLabels[0].height;this.__xAxes[0].cleanLabels(!1);for(let s=0;s<this.__options.timeranges.length;s++){const n=this.__options.timeranges[s],a=this.__channelDataValues.filter(e=>e.timerange==n),_=a.reduce((e,t)=>(t.barSetIndex<e[0].barSetIndex&&(e[0]=t),t.barSetIndex>e[1].barSetIndex&&(e[1]=t),e),[a[0],a[0]]),r=this.__xAxes[0].axisTicks;for(const n of _){const a=new e.SVGText(r[n.barSetIndex].x1,t+s*i,new e.SPTime(n.channelData[0].timestamp).toString(e.E_TimeFormat.yyyy_mm_dd_hh_mm_ss_mmm),["tchmi-analytics-charting-axis-label-text"]);a.appendTo(this.elParent),a.x-=a.width/2,this.__xAxes[0].axisLabels.push(a)}}}}__getTimeFormatForLabels(t){switch(t){case e.TimeIntervalStrings.MilliSecond_s:case e.TimeIntervalStrings.Second_s:return e.E_TimeFormat.yyyy_mm_dd_hh_mm_ss_mmm;case e.TimeIntervalStrings.Minute_s:return e.E_TimeFormat.yyyy_mm_dd_hh_mm_ss;case e.TimeIntervalStrings.Hour_s:return e.E_TimeFormat.yyyy_mm_dd_hh_mm;case e.TimeIntervalStrings.Day_s:return e.E_TimeFormat.yyyy_mm_dd;case e.TimeIntervalStrings.Week_s:return e.E_TimeFormat.day_month_date_year_full;case e.TimeIntervalStrings.Month_s:case e.TimeIntervalStrings.Year_s:return e.E_TimeFormat.yyyy_mm_dd;default:return e.E_TimeFormat.yy_mm}}__createBarSession(){const e={channels:[],data:[]};return e}getValues(t,i){this.__channelValues.forEach(e=>e.channels.forEach(e=>e.elBars.forEach(e=>e.fillOpacity=1)));for(const s of this.__channelValues)if(s.offsetLeft<=t){let n=null,a=-1;for(let _=0;_<s.channels.length;_++){const r=s.channels[_],o=r.elBars[0];if(null==o)continue;o.x<=t&&t<=o.x+o.width&&o.y<=i&&i<=o.y+o.height&&(o.fillOpacity=.7,n=r.symbol,a=r.channelData[0].timestamp);const h=o.y>=this.__yAxes[0].nullpoint?o.height:0;let l=new e.SVGCircle(o.x+o.width/2,o.y+h+this.__options.hoverPointRadius/2,this.__options.hoverPointRadius,["tchmi-analytics-charting-hover-circle"]);l.appendTo(this.__elChartBackground),l.fill=o.fill,l.stroke="black",this.__hoverPoints.push(l)}const _=s.data.map(e=>Object.assign(Object.assign({},e),{hoverChannel:null}));return-1!=a&&null!=n&&(_.find(e=>e.timestamp==a).hoverChannel=n),_}return null}__createChannelValues(){this.__timeDifferencesInTc=[],this.__channelDataValues=[],this.__options.compareType==e.ECompareChartCompareTypes.ABSOLUTE_TIME||this.__options.compareType==e.ECompareChartCompareTypes.RELATIVE_TIME?this.__createChannelValuesAbsolutRelativ(this.__options.data):this.__createChannelValuesCombined(this.__options.data),this.__channelDataValues=this.__channelDataValues}__createChannelValuesCombined(t){const i=this.__getBarDefinition();for(let t=0;t<this.__options.timeranges.length;t++){if(!this.__options.timeranges[t].isVisible){this.__timeDifferencesInTc.push(0);continue}const i=e.TimeDiffHelper.calculateTimeDiffMs(this.__options.timeranges[t],this.__options.compareInterval.rangeUnit,this.__options.timeranges[0],this.__options.compareType,this.__options.compareInterval,this.__props.dataRequestTime)*e.SPTime.TIME_IN_MS_TO_TC_FACTOR;this.__timeDifferencesInTc.push(i)}this.__channelDataValues=[];const s=i.barTimerangeMs;for(let n=0;n<i.numberOfBars;n++){let a="",_=0;for(let r=0;r<this.__options.timeranges.length;r++){const o=n*i.barTimerangeMs*e.SPTime.TIME_IN_MS_TO_TC_FACTOR,h=new e.SPTime(e.TimeConverter.getFromTcTime(this.__options.timeranges[0],this.__props.dataRequestTime)+o).date,l=e.TimeConverter.getFromTcTime(this.__options.timeranges[r],this.__props.dataRequestTime),m=e.TimeConverter.getToTcTime(this.__options.timeranges[r],this.__props.dataRequestTime,this.__options.compareInterval);let p=e.SPTime.convertTimeMsToTcTime(h.getTime(),this.__props.dataRequestTime)+this.__timeDifferencesInTc[r],c=e.SPTime.convertTimeMsToTcTime(h.getTime()+s,this.__props.dataRequestTime)+this.__timeDifferencesInTc[r];if(0==r&&(a=new e.SPTime(c-1e3).dayInText),this.__options.timeranges[r].isVisible)if(c>e.TimeConverter.getToTcTime(this.__options.timeranges[r],this.__props.dataRequestTime,this.__options.compareInterval))_+=t.symbols.length;else for(let i=0;i<t.symbols.length;i++){let s=t.data.map(e=>Object.assign(Object.assign({},e),{values:[e.values[i]]}));if(s=s.filter(e=>null!=e.values[0]),!1===this.__options.channelConfigurations[_].isVisible){_++;continue}if(s=s.filter(e=>e.timestamp<m&&e.timestamp>=l),s=s.filter(e=>e.timestamp<c&&e.timestamp>=p),0==s.length){_++;continue}if(this.__options.compareInterval.rangeUnit==e.TimeIntervalStrings.Week_s&&new e.SPTime(s[s.length-1].timestamp).dayInText!=a){_++;continue}const o=s[s.length-1];if(this.__options.showDifferentials){const e=s[0];o.values[0]=o.values[0]-e.values[0]}const h={};h.barSetIndex=n,h.timerange=this.__options.timeranges[r],h.channelConfig=this.__options.channelConfigurations[_],h.channelData=[o],this.__channelDataValues.push(h),_++}else _+=t.symbols.length}}}__createChannelValuesAbsolutRelativ(t){const i=this.__getBarDefinition();this.__channelDataValues=[];for(let s=0;s<i.numberOfBars;s++){let n=0;for(let a=0;a<this.__options.timeranges.length;a++){if(!this.__options.timeranges[a].isVisible){n+=t.symbols.length;continue}const _=e.TimeConverter.getFromTcTime(this.__options.timeranges[a],this.__props.dataRequestTime)+s*i.barTimerangeMs*e.SPTime.TIME_IN_MS_TO_TC_FACTOR,r=e.TimeConverter.getFromTcTime(this.__options.timeranges[a],this.__props.dataRequestTime)+(s+1)*i.barTimerangeMs*e.SPTime.TIME_IN_MS_TO_TC_FACTOR;if(r>e.TimeConverter.getToTcTime(this.__options.timeranges[a],this.__props.dataRequestTime,this.__options.compareInterval))n+=t.symbols.length;else for(let e=0;e<t.symbols.length;e++){let i=t.data.map(t=>Object.assign(Object.assign({},t),{values:[t.values[e]]}));if(!1===this.__options.channelConfigurations[n].isVisible){n++;continue}if(i=i.filter(e=>e.timestamp<r&&e.timestamp>=_&&null!=e.values[0]),0==i.length){n++;continue}const o=i[i.length-1];if(this.__options.showDifferentials){const e=i[0];o.values[0]=o.values[0]-e.values[0]}const h={};h.barSetIndex=s,h.timerange=this.__options.timeranges[a],h.channelConfig=this.__options.channelConfigurations[n],h.channelData=[o],this.__channelDataValues.push(h),n++}}}}__getBarDefinition(){return i.getBarDefinition(this.__options.barIntervalWidth,this.__options.compareInterval)}}let i;e.TimeSeriesBarchart=t,function(t){t.getBarDefinition=function(t,i){const s={};s.pseudoRangeUnit=t.rangeUnit,s.barTimerangeMs=e.TimeInterval.ConvertToMs(t.rangeValue,t.rangeUnit);const n=e.TimeInterval.ConvertToMs(i.rangeValue,i.rangeUnit);return s.numberOfBars=Math.ceil(n/s.barTimerangeMs),s}}(i=e.BarIntervalWidthHelper||(e.BarIntervalWidthHelper={}))}(e.Analytics||(e.Analytics={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));