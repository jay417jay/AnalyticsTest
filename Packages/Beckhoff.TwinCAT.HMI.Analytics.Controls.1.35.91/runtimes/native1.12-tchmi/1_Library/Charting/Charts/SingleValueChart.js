var TcHmi;!function(e){!function(e){!function(e){class t extends e.BaseChart{constructor(e,t,s){super(e,t,s),this.__elValues=[],this.__elVariableLabels=[],this.__elTimestampLabels=[],this.__timerangeEdgeLength=0,this.__channelEdgeLength=0,this.__options=s}clearChart(){}createInitChart(){this.__preCreateInitChart(),this.createChart(this.__initData),this.__postCreateInitChart(),this.__elTimestampLabels.forEach(e=>{e.removeFromParent()}),this.__elTimestampLabels=[],this.__elVariableLabels.forEach(e=>{e.removeFromParent()}),this.__elVariableLabels=[]}createChart(t){if(this.__channelValues=[],this.__preCreateChart(t),null==this.__options.timeranges||0==this.__options.timeranges.length)return void console.error("No timerange added to bar chart");this.__createChartBackground();const s=this.__options.channelConfigurations.filter(e=>!e.isVisible).length,i=this.__options.timeranges.filter(e=>!e.isVisible).length,n=e.GridCreator.calculateGrid(this.__options.timeranges.length-i,this.__props.svgWidth,this.__props.svgHeight);this.__timerangeEdgeLength=Math.min(this.__props.svgWidth/n.columns,this.__props.svgHeight/n.rows);const a=e.GridCreator.calculateGrid(this.__options.channelConfigurations.length-s,this.__timerangeEdgeLength,this.__timerangeEdgeLength);this.__channelEdgeLength=Math.min(this.__timerangeEdgeLength/a.columns,this.__timerangeEdgeLength/a.rows);let h=0;for(let s=0;s<this.__options.timeranges.length;s++){const i=this.__options.timeranges[s];if(!i.isVisible)continue;const l=e.GridCreator.calcRowAndColumn(h,n.columns),o=this.__timerangeEdgeLength*(l.columns-.5);h++,this.__createBackgroundRectangle((l.columns-1)*this.__timerangeEdgeLength+2,(l.rows-1)*this.__timerangeEdgeLength+2,this.__timerangeEdgeLength-4,this.__timerangeEdgeLength-4);const _=e.TimeConverter.getFromTcTime(i,this.__props.dataRequestTime),r=e.TimeConverter.getToTcTime(i,this.__props.dataRequestTime),g=t.data.filter(e=>e.timestamp<=r&&e.timestamp>=_);if(null==g||0===g.length)continue;const c={};c.offsetLeft=(l.columns-.5)*this.__timerangeEdgeLength,c.offsetTop=(l.rows-.5)*this.__timerangeEdgeLength,c.channels=[],c.data=[];let m=0;for(let t=0;t<this.__options.channelConfigurations.length;t++)if(this.__options.channelConfigurations[t].isVisible){let s=g.map(e=>Object.assign(Object.assign({},e),{values:[e.values[t]]}));if(0==s.length)continue;const i=e.GridCreator.calcRowAndColumn(t-m,a.columns),n=(l.columns-1)*this.__timerangeEdgeLength+this.__channelEdgeLength*(i.columns-1),h=(l.rows-1)*this.__timerangeEdgeLength+this.__channelEdgeLength*(i.rows-1),o=s[s.length-1].values[0],_=new e.SVGText(n,h,e.Utilities.getTrimmedValueString(o));_.appendTo(this.elParent),_.fill=this.__options.channelConfigurations[t].varColor,this.__elValues.push(_);const r=new e.SVGText(n,h+_.height,this.__options.channelConfigurations[t].name);r.appendTo(this.elParent),r.fill=this.__options.channelConfigurations[t].varColor,r.opacity=".7",this.__elVariableLabels.push(r)}else m++;const p=t.data.filter(e=>e.timestamp<=r&&e.timestamp>=_);if(p.length>0){const t=p[p.length-1];c.data.push(t),this.__channelValues.push(c);const s=this.__timerangeEdgeLength*l.rows,i=new e.SVGText(o,s,new e.SPTime(t.timestamp).toString(e.E_TimeFormat.yyyy_mm_dd_hh_mm_ss_mmm),["tchmi-analytics-charting-axis-label-text"]);i.appendTo(this.elParent),i.x-=i.width/2,i.y-=i.height,this.__elTimestampLabels.push(i)}}let l=e.AlyMath.max(this.__elValues.map(e=>e.width)),o=e.AlyMath.max(this.__elValues.map(e=>e.height));for(;0!=l&&l<=this.__channelEdgeLength-10;)this.__elValues.forEach(e=>e.fontSize=e.fontSize+1),l=e.AlyMath.max(this.__elValues.map(e=>e.width));this.__elValues.forEach(e=>e.y+=e.height/2+o/2),this.__elValues.forEach(e=>e.x+=l-e.width),this.__elTimestampLabels.forEach(e=>e.x+=l-e.width),this.__channelValues.sort((e,t)=>e.offsetLeft<t.offsetLeft?1:-1);const _=this.__elValues.length>0?this.__elValues[0].height:0;this.__elVariableLabels.forEach(e=>e.y+=_/2+o/2);for(const e of this.__elVariableLabels){let t=!1;for(;""!=e.content&&e.width>this.__channelEdgeLength;)e.content=e.content.slice(0,-1),t=!0;t&&(e.content=`${e.content.slice(0,-3)}...`)}const r=new e.Point(0,0),g=new e.Point(this.__props.svgWidth,this.__props.svgHeight);this.__postCreateChart(r,g)}cleanElement(){super.cleanElement(),this.__elTimestampLabels.forEach(e=>{e.removeFromParent()}),this.__elTimestampLabels=[],this.__elVariableLabels.forEach(e=>{e.removeFromParent()}),this.__elVariableLabels=[],this.__elValues.forEach(e=>{e.removeFromParent()}),this.__elValues=[]}getValues(e,t){let s=Number.MAX_VALUE,i=null;for(const n of this.__channelValues){const a=Math.sqrt(Math.pow(e-n.offsetLeft,2)+Math.pow(t-n.offsetTop,2));a<s&&(s=a,i=n)}if(null!=i){const s=e-(i.offsetLeft-.5*this.__timerangeEdgeLength),n=t-(i.offsetTop-.5*this.__timerangeEdgeLength),a=Math.floor(s/this.__channelEdgeLength),h=Math.floor(n/this.__channelEdgeLength),l=this.__timerangeEdgeLength/this.__channelEdgeLength*h+a,o=this.__options.channelConfigurations.filter(e=>e.isVisible);let _=null;return l<o.length&&(_=this.__options.data.symbols[l]),i.data.map(e=>Object.assign(Object.assign({},e),{hoverChannel:_}))}return[]}}e.SingleValueChart=t}(e.Analytics||(e.Analytics={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));