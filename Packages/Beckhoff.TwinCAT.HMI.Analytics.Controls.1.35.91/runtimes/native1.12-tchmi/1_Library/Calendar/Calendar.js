var TcHmi;!function(e){let t;!function(t){let i;!function(t){class i extends e.Controls.System.TcHmiControl{constructor(e,i,s){super(e,i,s),this.__selectedCellColor=t.AnalyticsControl.MEA_BLUE,this.__cellRangeColor="lightskyblue",this.__cellColor="transparent",this.__onResized=()=>()=>{document.body.clientWidth<550?this.__elModal.addClass("tchmi-analytics-calendar-modal-mobile"):this.__elModal.removeClass("tchmi-analytics-calendar-modal-mobile")}}__previnit(){super.__previnit(),this.__eventListenerManager=new t.EventListenerManager,this.__elTemplateRoot=this.__element.find(".tchmi-analytics-calendar-template"),this.__elModal=this.__elTemplateRoot,this.__elWindow=this.__elTemplateRoot.find(".tchmi-analytics-calendar-time-input-window"),this.__elTimeInput=this.__elTemplateRoot.find(".tchmi-analytics-calendar-time "),this.__elMoveUpButtons=this.__elTemplateRoot.find(".tchmi-analytics-calendar-count-up-button"),this.__elMoveDownButtons=this.__elTemplateRoot.find(".tchmi-analytics-calendar-count-down-button"),this.__elSetTimeButton=this.__elTemplateRoot.find(".tchmi-analytics-calendar-button-set-time "),this.__elCancelTimeButton=this.__elTemplateRoot.find(".tchmi-analytics-calendar-button-cancel-time "),this.__elLabel=this.__elTemplateRoot.find(".tchmi-analytics-calendar-label"),this.__elHead=this.__elTemplateRoot.find(".tchmi-analytics-calendar-head"),this.__elDays=this.__elTemplateRoot.find(".tchmi-analytics-calendar-day"),this.__elEntries=this.__elTemplateRoot.find(".tchmi-analytics-calendar-entry"),this.__elHeadMonth=this.__elTemplateRoot.find(".tchmi-analytics-calendar-head-month")}__init(){super.__init()}__attach(){super.__attach(),this.__eventListenerManager.addEventListener(window,"resize",this.__onResized()),this.__eventListenerManager.addEventListener(this.__elHead[0],"mousedown",this.__prevMonthClicked()),this.__eventListenerManager.addEventListener(this.__elHead[1],"mousedown",this.__nextMonthClicked()),this.__eventListenerManager.addEventListener(this.__elTimeInput[0],"input",this.__timeInputChanged(0)),this.__eventListenerManager.addEventListener(this.__elTimeInput[1],"input",this.__timeInputChanged(1)),this.__eventListenerManager.addEventListener(this.__elTimeInput[2],"input",this.__timeInputChanged(2)),this.__eventListenerManager.addEventListener(this.__elTimeInput[3],"input",this.__timeInputChanged(3)),this.__eventListenerManager.addEventListener(this.__elMoveUpButtons[0],"mousedown",this.__timeMoveUpDown(0,!0)),this.__eventListenerManager.addEventListener(this.__elMoveUpButtons[1],"mousedown",this.__timeMoveUpDown(1,!0)),this.__eventListenerManager.addEventListener(this.__elMoveUpButtons[2],"mousedown",this.__timeMoveUpDown(2,!0)),this.__eventListenerManager.addEventListener(this.__elMoveUpButtons[3],"mousedown",this.__timeMoveUpDown(3,!0)),this.__eventListenerManager.addEventListener(this.__elMoveDownButtons[0],"mousedown",this.__timeMoveUpDown(0,!1)),this.__eventListenerManager.addEventListener(this.__elMoveDownButtons[1],"mousedown",this.__timeMoveUpDown(1,!1)),this.__eventListenerManager.addEventListener(this.__elMoveDownButtons[2],"mousedown",this.__timeMoveUpDown(2,!1)),this.__eventListenerManager.addEventListener(this.__elMoveDownButtons[3],"mousedown",this.__timeMoveUpDown(3,!1)),this.__eventListenerManager.addEventListener(this.__elSetTimeButton[0],"mousedown",this.closeCalendar(!0)),this.__eventListenerManager.addEventListener(this.__elCancelTimeButton[0],"mousedown",this.closeCalendar(!1));for(let e=0;e<42;++e)this.__eventListenerManager.addEventListener(this.__elEntries[e],"mousedown",this.__cellClicked(e))}__detach(){super.__detach(),this.__eventListenerManager.removeEventListeners()}destroy(){this.__keepAlive||super.destroy()}setRecord(t){var i=t;null===i&&(i=this.getAttributeDefaultValueInternal("Record")),JSON.stringify(i)!==JSON.stringify(this.__record)&&(this.__record=i,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getRecord"]),this.__processRecord())}getRecord(){return this.__record}__processRecord(){}setFullMonthsAlias(i){var s=t.Utilities.splitLocals(i);null!==s&&12==s.length||(s=t.Utilities.splitLocals(this.getAttributeDefaultValueInternal("FullMonthsAlias"))),s!==this.__fullMonthsAlias&&(this.__fullMonthsAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getFullMonthsAlias"]),this.__processFullMonthsAlias())}getFullMonthsAlias(){return this.__fullMonthsAlias}__processFullMonthsAlias(){}setDaysOfWeekAlias(i){var s=i;null!==s&&7==s.length||(s=t.Utilities.splitLocals(this.getAttributeDefaultValueInternal("DaysOfWeekAlias"))),s!==this.__daysOfWeekAlias&&(this.__daysOfWeekAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDaysOfWeekAlias"]),this.__processDaysOfWeekAlias())}getDaysOfWeekAlias(){return this.__daysOfWeekAlias}__processDaysOfWeekAlias(){for(let e=0;e<7;++e)this.__elDays[e].innerHTML=this.__daysOfWeekAlias[e]}setStartTimeAlias(t){var i=e.ValueConverter.toString(t);null===i&&(i=this.getAttributeDefaultValueInternal("StartTimeAlias")),i!==this.__startTimeAlias&&(this.__startTimeAlias=i,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getStartTimeAlias"]),this.__processStartTimeAlias())}getStartTimeAlias(){return this.__startTimeAlias}__processStartTimeAlias(){this.__elLabel.html(this.__startTimeAlias)}setStopTimeAlias(t){var i=e.ValueConverter.toString(t);null===i&&(i=this.getAttributeDefaultValueInternal("StopTimeAlias")),i!==this.__stopTimeAlias&&(this.__stopTimeAlias=i,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getStopTimeAlias"]),this.__processStopTimeAlias())}getStopTimeAlias(){return this.__stopTimeAlias}__processStopTimeAlias(){}setSetTimeAlias(t){var i=e.ValueConverter.toString(t);null===i&&(i=this.getAttributeDefaultValueInternal("SetTimeAlias")),i!==this.__setTimeAlias&&(this.__setTimeAlias=i,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getSetTimeAlias"]),this.__processSetTimeAlias())}getSetTimeAlias(){return this.__setTimeAlias}__processSetTimeAlias(){this.__elSetTimeButton.html(this.__setTimeAlias)}setCancelAlias(t){var i=e.ValueConverter.toString(t);null===i&&(i=this.getAttributeDefaultValueInternal("CancelAlias")),i!==this.__cancelAlias&&(this.__cancelAlias=i,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getCancelAlias"]),this.__processCancelAlias())}getCancelAlias(){return this.__cancelAlias}__processCancelAlias(){this.__elCancelTimeButton.html(this.__cancelAlias)}openCalendar(e,i){this.setRecord(i),this.isStartTime=e,this.isStartTime?(this.__elLabel.html(this.__startTimeAlias),this.__selectedTime=i.dtSelectedRangeStart.getClone(),this.__timeRange=new t.TimeRange(i.dtRecordStart,i.dtSelectedRangeEnd)):(this.__elLabel.html(this.__stopTimeAlias),this.__selectedTime=i.dtSelectedRangeEnd.getClone(),this.__timeRange=new t.TimeRange(i.dtSelectedRangeStart,i.dtRecordEnd)),this.__viewedMonth=this.__selectedTime.getClone(),this.__reloadAll(),this.__elModal.css("display","block")}closeCalendar(t){return()=>{t&&(this.isStartTime?this.__record.dtSelectedRangeStart=this.__selectedTime:this.__record.dtSelectedRangeEnd=this.__selectedTime),this.__elModal.css("display","none"),e.EventProvider.raise(this.__id+".onClosed",{control:this})}}__reloadAll(){this.__reloadCalendar(),this.__reloadTimeInput()}__reloadCalendar(){let e=this.__viewedMonth.wMonth,t=this.__viewedMonth.wYear,i=1;var s;this.__elHeadMonth.html(this.__calendarGetMonthName(e-1)+" "+t);var n=new Date(t,e-1,1).getDay();n=0==n?7:n;for(var _=1;_<=42;_++)if(i=_-n+1,(s=this.__elEntries[_-1]).style.border="0px",s.style.opacity="1",s.style.cursor="default",_>=n&&this.__isValidDate(t,e,i)){var a=this.__viewedMonth.getClone();a.wDay=i,this.__dateIsSelectable(a)?(s.innerHTML=i.toString(),s.style.visibility="visible",s.style.border="solid 1px",s.style.cursor="pointer",a.equalCalendarDate(this.__selectedTime)?s.style.backgroundColor=this.__selectedCellColor:s.style.backgroundColor=this.__cellColor):(s.innerHTML=i.toString(),s.style.backgroundColor=this.__cellColor,s.style.opacity="0.5")}else s.innerHTML="",s.style.backgroundColor=this.__cellColor,s.style.opacity="0.5",s.style.cursor="default",s.style.border="0px"}__reloadTimeInput(){this.__elTimeInput[0].value=this.__selectedTime.wHour.toString(),this.__elTimeInput[1].value=this.__selectedTime.wMinute.toString(),this.__elTimeInput[2].value=this.__selectedTime.wSecond.toString(),this.__elTimeInput[3].value=this.__selectedTime.wMilliseconds.toString()}__isValidDate(e,t,i){var s=new Date(e,t-1,1);return s.setMonth(s.getMonth()+1),s.setTime(s.getTime()-432e5),!(i>s.getDate())}__dateIsSelectable(e){let t,i;return this.isStartTime?(t=this.__record.dtRecordStart.getCalendarDate(),i=this.__record.dtSelectedRangeEnd.getClone()):(t=this.__record.dtSelectedRangeStart.getCalendarDate(),i=this.__record.dtRecordEnd.getClone()),i.wHour=23,i.wMinute=59,i.wSecond=59,i.wMilliseconds=999,t.getTime()<=e.getTime()&&e.getTime()<=i.getTime()}__calendarGetMonthName(e){return this.__fullMonthsAlias[e]}__checkAndUpdateTimeInput(e,t=0){let i=[23,59,59,999][e];var s=this.__elTimeInput[e];let n=parseInt(s.value.replace(/[^0-9]/g,""));switch(isNaN(n)&&(n=0),n+=t,n<0?n=i:n>i&&(n=0),e){case 0:this.__selectedTime.wHour=n;break;case 1:this.__selectedTime.wMinute=n;break;case 2:this.__selectedTime.wSecond=n;break;case 3:this.__selectedTime.wMilliseconds=n}this.__checkAndUpdateTimeByTimeRange(),this.__reloadTimeInput()}__checkAndUpdateTimeByTimeRange(){if(this.__selectedTime<this.__timeRange.startTime)this.__selectedTime=this.__timeRange.startTime.getClone();else{if(!(this.__selectedTime>this.__timeRange.endTime))return!0;this.__selectedTime=this.__timeRange.endTime.getClone()}return!1}__prevMonthClicked(){return()=>{var e=this.__viewedMonth.wMonth,i=this.__viewedMonth.wYear;e-1<1?(e=12,i-=1):e-=1,this.__viewedMonth=new t.DCTimestruct(i,e,1),this.__reloadCalendar()}}__nextMonthClicked(){return()=>{var e=this.__viewedMonth.wMonth,i=this.__viewedMonth.wYear;e+1>12?(e=1,i+=1):e+=1,this.__viewedMonth=new t.DCTimestruct(i,e,1),this.__reloadCalendar()}}__cellClicked(e){return()=>{let i=this.__elEntries[e];if(null!=i){var s=parseInt(i.innerHTML);if(!isNaN(s)){var n=this.__selectedTime.wMonth,_=this.__selectedTime.wYear;this.__dateIsSelectable(new t.DCTimestruct(_,n,s))&&(this.__selectedTime.wDay=s,this.__checkAndUpdateTimeByTimeRange(),this.__reloadAll())}}}}__timeInputChanged(e){let t=this;return()=>{t.__checkAndUpdateTimeInput(e)}}__timeMoveUpDown(e,t){let i=this;return()=>{i.__checkAndUpdateTimeInput(e,t?1:-1)}}}t.Calendar=i}(i=t.Analytics||(t.Analytics={}))}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("Calendar","TcHmi.Controls.Analytics",TcHmi.Controls.Analytics.Calendar);