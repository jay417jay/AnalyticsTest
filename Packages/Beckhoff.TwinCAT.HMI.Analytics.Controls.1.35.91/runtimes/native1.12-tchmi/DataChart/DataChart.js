var TcHmi;!function(e){let t;!function(t){let a,r;!function(t){class a extends e.Controls.Analytics.AnalyticsControl{constructor(e,a,r){super(e,a,r),this.__symbolRawData=null,this.__symbolChartInfo=null,this.__controlId="",this.__dataSourceHandler=new t.DataSourceHandler,this.__dataSourceList=[],this.__dataSymbolConnectCounter=0,this.__infoSymbolConnectCounter=0,this.__firstCallPropertyHandling=!1,this.__showDataSources=!1,this.__waitForNewData=!1,this.__localKeys={Chart_Type:"Chart_Type",Fillmode:"Fillmode",YT_Chart:"YT_Chart",YT_Chart_Description:"YT_Chart_Description",Bar_Chart:"Bar_Chart",Bar_Chart_Description:"Bar_Chart_Description",Pie_Chart:"Pie_Chart",Pie_Chart_Description:"Pie_Chart_Description",Ring_Chart:"Ring_Chart",Ring_Chart_Description:"Ring_Chart_Description",Compare_YT_Chart:"Compare_YT_Chart",Compare_YT_Chart_Description:"Compare_YT_Chart_Description",TimeSeries_Bar_Chart:"TimeSeries_Bar_Chart",TimeSeries_Bar_Chart_Description:"TimeSeries_Bar_Chart_Description",Chart_Settings:"Chart_Settings",Y_Axis_Description:"Y_Axis_Description",Use_Hover_Effect:"Use_Hover_Effect",Channels:"Channels",Channel:"Channel",Timeranges:"Timeranges",Timerange:"Timerange",Refresh_Interval:"Refresh_Interval",Compare_Type:"Compare_Type",Compare_Interval:"Compare_Interval",Previous:"Previous",Previous_Maskulin:"Previous_Maskulin",Previous_Neutral:"Previous_Neutral",Past:"Past",Past_Maskulin:"Past_Maskulin",Past_Neutral:"Past_Neutral",Past_Plural:"Past_Plural",This:"This",This_Maskulin:"This_Maskulin",This_Neutral:"This_Neutral",Seconds:"Seconds",Minutes:"Minutes",Hours:"Hours",Days:"Days",Weeks:"Weeks",Months:"Months",Years:"Years",Second:"Second",Minute:"Minute",Hour:"Hour",Day:"Day",Week:"Week",Month:"Month",Year:"Year",Millisecond_s:"Millisecond_s",Second_s:"Second_s",Minute_s:"Minute_s",Hour_s:"Hour_s",Day_s:"Day_s",Week_s:"Week_s",Month_s:"Month_s",Year_s:"Year_s",Now:"Now",From:"From",To:"To",SoFar:"SoFar",Today:"Today",Yesterday:"Yesterday",DayBeforeYesterday:"DayBeforeYesterday",Choose_Interval:"Choose_Interval",Custom_Interval:"Custom_Interval",Edit_Properties:"Edit_Properties",Refresh_Chart:"Refresh_Chart",Choose_Variable:"Choose_Variable",Ends_In_Future:"Ends_In_Future",Timerange_To_Smaller_From:"Timerange_To_Smaller_From",FillMode_Fill:"FillMode_Fill",FillMode_None:"FillMode_None",CompareType_Absolute:"CompareType_Absolute",CompareType_Relative:"CompareType_Relative",CompareType_MatchStart:"CompareType_MatchStart",CompareType_MatchEnd:"CompareType_MatchEnd",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday",Sunday:"Sunday",Refresh_Interval_To_Small:"Refresh_Interval_To_Small",Edit_DataSources:"Edit_DataSources",No_Data_For_Source_In_Timerange:"No_Data_For_Source_In_Timerange",No_Recordings_Found_For_Source:"No_Recordings_Found_For_Source",Subtract_Initial_Value:"Subtract_Initial_Value",Bar_Width:"Bar_Width",Bar_Interval_To_Small:"Bar_Interval_To_Small",Bar_Interval_To_Large:"Bar_Interval_To_Large",Time_Input_Wrong_Format:"Time_Input_Wrong_Format",Swiched_ChartType_To_Compare_YT_Chart:"Swiched_ChartType_To_Compare_YT_Chart",Swiched_ChartType_To_TimeSeries_Bar_Chart:"Swiched_ChartType_To_TimeSeries_Bar_Chart",Click_To_Edit_Colors:"Click_To_Edit_Colors",To_By_Compare_Interval:"To_By_Compare_Interval",Value_Not_Editable:"Value_Not_Editable",Visible:"Visible",Interval:"Interval",Compare_Settings:"Compare_Settings",Only_Editable_In_TS_Barchart:"Only_Editable_In_TS_Barchart",Only_Editable_With_Relative_Timerange:"Only_Editable_With_Relative_Timerange",Only_Editable_In_CompareChart:"Only_Editable_In_CompareChart",Reference:"Reference",Acquisition:"Acquisition",Color:"Color",Color_For_Timerange:"Color_For_Timerange"},this.__waitTimeoutScalingID=-1,this.__waitTimeoutRenamingID=-1,this.__timerangevisibilityChanged=!1,this.__rawDataSymbolWatchDestroy=null,this.__infoSymbolWatchDestroy=null,this.__onChartConfigReceived=!1,this.__onChartTypeSwitchedAutomatically=!1,this.__onResized=()=>(e,t)=>{const a=super.__getScaleFactor();if(!1===this.__hasLicense)throw"No Analytics License Found";this.__elementTemplateRoot.css("padding",5*a),this.__elementNameAlias.css("font-size",this.__fontsizeTitle+"px"),this.__showReset?this.__elementNameAlias.css("padding-right","16px"):this.__elementNameAlias.css("padding-right","5px"),this.__setChartSize()},this.__darkMode=!1,this.__channels=[],this.__timeranges=[],this.__chartTyp=s.YTChart,this.__ctype=t.E_ChartType.YTCHART,this.__compareInterval={rangeValue:10,rangeUnit:t.TimeIntervalStrings.Minute_s},this.__barIntervalWidth=null,this.__compareType=t.ECompareChartCompareTypes.ABSOLUTE_TIME,this.__refreshInterval=null,this.__fillMode=t.EFillMode.FILL}__previnit(){super.__previnit(),this.__elChartContainer=this.__elementTemplateRoot.find(".tchmi-data-chart-chart"),this.__elCalendar=this.__elementTemplateRoot.find(".custom-calendar")[0]}__init(){this.__setProperties(),super.__init(),this.__setControlId(),this.__initCharting(),this.__darkMode&&this.__elementNameAlias.addClass("dark-mode"),this.__eventListenerManager.addEventListener(this.__dataSourceHandler,t.DataChartEventNames.dataSourcesReceived,e=>this.__processDataSources(e.detail)),this.__eventListenerManager.addEventListener(this.__dataSourceHandler,t.DataChartEventNames.chartConfigReceived,e=>this.__setChartConfigFromServerExtension(e.detail)),this.__element[0].hasAttribute("data-tchmi-reset-config")&&"true"==this.__element[0].getAttribute("data-tchmi-reset-config")?this.dropChartConfig():this.__dataSourceHandler.getDataChartConfig(this.__controlId),this.__connectToServerSymbols()}__attach(){super.__attach(),this.setDarkMode(this.__isDarkTheme),this.__initalizeEditArea(),this.__elCalendar.showShadow=!0}__detach(){super.__detach(),this.__calendarClosedDestroyEvent&&(this.__calendarClosedDestroyEvent(),this.__calendarClosedDestroyEvent=void 0)}destroy(){this.__keepAlive||(super.destroy(),null!=this.__rawDataSymbolWatchDestroy&&this.__rawDataSymbolWatchDestroy(),this.__symbolRawData=null,null!=this.__infoSymbolWatchDestroy&&this.__infoSymbolWatchDestroy(),this.__symbolChartInfo=null)}__setControlId(){let e=this.__parent.getId();this.__parent instanceof t.LayoutManager&&(e=this.__parent.layoutIDWithoutDisplayMode.toString()),this.__controlId=r.CreateChartControlID(e,this.__id)}__setChartSize(){const e=this.__elementTemplateRoot[0].getBoundingClientRect().width,t=this.__elementTemplateRoot[0].getBoundingClientRect().height,a=this.__element[0].getElementsByClassName("tchmi-analytics-control-title-area")[0].getBoundingClientRect().height;this.__elChartContainer[0].style.height=String(t-a+"px"),null!=this.__elChartCtrl&&(-1!=this.__waitTimeoutScalingID&&clearTimeout(this.__waitTimeoutScalingID),this.__waitTimeoutScalingID=setTimeout(()=>{this.__dataCharting(),this.__waitTimeoutScalingID=-1},100),this.__elChartCtrl.scaleChartControl(e,t-a,!1))}__processWidth(){super.__processWidth(),null!=this.__elChartCtrl&&this.__elChartCtrl.setWidth(this.getWidth())}__processHeight(){super.__processHeight(),null!=this.__elChartCtrl&&this.__elChartCtrl.setHeight(this.getHeight())}__initalizeEditArea(){const e=[new t.EditAreaItem("",this.local.get(this.__localKeys.YT_Chart),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/linechart.svg")',null,this.__editAreaChartType(s.YTChart)),new t.EditAreaItem("",this.local.get(this.__localKeys.Bar_Chart),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/barchart.svg")',null,this.__editAreaChartType(s.BarChart)),new t.EditAreaItem("",this.local.get(this.__localKeys.Pie_Chart),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/piechart.svg")',null,this.__editAreaChartType(s.PieChart)),new t.EditAreaItem("",this.local.get(this.__localKeys.Ring_Chart),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/ringchart.svg")',null,this.__editAreaChartType(s.RingChart)),new t.EditAreaItem("",this.local.get(this.__localKeys.Compare_YT_Chart),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/compareYTchart.svg")',null,this.__editAreaChartType(s.CompareYTChart)),new t.EditAreaItem("",this.local.get(this.__localKeys.TimeSeries_Bar_Chart),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/timeseriesbarchart.svg")',null,this.__editAreaChartType(s.TimeSeriesBarChart))],a=[new t.EditAreaItem("",this.local.get(this.__localKeys.Edit_Properties),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/AnalyticsControl/Images/edit.png")',null,super.__onPropertiesClicked()),new t.EditAreaItem("",this.local.get(this.__localKeys.Chart_Type),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/linechart.svg")',null,super.__onPropertiesClicked(),e),new t.EditAreaItem("",this.local.get(this.__localKeys.Refresh_Chart),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/AnalyticsControl/Icons/reset.svg")',null,()=>this.__dataSourceHandler.refreshChart(this.__controlId))];this.__showDataSources&&a.push(new t.EditAreaItem("",this.local.get(this.__localKeys.Edit_DataSources),'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/HistData.png")',null,()=>this.__onSourceManager())),super.__createEditArea(a)}__editAreaChartType(e){return()=>{this.setChartTyp(e)}}setAxisDescription(t){let a=e.ValueConverter.toString(t);if(null==a&&(a=this.getAttributeDefaultValueInternal("AxisDescription")),a===this.__axisDescription)return;let r=void 0===this.__axisDescription;this.__axisDescription=a,this.__processAxisDescription(),e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getAxisDescription"]),r||this.__setChartConfigInServerExtension()}__processAxisDescription(){null!=this.__elChartCtrl&&(-1!=this.__waitTimeoutRenamingID&&clearTimeout(this.__waitTimeoutRenamingID),this.__waitTimeoutRenamingID=setTimeout(()=>{this.__dataCharting()},100))}getAxisDescription(){return this.__axisDescription}setDarkMode(t){var a;let r=e.ValueConverter.toBoolean(t);null==r&&(r=this.getAttributeDefaultValueInternal("DarkMode")),this.__darkMode=r,null===(a=this.__elChartCtrl)||void 0===a||a.setDarkMode(this.__darkMode),r!==this.__darkMode&&e.EventProvider.raise(this.__id+".onFunctionResultChanged",["getDarkMode"])}getDarkMode(){return this.__darkMode}setChannels(t){let a=e.ValueConverter.toObject(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("Channels"),a=[]),a===this.__channels)return;let r=void 0===this.__channels;this.__channels=a,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getChannels"]),r||this.__setChartConfigInServerExtension(),this.__processChannels()}getChannels(){return this.__channels}__processChannels(){var e,t;null!=this.__rawData&&this.__rawData.symbols.length==this.__channels.length?this.__dataCharting():this.__timeranges.length>0&&this.__channels.length>0&&(null===(e=this.__elChartCtrl)||void 0===e||e.clearChart(),null===(t=this.__elChartCtrl)||void 0===t||t.createLoadingInfo(!1))}setTimeranges(t){let a=e.ValueConverter.toObject(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("Timeranges")),a===this.__timeranges)return;let r=void 0===this.__timeranges;this.__timeranges=a,null==a&&(this.__timeranges=[]),null!=this.__chartPropertyHandler&&(this.__chartPropertyHandler.timerangeEntries=this.__timeranges),e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getTimeranges"]),this.__processTimeranges(),r||this.__setChartConfigInServerExtension()}getTimeranges(){return this.__timeranges}__processTimeranges(){var e,t;const a=$(".tchmi-analytics-control-properties-active"),r=null!=a&&0!=a.length;this.__setProperties(),r&&this.__openPropertyWindow(),this.__timeranges.length>0&&this.__channels.length>0&&!this.__timerangevisibilityChanged&&(null===(e=this.__elChartCtrl)||void 0===e||e.clearChart(),null===(t=this.__elChartCtrl)||void 0===t||t.createLoadingInfo(!1))}setChartTyp(t){let a=e.ValueConverter.toString(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("ChartTyp")),a===this.__chartTyp)return;let r=void 0===this.__chartTyp;this.__chartTyp=a,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getChartTyp"]),this.__processChartType(),r||this.__setChartConfigInServerExtension()}getChartTyp(){return this.__chartTyp}__processChartType(){const e=JSON.parse(JSON.stringify(this.__ctype));this.__chartTyp===s.YTChart?this.__ctype=t.E_ChartType.YTCHART:this.__chartTyp===s.BarChart?this.__ctype=t.E_ChartType.BARCHART:this.__chartTyp===s.CompareYTChart?this.__ctype=t.E_ChartType.COMPAREYTCHART:this.__chartTyp===s.TimeSeriesBarChart?(this.__ctype=t.E_ChartType.TIMESERIESBARCHART,e!=t.E_ChartType.TIMESERIESBARCHART&&this.__setBarIntervalWidth(!1)):this.__chartTyp===s.PieChart?this.__ctype=t.E_ChartType.PIECHART:this.__chartTyp===s.RingChart?this.__ctype=t.E_ChartType.RINGCHART:this.__chartTyp===s.SingleValueChart&&(this.__ctype=t.E_ChartType.SINGLEVALUECHART),!this.__isCompareChartType(e)&&this.__isCompareChartType(this.__ctype)&&this.__calculateCompareInterval();const a=$(".tchmi-analytics-control-properties-active"),r=null!=a&&0!=a.length;this.__setProperties(),r&&this.__openPropertyWindow(),e==this.__ctype||this.__isCompareChartType(e)||this.__isCompareChartType(this.__ctype)?this.__waitForNewData=!0:this.__dataCharting()}__isCompareChartType(e){return e===t.E_ChartType.COMPAREYTCHART||e===t.E_ChartType.TIMESERIESBARCHART}__calculateCompareInterval(){if(this.__timeranges.length>0){const e=this.__timeranges[0],a=new Date,r=t.TimeConverter.getFromTcTime(e,a);let s=(t.TimeConverter.getToTcTime(e,a)-r)/t.SPTime.TIME_IN_MS_TO_TC_FACTOR;t.RegexHelper.dateTimePattern.test(e.to)&&s%86400==86399&&(s+=1);const i=t.TimeInterval.ConvertToInterval(s);i.rangeValue=Math.round(i.rangeValue),i.rangeUnit===t.TimeIntervalStrings.Week_s&&i.rangeValue%4==0?this.__compareInterval={rangeValue:i.rangeValue/4,rangeUnit:t.TimeIntervalStrings.Month_s}:i.rangeUnit===t.TimeIntervalStrings.Day_s&&i.rangeValue%7==0?this.__compareInterval={rangeValue:i.rangeValue/7,rangeUnit:t.TimeIntervalStrings.Week_s}:this.__compareInterval=i}}setCompareInterval(t){let a=e.ValueConverter.toObject(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("CompareInterval")),a===this.__compareInterval||null==a)return;a.rangeUnit=this.__getLocalizationKey(a.rangeUnit);let r=null===this.__compareInterval;this.__compareInterval=a,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getCompareInterval"]),this.__processCompareInterval(),r||this.__setChartConfigInServerExtension()}getCompareInterval(e=!1){return null==this.__compareInterval&&(this.__compareInterval={},this.__compareInterval.rangeValue=10,this.__compareInterval.rangeUnit=t.TimeIntervalStrings.Minute_s),e?this.__compareInterval:{rangeValue:this.__compareInterval.rangeValue,rangeUnit:this.local.get(this.__compareInterval.rangeUnit)}}__processCompareInterval(){this.__setBarIntervalWidth(!1),this.__chartPropertyHandler.compareTimerange=this.__compareInterval;const e=[...this.__timeranges];this.__timeranges=e,this.__chartPropertyHandler.timerangeEntries=this.__timeranges;const t=$(".tchmi-analytics-control-properties-active"),a=null!=t&&0!=t.length;this.__setProperties(),a&&this.__openPropertyWindow()}setBarIntervalWidth(a){let r=e.ValueConverter.toObject(a);if(null===r&&(r=this.getAttributeDefaultValueInternal("BarIntervalWidth")),r===this.__barIntervalWidth||null==r)return;r.rangeUnit=this.__getLocalizationKey(r.rangeUnit);let s=null===this.__barIntervalWidth;const i=t.BarIntervalWidthHelper.getBarDefinition(r,this.__compareInterval),l=t.TimeInterval.ConvertToMs(r.rangeValue,r.rangeUnit),_=t.TimeInterval.ConvertToMs(this.__compareInterval.rangeValue,this.__compareInterval.rangeUnit);i.numberOfBars>500?(this.__setBarIntervalWidth(!1),this.__createPopup(this.local.get(this.__localKeys.Bar_Interval_To_Small),CustomElements.PopupStatus.WARNING,5e3)):l>_?(this.__barIntervalWidth={rangeValue:this.__compareInterval.rangeValue,rangeUnit:this.__compareInterval.rangeUnit},this.__createPopup(this.local.get(this.__localKeys.Bar_Interval_To_Large),CustomElements.PopupStatus.WARNING,5e3)):this.__barIntervalWidth=r,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getBarIntervalWidth"]),this.__processBarIntervalWidth(),s||this.__setChartConfigInServerExtension()}getBarIntervalWidth(e=!1){return null==this.__barIntervalWidth&&(this.__barIntervalWidth={},this.__barIntervalWidth.rangeValue=10,this.__barIntervalWidth.rangeUnit=t.TimeIntervalStrings.Minute_s),e?this.__barIntervalWidth:{rangeValue:this.__barIntervalWidth.rangeValue,rangeUnit:this.local.get(this.__barIntervalWidth.rangeUnit)}}__processBarIntervalWidth(e=!0){const t=$(".tchmi-analytics-control-properties-active"),a=null!=t&&0!=t.length;this.__setProperties(),a&&this.__openPropertyWindow(),e&&this.__dataCharting()}setCompareType(t){let a=e.ValueConverter.toString(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("CompareType")),a===this.__compareType)return;let r=null===this.__compareType;const s=this.__getLocalizationKey(a);null!=s&&(a=s),this.__setCompareType(a),e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getCompareType"]),this.__processCompareType(),r||this.__setChartConfigInServerExtension()}__setCompareType(e){switch(e){case"Absolute":case"CompareType_Absolute":this.__compareType=t.ECompareChartCompareTypes.ABSOLUTE_TIME;break;case"Relative":case"CompareType_Relative":this.__compareType=t.ECompareChartCompareTypes.RELATIVE_TIME;break;case"Matching Start":case"CompareType_MatchStart":this.__compareType=t.ECompareChartCompareTypes.MATCHING_START;break;case"Matching End":case"CompareType_MatchEnd":this.__compareType=t.ECompareChartCompareTypes.MATCHING_END;break;default:this.__compareType=void 0}}getCompareType(){switch(null==this.__compareType&&(this.__compareType=t.ECompareChartCompareTypes.ABSOLUTE_TIME),this.__compareType){case t.ECompareChartCompareTypes.ABSOLUTE_TIME:return this.local.get(this.__localKeys.CompareType_Absolute);case t.ECompareChartCompareTypes.RELATIVE_TIME:return this.local.get(this.__localKeys.CompareType_Relative);case t.ECompareChartCompareTypes.MATCHING_START:return this.local.get(this.__localKeys.CompareType_MatchStart);case t.ECompareChartCompareTypes.MATCHING_END:return this.local.get(this.__localKeys.CompareType_MatchEnd)}return this.__compareType}__processCompareType(){this.__dataCharting()}setRefreshInterval(t){let a=e.ValueConverter.toObject(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("RefreshInterval")),a===this.__refreshInterval||null==a)return;let r=null===this.__refreshInterval;a.rangeUnit=this.__getLocalizationKey(a.rangeUnit),this.__refreshInterval=a,this.__processRefreshInterval(),e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getRefreshInterval"]),r||this.__setChartConfigInServerExtension()}getRefreshInterval(e=!1){if(null==this.__refreshInterval&&(this.__refreshInterval={},this.__refreshInterval.rangeValue=10,this.__refreshInterval.rangeUnit=t.TimeIntervalStrings.Minute_s),e)return this.__refreshInterval;return{rangeValue:this.__refreshInterval.rangeValue,rangeUnit:this.local.get(this.__refreshInterval.rangeUnit)}}__processRefreshInterval(){const e=$(".tchmi-analytics-control-properties-active"),t=null!=e&&0!=e.length;this.__refreshInterval.rangeValue<1&&(this.__refreshInterval.rangeValue=1,t&&this.__createPopup(this.local.get(this.__localKeys.Refresh_Interval_To_Small),CustomElements.PopupStatus.WARNING,5e3)),this.__setProperties(),t&&this.__openPropertyWindow()}setFillMode(a,r=!0){let s=null==this.__fillMode,i=e.ValueConverter.toString(a);if(null===i&&(i=this.getAttributeDefaultValueInternal("FillMode")),i===this.__fillMode)return;const l=this.__getLocalizationKey(i);switch(null!=l&&(i=l),i){case"None":case this.__localKeys.FillMode_None:this.__fillMode=t.EFillMode.NONE;break;case"Fill":case this.__localKeys.FillMode_Fill:default:this.__fillMode=t.EFillMode.FILL}s||this.__setChartConfigInServerExtension(),e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getFillMode"]),r&&this.__processFillMode()}getFillMode(){return null==this.__fillMode&&(this.__fillMode=t.EFillMode.FILL),this.__fillMode==t.EFillMode.FILL?this.local.get(this.__localKeys.FillMode_Fill):this.local.get(this.__localKeys.FillMode_None)}__processFillMode(){this.__dataCharting()}setUseHoverEffect(t){let a=e.ValueConverter.toBoolean(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("UseHoverEffect")),a===this.__useHoverEffect)return;let r=null===this.__refreshInterval;this.__useHoverEffect=a,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getUseHoverEffect"]),this.__processUseHoverEffect(),r||this.__setChartConfigInServerExtension()}getUseHoverEffect(){return null==this.__useHoverEffect&&(this.__useHoverEffect=!0),this.__useHoverEffect}__processUseHoverEffect(){this.__dataCharting()}setShowDifferentialValues(t){let a=e.ValueConverter.toBoolean(t);if(null===a&&(a=this.getAttributeDefaultValueInternal("ShowDifferentialValues")),a===this.__showDifferentialValues)return;let r=null===this.__refreshInterval;this.__showDifferentialValues=a,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowDifferentialValues"]),this.__processShowDifferentialValues(),r||this.__setChartConfigInServerExtension()}getShowDifferentialValues(){return this.__showDifferentialValues}__processShowDifferentialValues(){this.__dataCharting()}__setChartConfigFromServerExtension(e){let a=JSON.parse(e);if(null!=a&&null!=a.chartProperties){switch(this.__ctype=a.chartProperties.chartType,a.chartProperties.chartType){case t.E_ChartType.YTCHART:const e=a.chartProperties;this.__axisDescription=e.axes[0].label,this.__fillMode=e.fillMode,this.__chartTyp=s.YTChart;break;case t.E_ChartType.BARCHART:const r=a.chartProperties;this.__axisDescription=r.axes[0].label,this.__chartTyp=s.BarChart;break;case t.E_ChartType.PIECHART:this.__chartTyp=s.PieChart;break;case t.E_ChartType.RINGCHART:this.__chartTyp=s.RingChart;break;case t.E_ChartType.COMPAREYTCHART:const i=a.chartProperties;this.__axisDescription=i.axes[0].label,this.__fillMode=i.fillMode,this.__compareInterval=i.compareInterval,this.__compareType=i.compareType,this.__chartTyp=s.CompareYTChart,this.__onChartTypeSwitchedAutomatically=!0;break;case t.E_ChartType.TIMESERIESBARCHART:const l=a.chartProperties;this.__axisDescription=l.axes[0].label,this.__compareInterval=l.compareInterval,this.__compareType=l.compareType,this.__barIntervalWidth=l.barIntervalWidth,this.__chartTyp=s.TimeSeriesBarChart,this.__onChartTypeSwitchedAutomatically=!0}const e=[];for(let t=0;t<a.data.length;t++){const r=a.data[t];for(let a=0;a<r.channels.length;a++){const s=r.channels[a];let i=null;t>0&&(i=e.slice(a).find(e=>e.name===s.name&&e.sourceID===s.sourceID)),null==i&&(i={sourceID:s.sourceID,datatype:s.datatype,name:s.name,varColors:[],visibility:[],unit:s.unit,customUnit:s.customUnit,userFalseAlias:s.userFalseAlias,userTrueAlias:s.userTrueAlias},e.push(i)),i.varColors.push(s.varColor),i.visibility.push(s.isVisible)}}this.__channels=e,this.__timeranges=[];for(const e of a.data){const a={};if(t.RegexHelper.dateTimePattern.test(e.from)){const r=t.TimeParser.parseStringToDate(e.from,!0);a.from=t.TimeParser.parseDateToString(r,!1)}else a.from=e.from;if(t.RegexHelper.dateTimePattern.test(e.to)){const r=t.TimeParser.parseStringToDate(e.to,!0);a.to=t.TimeParser.parseDateToString(r,!1)}else a.to=e.to;a.isVisible=e.isVisible,this.__timeranges.push(a)}let r={rangeValue:60,rangeUnit:t.TimeIntervalStrings.Minute_s};a.refreshInterval.rangeValue>=1&&""!=a.refreshInterval.rangeUnit&&(r=a.refreshInterval),this.__refreshInterval=r,this.__useHoverEffect=a.chartProperties.useHoverEffect,this.__showDifferentialValues=a.chartProperties.showDifferentials,this.__processChartType(),this.__onChartConfigReceived=!0}}__setChartConfigInServerExtension(){if(null!=this.__channels&&this.__channels.length>0&&null!=this.__timeranges&&this.__timeranges.length>0){let a=t.ChannelConfigHelper.ExtractChannelsFromChannelConfig(this.__channels,this.__timeranges),r=new e.List,s=0;if(null!=this.__timeranges)for(let i of this.__timeranges){const l={};if(t.RegexHelper.dateTimePattern.test(i.from)){const e=t.TimeParser.parseStringToDate(i.from,!1);l.from=t.TimeParser.parseDateToString(e,!0)}else l.from=i.from;if(t.RegexHelper.dateTimePattern.test(i.to)){const e=t.TimeParser.parseStringToDate(i.to,!1);l.to=t.TimeParser.parseDateToString(e,!0)}else l.to=i.to;l.isVisible=i.isVisible,l.channels=new e.List,l.channels.addRange(a.slice(this.__channels.length*s,this.__channels.length*(s+1))),r.push(l),s++}let i={};i.chartID=this.__controlId,i.data=r,i.chartProperties=this.__getChartOptions(!1),i.refreshInterval=this.getRefreshInterval(!0),this.__dataSourceHandler.setDataChartConfig(i),null==this.__symbolRawData&&(console.error("no datasymbol while sending data request of chart "+i.chartID+" Trying remap"),this.__dataSymbolConnectCounter=0,this.__connectToDataSymbol()),this.__checkNameAlias()}}__checkNameAlias(){if(this.__nameAlias.startsWith("New charting")||this.__nameAlias.includes("[autogenerated title]")){const e=this.__generateChartTitle();if(this.__nameAlias!=e){this.setAndSaveNameAlias(e);const t=$(".tchmi-analytics-control-properties-active"),a=null!=t&&0!=t.length;this.__setProperties(),a&&this.__openPropertyWindow()}}}__generateChartTitle(){let e=`${this.__chartTyp} of `;const t=[];for(const e of this.__channels){const a=this.__getFirstPart(e.name);t.some(e=>e==a)||t.push(a)}return e+=t.join(" "),e+=" [autogenerated title]",e}__getFirstPart(e){if(e.includes("."))return e.split(".")[0]}__connectToServerSymbols(){this.__connectToDataSymbol(),this.__connectToInfoSymbol()}__connectToDataSymbol(){this.__dataSymbolConnectCounter<5&&(this.__sendMapRequest(this.__controlId+"_RawData",()=>this.__watchDataSymbol()),this.__dataSymbolConnectCounter++)}__connectToInfoSymbol(){this.__infoSymbolConnectCounter<5&&(this.__sendMapRequest(this.__controlId+"_Info",()=>this.__watchInfoSymbol()),this.__infoSymbolConnectCounter++)}__sendMapRequest(t,a){e.Server.requestEx({requestType:"ReadWrite",commands:[{symbol:"TcHmiAnalytics.AddAnalyticsSymbol",commandOptions:["SendErrorMessage"],writeValue:JSON.stringify({NAME:t,MAPPING:t,ACCESS:3,DOMAIN:"TcHmiAnalytics",AUTOMAP:!0,USEMAPPING:!0})}]},{timeout:1e4,parallel:!0},(function(r){const s=r;null==s?console.error(`Could not map to symbol ${t}`):null!=s.error&&s.error!=e.Errors.NONE?console.error(s):setTimeout(()=>a(),100)}))}__watchDataSymbol(){e.Symbol.isSymbolExpression("%s%"+this.__controlId+"_RawData%/s%")?(null!=this.__rawDataSymbolWatchDestroy&&this.__rawDataSymbolWatchDestroy(),null!=this.__symbolRawData&&(this.__symbolRawData=null,console.info("Removed symbol "+this.__controlId+"_Info.")),this.__symbolRawData=new e.Symbol("%s%"+this.__controlId+"_RawData%/s%"),this.__rawDataSymbolWatchDestroy=this.__symbolRawData.watch(t=>{null!=t&&t.error===e.Errors.NONE?console.info("New data on symbol: "+this.__controlId+"_RawData."):(null!=this.__rawDataSymbolWatchDestroy&&this.__rawDataSymbolWatchDestroy(),this.__symbolRawData=null,console.error("Failed to watch symbol "+this.__controlId+"_RawData. Attempt: "+this.__dataSymbolConnectCounter+" Reason: "+JSON.stringify(t)),setTimeout(()=>this.__connectToDataSymbol(),1e3)),this.__onDataReceived(t)})):console.error("No valid symbol: %s%"+this.__controlId+"_RawData%/s%")}__watchInfoSymbol(){e.Symbol.isSymbolExpression("%s%"+this.__controlId+"_Info%/s%")?(null!=this.__infoSymbolWatchDestroy&&this.__infoSymbolWatchDestroy(),null!=this.__symbolChartInfo&&(this.__symbolChartInfo=null,console.info("Removed symbol "+this.__controlId+"_Info.")),this.__symbolChartInfo=new e.Symbol("%s%"+this.__controlId+"_Info%/s%"),this.__infoSymbolWatchDestroy=this.__symbolChartInfo.watch(t=>{null!=t&&t.error===e.Errors.NONE?console.info("New data on symbol: "+this.__controlId+"_Info."):(null!=this.__infoSymbolWatchDestroy&&this.__infoSymbolWatchDestroy(),this.__symbolChartInfo=null,console.error(String("Failed to watch symbol "+this.__controlId+"_Info. Attempt: "+this.__infoSymbolConnectCounter+" Reason: "+JSON.stringify(t))),setTimeout(()=>this.__connectToInfoSymbol(),1e3)),this.__onInfoReceived(t)})):console.error("No valid symbol: %s%"+this.__controlId+"_Info%/s%")}__sendUnMapRequest(t){e.Server.requestEx({requestType:"ReadWrite",commands:[{symbol:"TcHmiAnalytics.RemoveAnalyticsSymbol",commandOptions:["SendErrorMessage"],writeValue:t}]},{timeout:5e3,parallel:!0},(function(a){const r=a;null==r?console.error(`Could not unmap to symbol ${t}`):null!=r.error&&r.error!=e.Errors.NONE&&console.error(r)}))}__onDataReceived(t){var a,r,s;let i=e.ValueConverter.toObject(t.value);i!==this.__rawData&&(this.__rawData=i,null!=this.__rawData&&null!=this.__channels?(this.__waitForNewData=!1,this.__dataCharting()):null!=this.__channels&&this.__channels.length>0?(null===(a=this.__elChartCtrl)||void 0===a||a.clearChart(),null===(r=this.__elChartCtrl)||void 0===r||r.createLoadingInfo(!1)):null===(s=this.__elChartCtrl)||void 0===s||s.clearChart())}__onInfoReceived(t){var a,r;let s=e.ValueConverter.toString(t.value);if(null!=s&&""!=s){s.toLowerCase().startsWith("error")&&(null===(a=this.__elChartCtrl)||void 0===a?void 0:a.loadingInfoVisible)&&(null===(r=this.__elChartCtrl)||void 0===r||r.createLoadingInfo(!0));const e=$(".tchmi-analytics-control-properties-active");if(null!=e&&0!=e.length){const e=s.toLowerCase().startsWith("error"),t=s.toLowerCase().startsWith("warning");let a=CustomElements.PopupStatus.OK;e&&(a=CustomElements.PopupStatus.ALARM),t&&(a=CustomElements.PopupStatus.WARNING);const r=s.toLowerCase().startsWith("info: finished data reading of chart");(t||e||r)&&this.__createPopup(s,a,r?1e3:1e4)}}}__initCharting(){this.__elChartCtrl=e.Controls.get(`${this.__id}_Charting`),void 0===this.__elChartCtrl?this.__elChartCtrl=e.ControlFactory.createEx("TcHmi.Controls.Analytics.Charting",this.__id+"_Charting",{"data-tchmi-width":this.getWidth(),"data-tchmi-height":this.getHeight(),"data-tchmi-dark-mode":this.getDarkMode()},this):this.__elChartCtrl.createInitChart(),void 0!==this.__elChartCtrl?this.__elChartContainer.append(this.__elChartCtrl.getElement()):this.Log("Could not create Charting Control.")}__restoreChart(){this.__elChartCtrl=e.Controls.get("DataChart_Charting"),void 0!==this.__elChartCtrl?this.__elChartContainer.append(this.__elChartCtrl.getElement()):this.Log("Could not restore Charting Control.")}__dataCharting(){if(this.__waitForNewData)return;void 0===this.__elChartCtrl&&this.__restoreChart(),this.__elChartCtrl.createChart(this.__getChartOptions())||this.__elChartCtrl.createInitChart(this.__ctype)}__getChartOptions(e=!0){let a,r={};switch(r.label=this.__axisDescription,this.__ctype){case t.E_ChartType.YTCHART:a={},a.description=this.__axisDescription,a.fillMode=this.__fillMode,a.hoverPointRadius=5,a.labelSuffix="",a.renderDashedLineForXAxisTicks=!0,a.renderDashedLineForYAxisTicks=!0,a.timeranges=this.__timeranges,a.yAxisPosition=t.YAxisPosition.Left,a.axes=[r];break;case t.E_ChartType.BARCHART:a={},a.description=this.__axisDescription,a.hoverPointRadius=5,a.labelSuffix="",a.renderDashedLineForXAxisTicks=!0,a.renderDashedLineForYAxisTicks=!0,a.timeranges=this.__timeranges,a.yAxisPosition=t.YAxisPosition.Left,a.axes=[r];break;case t.E_ChartType.PIECHART:case t.E_ChartType.RINGCHART:a={},a.hoverPointRadius=5,a.timeranges=this.__timeranges,a.isRingChart=this.__ctype==t.E_ChartType.RINGCHART;break;case t.E_ChartType.COMPAREYTCHART:a={},a.description=this.__axisDescription,a.fillMode=this.__fillMode,a.hoverPointRadius=5,a.labelSuffix="",a.renderDashedLineForXAxisTicks=!0,a.renderDashedLineForYAxisTicks=!0,a.timeranges=this.__timeranges,a.yAxisPosition=t.YAxisPosition.Left,a.compareInterval=this.__compareInterval,a.compareIntervalSizeMs=t.TimeInterval.ConvertToMs(this.__compareInterval.rangeValue,this.__compareInterval.rangeUnit),a.compareType=this.__compareType,a.axes=[r];break;case t.E_ChartType.TIMESERIESBARCHART:a={},a.description=this.__axisDescription,a.hoverPointRadius=5,a.labelSuffix="",a.renderDashedLineForXAxisTicks=!0,a.renderDashedLineForYAxisTicks=!0,a.timeranges=this.__timeranges,a.yAxisPosition=t.YAxisPosition.Left,a.compareInterval=this.__compareInterval,a.compareIntervalSizeMs=t.TimeInterval.ConvertToMs(this.__compareInterval.rangeValue,this.__compareInterval.rangeUnit),a.compareType=this.__compareType,a.barIntervalWidth=this.__barIntervalWidth,a.axes=[r]}return a.channelConfigurations=t.ChannelConfigHelper.ExtractChannelsFromChannelConfig(this.__channels,this.__timeranges),a.chartType=this.__ctype,a.data=e?this.__rawData:null,a.useHoverEffect=this.__useHoverEffect,a.showDifferentials=this.__showDifferentialValues,a}dropChartConfig(){this.__sendUnMapRequest(this.__controlId+"_RawData"),this.__sendUnMapRequest(this.__controlId+"_Info");let e={};e.chartID=this.__controlId,this.dropNameAlias(),this.__dataSourceHandler.dropDataChartConfig(e)}updateChartID(){this.__sendUnMapRequest(String(this.__controlId+"_RawData")),this.__sendUnMapRequest(String(this.__controlId+"_Info")),this.__setControlId(),this.__initCharting(),this.__dataSymbolConnectCounter=0,this.__infoSymbolConnectCounter=0,this.__connectToServerSymbols(),this.__dataSourceHandler.getDataChartConfig(this.__controlId)}__beforeOpenPropertyWindow(){var e,t;null===(e=this.__channels)||void 0===e||e.forEach(e=>{e.isExpanded=!1}),null===(t=this.__timeranges)||void 0===t||t.forEach(e=>{e.isExpanded=!1})}__openPropertyWindow(){this.__firstCallPropertyHandling=!0,super.__openPropertyWindow(),this.__dataSourceHandler.requestDataSources();const e=[...document.querySelectorAll(".tchmi-analytics-control-property-editable")].filter(e=>e.getAttribute("title")===this.local.get(this.__localKeys.Compare_Interval));this.__eventListenerManager.removeEventListeners("CompareIntervalHover");const t=[...document.querySelectorAll(".tchmi-analytics-control-chart-from-custom-input-overlay")];for(const a of t)this.__eventListenerManager.addEventListener(a,"click",this.__chartPropertyHandler.highlightCompareInterval(e),!1,"CompareIntervalHover")}__processDataSources(e){this.__dataSourceList=JSON.parse(e),this.__setProperties(),super.__openPropertyWindow()}__setProperties(){const e=[{value:"YTChart",imgSrc:"Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/linechart.svg",boldText:this.local.get(this.__localKeys.YT_Chart),normalText:this.local.get(this.__localKeys.YT_Chart_Description)},{value:"BarChart",imgSrc:"Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/barchart.svg",boldText:this.local.get(this.__localKeys.Bar_Chart),normalText:this.local.get(this.__localKeys.Bar_Chart_Description)},{value:"PieChart",imgSrc:"Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/piechart.svg",boldText:this.local.get(this.__localKeys.Pie_Chart),normalText:this.local.get(this.__localKeys.Pie_Chart_Description)},{value:"RingChart",imgSrc:"Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/ringchart.svg",boldText:this.local.get(this.__localKeys.Ring_Chart),normalText:this.local.get(this.__localKeys.Ring_Chart_Description)},{value:"CompareYTChart",imgSrc:"Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/compareYTchart.svg",boldText:this.local.get(this.__localKeys.Compare_YT_Chart),normalText:this.local.get(this.__localKeys.Compare_YT_Chart_Description)},{value:"TimeSeriesBarChart",imgSrc:"Beckhoff.TwinCAT.HMI.Analytics.Controls/DataChart/Icons/timeseriesbarchart.svg",boldText:this.local.get(this.__localKeys.TimeSeries_Bar_Chart),normalText:this.local.get(this.__localKeys.TimeSeries_Bar_Chart_Description)}],a=[];a.push(new t.Property(this,"ChartTyp","Chart",t.E_DataType.CONTENTSEPARATOR,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Chart_Type),displayName:this.local.get(this.__localKeys.Chart_Type)}],allowPersist:!1,allowReset:!1})),a.push(new t.Property(this,"ChartTyp","",t.E_DataType.MAX_COMBOBOX,{comboBoxOptions:[{value:JSON.stringify(e),displayName:JSON.stringify(e)}],allowPersist:!1,allowReset:!1})),a.push(new t.Property(this,"ChartTyp","Chart",t.E_DataType.CONTENTSEPARATOR,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Chart_Settings),displayName:this.local.get(this.__localKeys.Chart_Settings)}],allowPersist:!1,canBeSet:!1,allowReset:!1})),a.push(new t.Property(this,"AxisDescription",this.local.get(this.__localKeys.Y_Axis_Description),t.E_DataType.STRING,{allowPersist:!1,allowReset:!1})),this.__ctype!=t.E_ChartType.YTCHART&&this.__ctype!=t.E_ChartType.COMPAREYTCHART||a.push(new t.Property(this,"FillMode",this.local.get(this.__localKeys.Fillmode),t.E_DataType.COMBOBOX,{comboBoxOptions:[{value:this.local.get(this.__localKeys.FillMode_Fill),displayName:this.local.get(this.__localKeys.FillMode_Fill)},{value:this.local.get(this.__localKeys.FillMode_None),displayName:this.local.get(this.__localKeys.FillMode_None)}],allowPersist:!1,allowReset:!1})),a.push(new t.Property(this,"UseHoverEffect",this.local.get(this.__localKeys.Use_Hover_Effect),t.E_DataType.BOOLEAN,{allowPersist:!1,allowReset:!1})),a.push(new t.Property(this,"ShowDifferentialValues",this.local.get(this.__localKeys.Subtract_Initial_Value),t.E_DataType.BOOLEAN,{allowPersist:!1,allowReset:!1}));let r=-1!=this.__timeranges.findIndex(e=>t.TimeConverter.isRelative(e));if(!r)for(const e of this.__timeranges)if(!t.TimerangeValidator.validateTimerangeEndsInFuture(e,this.__ctype,this.__compareInterval)){r=!0;break}a.push(new t.Property(this,"RefreshInterval",this.local.get(this.__localKeys.Refresh_Interval),t.E_DataType.TIME_INTERVAL,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Minute_s),displayName:this.local.get(this.__localKeys.Minute_s)},{value:this.local.get(this.__localKeys.Hour_s),displayName:this.local.get(this.__localKeys.Hour_s)},{value:this.local.get(this.__localKeys.Day_s),displayName:this.local.get(this.__localKeys.Day_s)}],allowPersist:!1,canBeSet:r,allowReset:!1,disabledTooltip:this.local.get(this.__localKeys.Only_Editable_With_Relative_Timerange)})),a.push(new t.Property(this,"BarIntervalWidth",this.local.get(this.__localKeys.Bar_Width),t.E_DataType.TIME_INTERVAL,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Millisecond_s),displayName:this.local.get(this.__localKeys.Millisecond_s)},{value:this.local.get(this.__localKeys.Second_s),displayName:this.local.get(this.__localKeys.Second_s)},{value:this.local.get(this.__localKeys.Second_s),displayName:this.local.get(this.__localKeys.Second_s)},{value:this.local.get(this.__localKeys.Minute_s),displayName:this.local.get(this.__localKeys.Minute_s)},{value:this.local.get(this.__localKeys.Hour_s),displayName:this.local.get(this.__localKeys.Hour_s)},{value:this.local.get(this.__localKeys.Day_s),displayName:this.local.get(this.__localKeys.Day_s)},{value:this.local.get(this.__localKeys.Week_s),displayName:this.local.get(this.__localKeys.Week_s)},{value:this.local.get(this.__localKeys.Month_s),displayName:this.local.get(this.__localKeys.Month_s)},{value:this.local.get(this.__localKeys.Year_s),displayName:this.local.get(this.__localKeys.Year_s)}],allowPersist:!1,canBeSet:this.__ctype===t.E_ChartType.TIMESERIESBARCHART,allowReset:!1,disabledTooltip:this.local.get(this.__localKeys.Only_Editable_In_TS_Barchart)})),a.push(new t.Property(this,"ChartTyp","",t.E_DataType.CONTENTSEPARATOR,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Channels),displayName:this.local.get(this.__localKeys.Channels)}],allowPersist:!1,contentSeparatorAddCallback:this.__onAddChannelConfig()})),a.push(new t.Property(this,"Channels","",t.E_DataType.CHART_CHANNEL_CONFIG,{comboBoxOptions:[{value:JSON.stringify(this.__dataSourceList),displayName:JSON.stringify(this.__dataSourceList)}],allowPersist:!1,allowReset:!1})),a.push(new t.Property(this,"Timeranges","",t.E_DataType.CONTENTSEPARATOR,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Timeranges),displayName:this.local.get(this.__localKeys.Timeranges)}],allowPersist:!1,canBeSet:!1,allowReset:!1,contentSeparatorAddCallback:this.__onAddTimerangeConfig()})),a.push(new t.Property(this,"Timeranges","",t.E_DataType.CHART_TIMERANGE_CONFIG,{allowPersist:!1,allowReset:!1}));const s=this.__ctype===t.E_ChartType.COMPAREYTCHART||this.__ctype===t.E_ChartType.TIMESERIESBARCHART;a.push(new t.Property(this,"ChartTyp","",t.E_DataType.CONTENTSEPARATOR,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Compare_Settings),displayName:this.local.get(this.__localKeys.Compare_Settings)}],allowPersist:!1})),a.push(new t.Property(this,"CompareType",this.local.get(this.__localKeys.Compare_Type),t.E_DataType.COMBOBOX,{comboBoxOptions:[{value:this.local.get(this.__localKeys.CompareType_Absolute),displayName:this.local.get(this.__localKeys.CompareType_Absolute)},{value:this.local.get(this.__localKeys.CompareType_Relative),displayName:this.local.get(this.__localKeys.CompareType_Relative)},{value:this.local.get(this.__localKeys.CompareType_MatchStart),displayName:this.local.get(this.__localKeys.CompareType_MatchStart)},{value:this.local.get(this.__localKeys.CompareType_MatchEnd),displayName:this.local.get(this.__localKeys.CompareType_MatchEnd)}],allowPersist:!1,canBeSet:s,allowReset:!1,disabledTooltip:this.local.get(this.__localKeys.Only_Editable_In_CompareChart)})),a.push(new t.Property(this,"CompareInterval",this.local.get(this.__localKeys.Compare_Interval),t.E_DataType.TIME_INTERVAL,{comboBoxOptions:[{value:this.local.get(this.__localKeys.Millisecond_s),displayName:this.local.get(this.__localKeys.Millisecond_s)},{value:this.local.get(this.__localKeys.Second_s),displayName:this.local.get(this.__localKeys.Second_s)},{value:this.local.get(this.__localKeys.Minute_s),displayName:this.local.get(this.__localKeys.Minute_s)},{value:this.local.get(this.__localKeys.Hour_s),displayName:this.local.get(this.__localKeys.Hour_s)},{value:this.local.get(this.__localKeys.Day_s),displayName:this.local.get(this.__localKeys.Day_s)},{value:this.local.get(this.__localKeys.Week_s),displayName:this.local.get(this.__localKeys.Week_s)},{value:this.local.get(this.__localKeys.Month_s),displayName:this.local.get(this.__localKeys.Month_s)},{value:this.local.get(this.__localKeys.Year_s),displayName:this.local.get(this.__localKeys.Year_s)}],allowPersist:!1,canBeSet:s,allowReset:!1,disabledTooltip:this.local.get(this.__localKeys.Only_Editable_In_CompareChart)})),super.setEditableProperties(a)}__onAddChannelConfig(){return()=>{this.__chartPropertyHandler.appendChannelEntry()()}}__onAddTimerangeConfig(){return()=>{this.__chartPropertyHandler.appendTimerangeEntry()()}}__propertyHandling(a,r){let s=super.__propertyHandling(a,r);if(null!=s)return s;switch(this.__firstCallPropertyHandling&&(null!=this.__chartPropertyHandler&&this.__chartPropertyHandler.clearEvents(),this.__chartPropertyHandler=new t.DataChartPropertyHandler(this,this.__dataSourceList,this.getColors(),this.__elCalendar,(e,t,a,r,s)=>this.__createPopup(e,t,a,r,s),this.local,this.__localKeys),this.__eventListenerManager.addEventListener(this.__chartPropertyHandler,t.DataChartEventNames.onChartPropertyChanged,e=>this.__onChartPropertyChanged(e)),this.__eventListenerManager.addEventListener(this.__chartPropertyHandler,t.DataChartEventNames.onTimerangePropertyChanged,e=>this.__onTimerangePropertyChanged(e)),this.__firstCallPropertyHandling=!1),this.__chartPropertyHandler.timerangeEntries=this.__timeranges,this.__chartPropertyHandler.compareTimerange=this.__ctype==t.E_ChartType.COMPAREYTCHART||this.__ctype==t.E_ChartType.TIMESERIESBARCHART?this.__compareInterval:null,this.__chartPropertyHandler.selectedChannels=this.__channels,this.__chartPropertyHandler.chartType=this.__ctype,a.type){case t.E_DataType.CHART_CHANNEL_CONFIG:let i=e.ValueConverter.toObject(a.value);this.__dataSourceList=JSON.parse(a.options[0].value),this.__chartPropertyHandler.chartDataSources=this.__dataSourceList,s=document.createElement("div"),s.className="tchmi-analytics-chart-channel-config-area";let l=document.createElement("div");l.className="tchmi-analytics-control-add-item-placeholder",l.innerText="No channels configured.",s.appendChild(l);let _=a.value;if(null!=i)for(let e=0;e<_.length;e++)this.__chartPropertyHandler.addChannelEntry(s,_[e]);r.className="";break;case t.E_DataType.CHART_TIMERANGE_CONFIG:s=document.createElement("div"),s.className="tchmi-analytics-chart-timerange-config-area";let o=document.createElement("div");o.className="tchmi-analytics-control-add-item-placeholder",o.innerText="No timeranges configured.",s.appendChild(o),this.__chartPropertyHandler.chartDataSources=this.__dataSourceList;let n=e.ValueConverter.toObject(a.value);if(null!=n)for(let e=0;e<n.length;e++)this.__chartPropertyHandler.addTimerangeEntry(s,n[e],n[e].isVisible);r.className=""}return s}__onChartPropertyChanged(t){const a=t.detail.varEntries;if(t.detail.onlyDetailToggleStateChanged)return void(this.__channels=a);this.__chartPropertyHandler.selectedChannels=a;let r=e.ValueConverter.toString(a),s=this.__editableProperties.find(e=>"Channels"==e.name);this.__customPropSetting=!0,s.value=r,this.__customPropSetting=!1}__onTimerangePropertyChanged(a){const r=a.detail.onlyVisibility,i=a.detail.timeranges;if(a.detail.onlyDetailToggleStateChanged)return void(this.__timeranges=i);let l=e.ValueConverter.toString(i),_=this.__editableProperties.find(e=>"Timeranges"==e.name);if(!this.__onChartTypeSwitchedAutomatically&&i.length>1&&!this.__isCompareChartType(this.__ctype)){this.__ctype===t.E_ChartType.YTCHART?(this.__ctype=t.E_ChartType.COMPAREYTCHART,this.__chartTyp=s.CompareYTChart,this.__createPopup(`${this.local.get(this.__localKeys.Swiched_ChartType_To_Compare_YT_Chart)}`,CustomElements.PopupStatus.INFO,3e3)):this.__ctype===t.E_ChartType.BARCHART&&(this.__ctype=t.E_ChartType.TIMESERIESBARCHART,this.__chartTyp=s.TimeSeriesBarChart,this.__createPopup(`${this.local.get(this.__localKeys.Swiched_ChartType_To_TimeSeries_Bar_Chart)}`,CustomElements.PopupStatus.INFO,3e3)),this.__calculateCompareInterval(),this.__onChartTypeSwitchedAutomatically=!0;const e=$(".tchmi-analytics-control-properties-active"),a=null!=e&&0!=e.length;this.__setProperties(),a&&this.__openPropertyWindow()}this.__customPropSetting=!0,this.__timerangevisibilityChanged=r,_.value=l,r&&this.__dataCharting(),this.__timerangevisibilityChanged=!1,this.__customPropSetting=!1}__processLocalizationReader(){super.__processLocalizationReader(),this.__getApiAccessForDomains();const e=[];e.push(this.local.get(this.__localKeys.January)),e.push(this.local.get(this.__localKeys.February)),e.push(this.local.get(this.__localKeys.March)),e.push(this.local.get(this.__localKeys.April)),e.push(this.local.get(this.__localKeys.May)),e.push(this.local.get(this.__localKeys.June)),e.push(this.local.get(this.__localKeys.July)),e.push(this.local.get(this.__localKeys.August)),e.push(this.local.get(this.__localKeys.September)),e.push(this.local.get(this.__localKeys.October)),e.push(this.local.get(this.__localKeys.November)),e.push(this.local.get(this.__localKeys.December)),this.__elCalendar.fullMonthsAlias=e;const t=[];t.push(this.local.get(this.__localKeys.Monday)),t.push(this.local.get(this.__localKeys.Tuesday)),t.push(this.local.get(this.__localKeys.Wednesday)),t.push(this.local.get(this.__localKeys.Thursday)),t.push(this.local.get(this.__localKeys.Friday)),t.push(this.local.get(this.__localKeys.Saturday)),t.push(this.local.get(this.__localKeys.Sunday)),this.__elCalendar.daysOfWeekAlias=t}__getLocalizationKey(e){return Object.keys(this.local.getLocalization()).find(t=>this.local.getLocalization()[t]==e)}__initSourceManagerPopup(){this.__sourceManagerPopup=e.ControlFactory.createEx("TcHmi.Controls.Analytics.SourceManagerPopup",this.__id+"_SourceManagerPopup",null,this),void 0!==this.__sourceManagerPopup?(this.__elementTemplateRoot.append(this.__sourceManagerPopup.getElement()),this.__sourceManagerPopup.createPopupFnct=(e,t=CustomElements.PopupStatus.INFO,a=1e4,r=null)=>this.__createPopup(e,t,a,!1,r)):this.Log("Could not create SourceManagerPopup-Control.")}__onSourceManager(){null==this.__sourceManagerPopup&&this.__initSourceManagerPopup(),e.TopMostLayer.add(this,this.__sourceManagerPopup.getElement()),this.__sourceManagerPopup.openPopup()}__getApiAccessForDomains(){this.__showDataSources=!1;const t=e.Server.getGroupsOfCurrentUser();null!=t&&(t.some(e=>"Administrators"==e)&&t.some(e=>"__SystemUsers"==e)||t.some(e=>"__SystemAdministrators"==e))&&(this.__showDataSources=!0),this.__initalizeEditArea()}__setBarIntervalWidth(e=!0){this.__barIntervalWidth={rangeValue:0,rangeUnit:""},this.__compareInterval.rangeValue<5&&this.__compareInterval.rangeUnit!==t.TimeIntervalStrings.MilliSecond_s?this.__compareInterval.rangeUnit===t.TimeIntervalStrings.Second_s?(this.__barIntervalWidth.rangeValue=500,this.__barIntervalWidth.rangeUnit=t.TimeIntervalStrings.MilliSecond_s):this.__compareInterval.rangeUnit===t.TimeIntervalStrings.Minute_s?(this.__barIntervalWidth.rangeValue=15,this.__barIntervalWidth.rangeUnit=t.TimeIntervalStrings.Second_s):this.__compareInterval.rangeUnit===t.TimeIntervalStrings.Hour_s?(this.__barIntervalWidth.rangeValue=15,this.__barIntervalWidth.rangeUnit=t.TimeIntervalStrings.Minute_s):this.__compareInterval.rangeUnit===t.TimeIntervalStrings.Day_s?(this.__barIntervalWidth.rangeValue=6,this.__barIntervalWidth.rangeUnit=t.TimeIntervalStrings.Hour_s):this.__compareInterval.rangeUnit===t.TimeIntervalStrings.Week_s||this.__compareInterval.rangeUnit===t.TimeIntervalStrings.Month_s?(this.__barIntervalWidth.rangeValue=1,this.__barIntervalWidth.rangeUnit=t.TimeIntervalStrings.Day_s):this.__compareInterval.rangeUnit===t.TimeIntervalStrings.Year_s&&(this.__barIntervalWidth.rangeValue=2,this.__barIntervalWidth.rangeUnit=t.TimeIntervalStrings.Month_s):this.__compareInterval.rangeUnit===t.TimeIntervalStrings.MilliSecond_s?(this.__compareInterval.rangeValue<10?this.__barIntervalWidth.rangeValue=1:this.__compareInterval.rangeValue<100?this.__barIntervalWidth.rangeValue=10:this.__compareInterval.rangeValue<1e3&&(this.__barIntervalWidth.rangeValue=100),this.__barIntervalWidth.rangeUnit=this.__compareInterval.rangeUnit):(this.__barIntervalWidth.rangeValue=1,this.__barIntervalWidth.rangeUnit=this.__compareInterval.rangeUnit),this.__processBarIntervalWidth(e)}__processCustomEdits(){this.__onChartConfigReceived&&(super.__processCustomEdits("NameAlias"),super.__processCustomEdits("ShowTitle"),super.__processCustomEdits("FontsizeTitle"))}}t.DataChart=a}(a=t.Analytics||(t.Analytics={})),function(e){e.GetLayoutIDWithoutDisplayMode=function(e){return 0===e.length?e:e.slice(0,-3)},e.CreateChartControlID=function(e,t){const a=t.replace(" ","_");return String(e+"_"+a)}}(r=t.IDParser||(t.IDParser={}));class s{}s.YTChart="YTChart",s.BarChart="BarChart",s.CompareYTChart="CompareYTChart",s.TimeSeriesBarChart="TimeSeriesBarChart",s.PieChart="PieChart",s.RingChart="RingChart",s.SingleValueChart="SingleValueChart",t.ChartTypes=s}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("DataChart","TcHmi.Controls.Analytics",TcHmi.Controls.Analytics.DataChart);