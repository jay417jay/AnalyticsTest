var TcHmi;!function(t){let e;!function(e){let i;!function(e){class i extends t.Controls.Analytics.AnalyticsControl{constructor(e,i,s){super(e,i,s),this.__linearGrad="linearGradHistogramMulti",this.__onResized=()=>(t,e)=>{let i=super.__getScaleFactor();0!=this.__hasLicense&&(this.__showReset?this.__elementNameAlias.css("padding-right","16px"):this.__elementNameAlias.css("padding-right","5px"),!0===this.__showTitle?(this.__elementSvg.css("width",280*i),this.__elementSvg.css("height",270*i),this.__elementSvg.css("margin-top",5*i)):(this.__elementSvg.css("width",290*i),this.__elementSvg.css("height",285*i),this.__elementSvg.css("margin-top",10*i)),this.__elementSvg.css("padding-left",5*i),this.__elementSvgUnitButton.css("font-size",14*i),this.__elementSvgUnitButton.css("width",32*i),this.__elementSvgUnitButton.css("height",18*i))},this.__onResolverForInputDataWatchCallback=e=>{!1===this.__isAttached&&this.__suspendObjectResolver("inputData"),e.error===t.Errors.NONE?tchmi_equal(e.value,this.__inputData)||(this.__inputData=e.value||null,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getInputData"]),this.__processInputData()):t.Log.error("[Source=Control, Module=TcHmi.Controls.Analytics.AnalyticsControl, Id="+this.getId()+", Attribute=InputData] Resolving symbols from object failed with error: "+t.Log.buildMessage(e.details))}}__previnit(){super.setEditableProperties([]),super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=310,this.__defaultHeight=310,this.__elementSvg=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg"),this.__elementSvgDefs=this.__elementTemplateRoot.find(".tchmi-histogram-multi-defs"),this.__elementSvgCoordinateSystem=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-line-coordinate-system"),this.__elementSvgBin=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect"),this.__elementSvgBinStroke=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect-stroke"),this.__elementSvgBinValue=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-value"),this.__elementSvgBinLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-label"),this.__elementSvgYAxisLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-y-axis-label"),this.__elementSvgLegendRect=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-rect"),this.__elementSvgLegendText=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-text"),this.__elementSvgUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-multi-unit-button"))}__init(){let t=[new e.Property(this,"ShowOuterBins","Show Outer Bins",e.E_DataType.BOOLEAN),new e.Property(this,"ShowValues","Show Values",e.E_DataType.BOOLEAN),new e.Property(this,"WriteLabelsVertical","Write Labels Vertical",e.E_DataType.BOOLEAN)];super.setEditableProperties(t),super.__init()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}setInputData(e){var i=t.ValueConverter.toObject(e);null===i&&(i=this.getAttributeDefaultValueInternal("InputData"));let s=this.__objectResolvers.get("inputData");s&&(s.watchDestroyer&&s.watchDestroyer(),s.resolver.destroy());let n=new t.Symbol.ObjectResolver(i);this.__objectResolvers.set("inputData",{resolver:n,watchCallback:this.__onResolverForInputDataWatchCallback,watchDestroyer:n.watch(this.__onResolverForInputDataWatchCallback)})}getInputData(){return this.__inputData}__processInputData(){this.__processBinsH()}getSectionsUpperBorders(){return this.__sectionsUpperBorders}setSectionsUpperBorders(e){var i=t.ValueConverter.toObject(e);null===i&&(i=this.getAttributeDefaultValueInternal("SectionsUpperBorders")),i!==this.__sectionsUpperBorders&&(this.__sectionsUpperBorders=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getSectionsUpperBorders"]),this.__processBorders())}getSectionsLowerBorder(){return this.__sectionsLowerBorder}setSectionsLowerBorder(e){var i=t.ValueConverter.toNumber(e);null===i&&(i=this.getAttributeDefaultValueInternal("SectionsLowerBorder")),i!==this.__sectionsLowerBorder&&(this.__sectionsLowerBorder=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getSectionsUpperBorders"]),this.__processBorders())}__processBorders(){if(void 0!==this.__sectionsLowerBorder&&null!==this.__sectionsLowerBorder&&void 0!==this.__sectionsUpperBorders&&null!==this.__sectionsUpperBorders){this.__sectionsBorders=[],this.__sectionsBorders[0]=this.__sectionsLowerBorder;for(var t=1;t<=this.__sectionsUpperBorders.length;t++)this.__sectionsBorders[t]=this.__sectionsUpperBorders[t-1];this.__processBinsH()}}setHistogramUnit(e){var i=t.ValueConverter.toString(e);null!==i?i!==this.__histogramUnit&&(this.__histogramUnit=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getHistogramUnit"]),this.__processBinsH()):i=this.getAttributeDefaultValueInternal("HistogramUnit")}getHistogramUnit(){return this.__histogramUnit}setShowOuterBins(e){var i=t.ValueConverter.toBoolean(e);null===i&&(i=this.getAttributeDefaultValueInternal("ShowOuterBins")),i!==this.__showOuterBins&&(this.__showOuterBins=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowOuterBins"]),this.__processShowOuterBins())}getShowOuterBins(){return this.__showOuterBins}__processShowOuterBins(){this.__processBinsH()}__processBinsH(){if(void 0!==this.__histogramUnit&&void 0!==this.__colorGradient&&void 0!==this.__inputData&&void 0!==this.__sectionsBorders&&void 0!==this.__showOuterBins&&null!==this.__showOuterBins&&null!==this.__writeLabelsVertical&&void 0!==this.__writeLabelsVertical){var t=this.__histogramUnit;if(this.__elementSvgUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-multi-unit-button"),this.__elementSvgUnitButton.length>0&&(t=this.__elementSvgUnitButton[0].innerHTML,this.__histogramUnit=this.__elementSvgUnitButton[0].innerHTML),this.DrawHistogramMulti(t,this.__colorGradient,this.__inputData,this.__sectionsBorders,this.__showOuterBins,this.__writeLabelsVertical),this.__processShowValues(),this.__elementSvgUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-multi-unit-button"),0!==this.__elementSvgUnitButton.length){var e=this;this.__elementSvgUnitButton.on("click",(function(){!function(t){console.log("clickfunction"),t="s"==t?"min":"min"==t?"h":"s";e.__elementSvgUnitButton[0].innerHTML=t,e.setHistogramUnit(t),e.__processColor()}(e.__elementSvgUnitButton[0].innerHTML),console.log("click")}))}}}setShowValues(e){var i=t.ValueConverter.toBoolean(e);null===i&&(i=this.getAttributeDefaultValueInternal("ShowValues")),i!==this.__showValues&&(this.__showValues=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowValues"]),this.__processShowValues())}getShowValues(){return this.__showValues}__processShowValues(){this.__elementSvgBinValue=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-value"),1==this.__showValues?this.__elementSvgBinValue.css("visibility","visible"):this.__elementSvgBinValue.css("visibility","hidden")}setWriteLabelsVertical(e){var i=t.ValueConverter.toBoolean(e);null===i&&(i=this.getAttributeDefaultValueInternal("WriteLabelsVertical")),i!==this.__writeLabelsVertical&&(this.__writeLabelsVertical=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getWriteLabelsVertical"]),this.__processWriteLabelsVertical())}getWriteLabelsVertical(){return this.__writeLabelsVertical}__processWriteLabelsVertical(){this.__processBinsH()}__processColorGradient(){this.__processColor(),this.__processBinsH()}__processColor(){this.__elementSvgBin=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect"),this.__elementSvgBinStroke=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect-stroke"),this.__elementSvgBinValue=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-value"),this.__elementSvgBinLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-label"),this.__elementSvgYAxisLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-y-axis-label"),this.__elementSvgLegendRect=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-rect"),this.__elementSvgLegendText=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-text"),this.__elementSvgUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-multi-unit-button"),this.__elementSvgCoordinateSystem.css("stroke",this.__fontColor),this.__elementSvgYAxisLabel.css("fill",this.__fontColor),this.__elementSvgBinValue.css("fill",this.__fontColor),this.__elementSvgBinLabel.css("fill",this.__fontColor),this.__elementSvgLegendText.css("fill",this.__fontColor),this.__elementSvgLegendRect.css("stroke",this.__controlColorDark),this.__elementSvgBin.css("stroke","none"),this.__elementSvgBinStroke.css("stroke",this.__controlColorDark),this.__elementSvgBinStroke.css("fill","none"),this.__elementSvgUnitButton.css("color",this.__fontColor),void 0!==this.__colorGradient&&void 0!==this.__controlColorMiddle&&null==this.__inputData&&(this.CreateLinearGradient(this.hexToRgbA(this.__controlColorMiddle),this.__elementSvgDefs[0],this.__colorGradient,this.__linearGrad+this.__secureId+"Grey"),this.__elementSvgBin.css("fill","url(#"+this.__linearGrad+this.__secureId+"Grey)"))}DrawHistogramMulti(e,i,s,n,r,l){let o=1,_=0;var h=0;if(void 0!==s){h=s.length;var a=[],m=[],g=[],u=[];let W=this.getColors();for(let t=0;t<s.length;t++){var c=s[t].binColor.color;a[t]=""!==c&&null!=c?this.rgbaToHex(c):W[t%15];for(var d=[],v=[],p=0;p<s[t].data.length;p++){var S=s[t].data[p];if("min"==e){var b=S/60;d[p]=b;var f=(L=Math.floor(S/60)).toString();L<10&&(f="0"+L.toString());var B=(T=S%60).toString();T<10&&(B="0"+T.toString()),v[p]=f+":"+B}else if("h"==e){b=S/3600;d[p]=b;var w=Math.floor(S/3600);S%=3600;var x=w.toString();w<10&&(x="0"+w.toString());var L;f=(L=Math.floor(S/60)).toString();L<10&&(f="0"+L.toString());var T;B=(T=S%60).toString();T<10&&(B="0"+T.toString()),v[p]=x+":"+f+":"+B}else d[p]=S,v[p]=S}!1===r&&(d=d.slice(1,d.length-1)),m[t]=d,g[t]=v,u[t]=Math.max.apply(Math,d),u[t]<1&&(u[t]=1)}var C=n.length+1;let F=a;var A=C;!1===r&&(A=C-2),_=Math.max.apply(Math,u);var R=212/A;let j=_,Y=(R-5)/h;for(this.__elementSvgBin=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect");this.__elementSvgBin.length>0;)this.__elementSvgBin[0].parentNode.removeChild(this.__elementSvgBin[0]),this.__elementSvgBin=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect");for(this.__elementSvgBinStroke=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect-stroke");this.__elementSvgBinStroke.length>0;)this.__elementSvgBinStroke[0].parentNode.removeChild(this.__elementSvgBinStroke[0]),this.__elementSvgBinStroke=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-bin-rect-stroke");for(this.__elementSvgBinValue=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-value");this.__elementSvgBinValue.length>0;)this.__elementSvgBinValue[0].parentNode.removeChild(this.__elementSvgBinValue[0]),this.__elementSvgBinValue=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-value");for(this.__elementSvgBinLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-label");this.__elementSvgBinLabel.length>0;)this.__elementSvgBinLabel[0].parentNode.removeChild(this.__elementSvgBinLabel[0]),this.__elementSvgBinLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-label");for(this.__elementSvgLegendRect=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-rect");this.__elementSvgLegendRect.length>0;)this.__elementSvgLegendRect[0].parentNode.removeChild(this.__elementSvgLegendRect[0]),this.__elementSvgLegendRect=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-rect");for(this.__elementSvgLegendText=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-text");this.__elementSvgLegendText.length>0;)this.__elementSvgLegendText[0].parentNode.removeChild(this.__elementSvgLegendText[0]),this.__elementSvgLegendText=this.__elementTemplateRoot.find(".tchmi-histogram-multi-svg-legend-text");for(this.__elementSvgYAxisLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-y-axis-label");this.__elementSvgYAxisLabel.length>0;)this.__elementSvgYAxisLabel[0].parentNode.removeChild(this.__elementSvgYAxisLabel[0]),this.__elementSvgYAxisLabel=this.__elementTemplateRoot.find(".tchmi-histogram-multi-y-axis-label");for(this.__elementSvgUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-multi-unit-button");this.__elementSvgUnitButton.length>0;)this.__elementSvgUnitButton[0].parentNode.removeChild(this.__elementSvgUnitButton[0]),this.__elementSvgUnitButton=this.__elementTemplateRoot.find(".tchmi-histogram-multi-unit-button");for(let e=0;e<A;e++){var V="";V=!0===r?0===e?"< "+n[0]:e===A-1?">= "+n[n.length-1]:"["+n[e-1]+".."+n[e]+")":"["+n[e]+".."+n[e+1]+")";let s=e*R+5;this.__elementSvgDefs[0].innerHTML="";for(let n=0;n<h;n++){let r=0;if(m.length>n){var y=m[n];void 0!==y?y.length>e&&(r=y[e]):r=0}let l=189*r/j;var U=document.createElementNS("http://www.w3.org/2000/svg","rect");U.classList.add("tchmi-histogram-multi-svg-bin-rect-stroke"),U.setAttribute("x",56+s+Y*n+"px"),U.setAttribute("y","10px"),U.setAttribute("width",Y-.5+"px"),U.setAttribute("height","190px");var D=document.createElementNS("http://www.w3.org/2000/svg","rect");D.classList.add("tchmi-histogram-multi-svg-bin-rect");var E="#acacac";F.length>=n&&(E=F[n]),this.CreateLinearGradient(this.hexToRgbA(E),this.__elementSvgDefs[0],i,this.__linearGrad+this.__secureId+n.toString()),D.setAttribute("fill","url(#"+this.__linearGrad+this.__secureId+n.toString()+")"),D.setAttribute("x",56+s+Y*n+.5+"px"),D.setAttribute("y",189-l+10+.5+"px"),D.setAttribute("width",Y-1.5+"px"),D.setAttribute("height",l+"px"),this.__elementSvg[0].insertAdjacentElement("afterbegin",D),this.__elementSvg[0].insertAdjacentElement("afterbegin",U);var H=g[n][e];let o=14;var k=document.createElement("canvas").getContext("2d");k.font="bold "+o.toString()+"px sans-serif";let _=k.measureText(H).width;for(;_>Y&&o>4;)o-=.5,k.font="bold "+t.ValueConverter.toString(o)+"px sans-serif",_=k.measureText(H).width;var I=document.createElementNS("http://www.w3.org/2000/svg","text");I.classList.add("tchmi-histogram-multi-svg-value"),I.setAttribute("x",56+s+Y*n+Y/2-.5+"px"),I.textContent=H,I.setAttribute("font-size",o+"px"),o+5<l?I.setAttribute("y",189-l+o+10+"px"):I.setAttribute("y",189-l+10+"px"),this.__elementSvg[0].insertAdjacentElement("beforeend",I)}-1!==V.toString().search("undefined")&&(V="");var M=document.createElementNS("http://www.w3.org/2000/svg","text");M.classList.add("tchmi-histogram-multi-svg-label"),M.textContent=V,M.setAttribute("x",56+s+R/2-4+"px"),M.setAttribute("y","217px");let o=14;if(k.font="bold "+o+"px sans-serif",!0===l){for(;k.measureText(V).width>40;)o-=.5,k.font="bold "+o+"px sans-serif";M.setAttribute("text-anchor","end");var O="rotate(-90,"+(56+s+R/2-o/2)+", 209)";M.setAttribute("transform",O)}else{for(;k.measureText(V).width>R-2&&o>2;)o-=.5,k.font="bold "+o+"px sans-serif";M.setAttribute("text-anchor","middle")}M.setAttribute("font-size",o+"px"),this.__elementSvg[0].appendChild(M)}let $=Math.abs(_),z=[];if($<=6)for(let t=0;t<=$;t++)z.push(t);else if($<=10)for(let t=0;t<=$;t+=2)z.push(t);else if($<=20)for(let t=0;t<=$;t+=4)z.push(t);else{$-=$%4;let t=$/4;for(let e=0;e<=4;e++){let i=e*t;i>$&&(i=$),z.push(i)}}let q=z.length-1;o=z.sort((function(t,e){return e.toString().length-t.toString().length}))[0].toString().length;for(let t=0;t<=q;t++){var N=z[t];let e=189-189*z[t]/$,i=30/o*1.75;i>14&&(i=14);var G=document.createElementNS("http://www.w3.org/2000/svg","text");G.classList.add("tchmi-histogram-multi-y-axis-label"),G.setAttribute("font-size",i+"px"),G.setAttribute("text-anchor","start"),G.textContent=N.toString(),G.setAttribute("x","2px"),G.setAttribute("y",e+10+i/2+"px"),this.__elementSvg[0].appendChild(G)}var P=document.createElement("button");P.classList.add("tchmi-histogram-multi-unit-button"),P.innerText=e,this.__elementTemplateRoot[0].appendChild(P)}this.__elementSvgCoordinateSystem[0].setAttribute("d","M 56,201.5 L278,201.5 L271,194.5 L278,201.5 L271,208.5");this.__elementSvgCoordinateSystem[1].setAttribute("d","M 56,201.5 L56,2 L63,9 L56,2 L49,9");for(p=0;p<h;p++){var W=document.createElementNS("http://www.w3.org/2000/svg","rect");W.classList.add("tchmi-histogram-multi-svg-legend-rect"),void 0!==a&&this.CreateLinearGradient(this.hexToRgbA(a[p]),this.__elementSvgDefs[0],i,this.__linearGrad+this.__secureId+p.toString()),W.setAttribute("fill","url(#"+this.__linearGrad+this.__secureId+p.toString()+")"),W.setAttribute("x",56+212*p/h+"px"),W.setAttribute("y","250px"),W.setAttribute("width","15px"),W.setAttribute("height","12px"),this.__elementSvg[0].appendChild(W);var F=document.createElementNS("http://www.w3.org/2000/svg","text");F.classList.add("tchmi-histogram-multi-svg-legend-text"),F.setAttribute("x",56+212*p/h+20+"px"),F.setAttribute("y","261px"),F.textContent="T"+(p+1).toString(),this.__elementSvg[0].appendChild(F)}this.__processColor()}}e.HistogramMulti=i}(i=e.Analytics||(e.Analytics={})),e.registerEx("HistogramMulti","TcHmi.Controls.Analytics",i.HistogramMulti)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));