var TcHmi;!function(t){let e;!function(e){let i;!function(e){class i extends t.Controls.Analytics.AnalyticsControl{constructor(t,i,s){super(t,i,s),this.__linearGrad="linearGradAverageChart",this.__onResized=()=>(t,i)=>{const s=super.__onResizedBase(t,i);if(null===s||!s.valid)return;let a=this.__fontSize;this.__autoFontSize&&(a=20*s.default);let _=this.__showLastEvents?1.3:1.4;if(this.__showActualValueText||(_+=.1),s.vpHeight>.9*s.vpWidth&&(_+=(s.vpHeight-.9*s.vpWidth)/s.vpHeight),s.vpWidth>2*s.vpHeight){const t=(s.vpWidth-2*s.vpHeight)/s.vpWidth;_+=t;let e=40;this.__showLastEvents&&(e-=20),this.__showActualValueText&&(e-=15),this.__showLastEvents!==this.__showActualValueText&&(e-=6),e*=s.height,e<1&&(e=1),a+=t*e}this.__elTemplateContainer.css("font-size",a);let n=250*_*s.default;n>s.vpWidth&&(n=s.vpWidth);let l=200*_*s.default;l>s.vpHeight&&(l=s.vpHeight),this.__elementSvg.css("width",n),this.__elementSvg.css("height",l),this.__showTitle?this.__elTemplateContainer.css("padding-top",e.Str.em(1)):this.__elTemplateContainer.css("padding-top",null),s.vpHeight<=100&&this.__elementSvg.css("float","relative")}}__previnit(){super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=470,this.__defaultHeight=310,this.__elementMinAlias=this.__elementTemplateRoot.find(".tchmi-average-chart-min-alias"),this.__elementMaxAlias=this.__elementTemplateRoot.find(".tchmi-average-chart-max-alias"),this.__elementAvgAlias=this.__elementTemplateRoot.find(".tchmi-average-chart-avg-alias"),this.__elementActualValueAlias=this.__elementTemplateRoot.find(".tchmi-average-chart-actual-value-alias"),this.__elementMin=this.__elementTemplateRoot.find(".tchmi-average-chart-min"),this.__elementMax=this.__elementTemplateRoot.find(".tchmi-average-chart-max"),this.__elementAvg=this.__elementTemplateRoot.find(".tchmi-average-chart-avg"),this.__elementActualValue=this.__elementTemplateRoot.find(".tchmi-average-chart-actual-value"),this.__elementSvg=this.__elementTemplateRoot.find(".tchmi-average-chart-svg"),this.__elementSvgDefs=this.__elementTemplateRoot.find(".tchmi-average-chart-defs"),this.__elementSvgChart=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-chart"),this.__elementSvgChartMinLine=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-min-line"),this.__elementSvgChartMaxLine=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-max-line"),this.__elementSvgChartAvgLine=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-avg-line"),this.__elementSvgChartCurLine=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-cur-line"),this.__elementSvgChartMinText=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-text-min"),this.__elementSvgChartMaxText=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-text-max"),this.__elementSvgChartAvgText=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-text-avg"),this.__elementSvgChartCurText=this.__elementTemplateRoot.find(".tchmi-average-chart-svg-text-cur"),this.__elementAvgTest=this.__elementTemplateRoot.find(".tchmi-average-chart-avg-test"),this.__elementTextGroup=this.__elementTemplateRoot.find(".tchmi-average-chart-text-group-values"),this.__elementTextAlias=this.__elementTemplateRoot.find(".tchmi-average-chart-text-group-alias-values"),this.__elementContainer=this.__elementTemplateRoot.find(".tchmi-average-chart-text-group-container"),this.__elementLastEvents=this.__elementTemplateRoot.find(".tchmi-average-chart-last-events"),this.__elementLastMin=this.__elementTemplateRoot.find(".tchmi-average-chart-last-min"),this.__elementLastMax=this.__elementTemplateRoot.find(".tchmi-average-chart-last-max"))}__init(){let t=[new e.Property(this,"AmountDecimals","Amount Decimals",e.E_DataType.UINTEGER),new e.Property(this,"ShowActualValue","Show Actual Value",e.E_DataType.BOOLEAN),new e.Property(this,"ShowActualValueText","Show Actual Value Text",e.E_DataType.BOOLEAN),new e.Property(this,"ShowLastEvents","Show Last Events",e.E_DataType.BOOLEAN),new e.Property(this,"ShowMilliSeconds","Show Milliseconds",e.E_DataType.BOOLEAN)];super.setEditableProperties(t),super.__init()}__attach(){super.__attach()}__detach(){super.__detach()}destroy(){this.__keepAlive||super.destroy()}setMonthAlias(e){var i=t.ValueConverter.toString(e);null===i&&(i=this.getAttributeDefaultValueInternal("MonthAlias")),i!==this.__monthAlias&&(this.__monthAlias=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMonthAlias"]),this.__processMonthAlias())}getMonthAlias(){return this.__monthAlias}__processMonthAlias(){e.DCTimestruct.monthAlias=this.__monthAlias,this.__processLastMax(),this.__processLastMin()}setMinAlias(e){var i=t.ValueConverter.toString(e);null===i&&(i=this.getAttributeDefaultValueInternal("MinAlias")),i!==this.__minAlias&&(this.__minAlias=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMinAlias"]),this.__processMinAlias())}getMinAlias(){return this.__minAlias}__processMinAlias(){void 0!==this.__minAlias&&null!==this.__minAlias&&this.__elementMinAlias.text(this.__minAlias),this.__processLastMin()}setMaxAlias(e){var i=t.ValueConverter.toString(e);null===i&&(i=this.getAttributeDefaultValueInternal("MaxAlias")),i!==this.__maxAlias&&(this.__maxAlias=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMaxAlias"]),this.__processMaxAlias())}getMaxAlias(){return this.__maxAlias}__processMaxAlias(){void 0!==this.__maxAlias&&null!==this.__maxAlias&&this.__elementMaxAlias.text(this.__maxAlias),this.__processLastMax()}setAvgAlias(e){var i=t.ValueConverter.toString(e);null===i&&(i=this.getAttributeDefaultValueInternal("AvgAlias")),i!==this.__avgAlias&&(this.__avgAlias=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getAvgAlias"]),this.__processAvgAlias())}getAvgAlias(){return this.__avgAlias}__processAvgAlias(){void 0!==this.__avgAlias&&null!==this.__avgAlias&&this.__elementAvgAlias.text(this.__avgAlias)}setActualValueAlias(e){var i=t.ValueConverter.toString(e);null===i&&(i=this.getAttributeDefaultValueInternal("ActualValueAlias")),i!==this.__actualValueAlias&&(this.__actualValueAlias=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getActualValueAlias"]),this.__processActualValueAlias())}getActualValueAlias(){return this.__actualValueAlias}__processActualValueAlias(){void 0!==this.__actualValueAlias&&null!==this.__actualValueAlias&&this.__elementActualValueAlias.text(this.__actualValueAlias)}__processAmountDecimals(){super.__processAmountDecimals(),this.__processMax(),this.__processMin(),this.__processAvg(),this.__processActualValue(),this.__processChart()}setShowActualValue(e){var i=t.ValueConverter.toBoolean(e);null===i&&(i=this.getAttributeDefaultValueInternal("ShowActualValue")),i!==this.__showActualValue&&(this.__showActualValue=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowActualValue"]),this.__processShowActualValue())}getShowActualValue(){return this.__showActualValue}__processShowActualValue(){this.__processChart()}setShowActualValueText(e){var i=t.ValueConverter.toBoolean(e);null===i&&(i=this.getAttributeDefaultValueInternal("ShowActualValueText")),i!==this.__showActualValueText&&(this.__showActualValueText=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowActualValueText"]),this.__processShowActualValueText())}getShowActualValueText(){return this.__showActualValueText}__processShowActualValueText(){this.__elementActualValue.toggleClass("tchmi-analytics-collapse",!this.__showActualValueText),this.__elementActualValueAlias.toggleClass("tchmi-analytics-collapse",!this.__showActualValueText),t.EventProvider.raise(`${this.__id}.onResized`,null)}setMin(e){var i=t.ValueConverter.toNumber(e);null===i&&(i=this.getAttributeDefaultValueInternal("Min")),i!==this.__min&&(this.__min=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMin"]),this.__processMin())}getMin(){return this.__min}__processMin(){if(null!=this.__min){let t=this.getTrimmedNumber(this.__min);this.__elementMin.text(t),this.__processChart()}}setMax(e){var i=t.ValueConverter.toNumber(e);null===i&&(i=this.getAttributeDefaultValueInternal("Max")),i!==this.__max&&(this.__max=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMax"]),this.__processMax())}getMax(){return this.__max}__processMax(){if(null!=this.__max){let t=this.getTrimmedNumber(this.__max);this.__elementMax.text(t),this.__processChart()}}setAvg(e){var i=t.ValueConverter.toNumber(e);null===i&&(i=this.getAttributeDefaultValueInternal("Avg")),i!==this.__avg&&(this.__avg=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getAvg"]),this.__processAvg())}getAvg(){return this.__avg}__processAvg(){if(null!=this.__avg){let t=this.getTrimmedNumber(this.__avg);this.__elementAvg.text(t),this.__processChart()}}setActualValue(e){var i=t.ValueConverter.toNumber(e);null===i&&(i=this.getAttributeDefaultValueInternal("ActualValue")),i!==this.__actualValue&&(this.__actualValue=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getActualValue"]),this.__processActualValue())}getActualValue(){return this.__actualValue}__processActualValue(){if(null!=this.__actualValue){let t=this.getTrimmedNumber(this.__actualValue);this.__elementActualValue.text(t),this.__processChart()}}__processColorGradient(){this.__processColor()}__processColor(){this.__elementSvgChart.css("stroke",this.__fontColor),this.__elementSvgChart.css("fill","none"),this.__elementSvgDefs[0].innerHTML="",void 0!==this.__colorGradient&&void 0!==this.__fontColor&&(this.CreateLinearGradient(this.hexToRgbA(this.__fontColor),this.__elementSvgDefs[0],this.__colorGradient,this.__linearGrad+this.__secureId),this.__elementSvgDefs[0].children[0].setAttribute("y2","-10%"),this.__elementSvgChart.css("stroke","url(#"+this.__linearGrad+this.__secureId+")")),this.__elementSvgChartMinLine.css("stroke",this.__fontColor),this.__elementSvgChartMaxLine.css("stroke",this.__fontColor),this.__elementSvgChartAvgLine.css("stroke",this.__controlColorDark),this.__elementSvgChartCurLine.css("stroke","#088a08"),this.__elementSvgChartMinText.css("fill",this.__fontColor),this.__elementSvgChartMaxText.css("fill",this.__fontColor),this.__elementSvgChartAvgText.css("fill",this.__controlColorDark),this.__elementSvgChartCurText.css("fill","#088a08")}__processChart(){null!=this.__showActualValue&&null!=this.__min&&null!=this.__max&&null!=this.__avg&&null!=this.__actualValue&&this.DrawAverageChart(this.__min,this.__max,this.__avg,this.__actualValue,this.__showActualValue)}setShowMilliSeconds(e){var i=t.ValueConverter.toBoolean(e);null===i&&(i=this.getAttributeDefaultValueInternal("ShowMilliSeconds")),i!==this.__showMilliSeconds&&(this.__showMilliSeconds=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowMilliSeconds"]),this.__processShowMilliSeconds())}getShowMilliSeconds(){return this.__showMilliSeconds}__processShowMilliSeconds(){this.__processLastMin(),this.__processLastMax()}setShowLastEvents(e){var i=t.ValueConverter.toBoolean(e);null!==i?i!==this.__showLastEvents&&(this.__showLastEvents=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowLastEvents"]),this.__processShowLastEvents()):i=this.getAttributeDefaultValueInternal("ShowLastEvents")}getShowLastEvents(){return this.__showLastEvents}setShowBoundsWarning(e){var i=t.ValueConverter.toBoolean(e);null===i&&(i=this.getAttributeDefaultValueInternal("ShowAvgBoundsWarning")),i!==this.__showBoundsWarning&&(this.__showBoundsWarning=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowBoundsWarning"]))}getShowAvgBoundsWarning(){return this.__showBoundsWarning}setLastMin(e){var i=t.ValueConverter.toObject(e);null===i&&(i=this.getAttributeDefaultValueInternal("LastMin")),JSON.stringify(i)!==JSON.stringify(this.__lastMin)&&(this.__lastMin=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getLastMin"]),this.__processLastMin())}getLastMin(){return this.__lastMin}setLastMax(e){var i=t.ValueConverter.toObject(e);null===i&&(i=this.getAttributeDefaultValueInternal("LastMax")),JSON.stringify(i)!==JSON.stringify(this.__lastMax)&&(this.__lastMax=i,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getLastMax"]),this.__processLastMax())}getLastMax(){return this.__lastMax}__processShowLastEvents(){this.__showLastEvents?(this.__elementLastMax.css("display","block"),this.__elementLastMin.css("display","block")):(this.__elementLastMax.css("display","none"),this.__elementLastMin.css("display","none")),t.EventProvider.raise(`${this.__id}.onResized`,null)}__processLastMin(){void 0!==this.__lastMin&&void 0!==this.__monthAlias&&void 0!==this.__showMilliSeconds&&null!==this.__showMilliSeconds&&null!==this.__lastMin&&null!==this.__monthAlias&&(this.__elementLastMin[0].innerHTML=this.__minAlias+": &nbsp"+this.DateTimeConverter(this.__lastMin,this.__monthAlias,this.__showMilliSeconds))}__processLastMax(){void 0!==this.__lastMax&&void 0!==this.__monthAlias&&void 0!==this.__showMilliSeconds&&null!==this.__showMilliSeconds&&null!==this.__lastMax&&null!==this.__monthAlias&&(this.__elementLastMax[0].innerHTML=this.__maxAlias+": "+this.DateTimeConverter(this.__lastMax,this.__monthAlias,this.__showMilliSeconds))}DrawAverageChart(t,e,i,s,a){this.__showBoundsWarning?s<t||s>e?super.drawWarning("Configuration is invalid. Actual value is out of Min-Max range."):i<t||i>e?super.drawWarning("Configuration is invalid. Average value is out of Min-Max range."):super.removeWarning():super.removeWarning();let _=5,n=245,l=175;var h="M"+_+",156 L29,"+l+" L221, 25 L"+n+",44";this.__elementSvgChart[0].setAttribute("d",h);var r=this.getTrimmedNumber(t),o=this.getTrimmedNumber(e),u=this.getTrimmedNumber(i),g=this.getTrimmedNumber(s);this.__elementSvgChartMinLine[0].setAttribute("x1",_.toString()+"px"),this.__elementSvgChartMinLine[0].setAttribute("y1",180..toString()+"px"),this.__elementSvgChartMinLine[0].setAttribute("x2",(29-_+29).toString()+"px"),this.__elementSvgChartMinLine[0].setAttribute("y2",180..toString()+"px"),this.__elementSvgChartMaxLine[0].setAttribute("x1",(221-(n-221)).toString()+"px"),this.__elementSvgChartMaxLine[0].setAttribute("y1",20..toString()+"px"),this.__elementSvgChartMaxLine[0].setAttribute("x2",n.toString()+"px"),this.__elementSvgChartMaxLine[0].setAttribute("y2",20..toString()+"px");let v=180;e-t>0&&(v=e-i>=0?160*(e-i)/(e-t)+20:20);let c,m=Math.abs(150)/Math.abs(-192);c=i>=e?221:i<=t?29:(l-v)/m+29,this.__elementSvgChartAvgLine[0].setAttribute("x1",(c-25).toString()+"px"),this.__elementSvgChartAvgLine[0].setAttribute("y1",v.toString()+"px"),this.__elementSvgChartAvgLine[0].setAttribute("x2",(c+25).toString()+"px"),this.__elementSvgChartAvgLine[0].setAttribute("y2",v.toString()+"px"),this.__elementSvgChartMinText.css("text-anchor","start"),this.__elementSvgChartMinText[0].textContent=r,this.__elementSvgChartMinText[0].setAttribute("x",(0).toString()+"px"),this.__elementSvgChartMinText[0].setAttribute("y",197..toString()+"px");var A=S(29-_+29+40,r);this.__elementSvgChartMinText.css("font-size",A.toString()+"px"),this.__elementSvgChartMaxText.css("text-anchor","end"),this.__elementSvgChartMaxText[0].textContent=o,this.__elementSvgChartMaxText[0].setAttribute("x",(n+3).toString()+"px"),this.__elementSvgChartMaxText[0].setAttribute("y",15..toString()+"px");var x=S(29-_+29,o);if(this.__elementSvgChartMaxText.css("font-size",x.toString()+"px"),void 0===this.__positionRight&&(this.__positionRight=!0),e-.4*(e-t)/2>i?this.__positionRight=!0:e-.3*(e-t)/2<i&&(this.__positionRight=!1),this.__elementSvgChartAvgText[0].textContent=u,this.__elementSvgChartAvgText[0].setAttribute("y",(v+4).toString()+"px"),this.__positionRight){this.__elementSvgChartAvgText.css("text-anchor","start"),this.__elementSvgChartAvgText[0].setAttribute("x",(c+30).toString()+"px");var d=S(n-(c+30),u);this.__elementSvgChartAvgText.css("font-size",d.toString()+"px")}else{this.__elementSvgChartAvgText.css("text-anchor","end"),this.__elementSvgChartAvgText[0].setAttribute("x",(c-30).toString()+"px");d=S(c-30-_,u);this.__elementSvgChartAvgText.css("font-size",d.toString()+"px")}if(void 0===this.__positionRight&&(this.__positionRight=!0),e-1.7*(e-t)/2>s?this.__positionRight=!0:e-1.6*(e-t)/2<s&&(this.__positionRight=!1),a){this.__elementSvgChartCurLine.css("visibility","visible"),this.__elementSvgChartCurText.css("visibility","visible");let i,a=180;if(e-t>0&&(a=e-s>=0?160*(e-s)/(e-t)+20:20),i=s>=e?221:s<=t?29:(l-a)/m+29,this.__elementSvgChartCurLine[0].setAttribute("x1",(i-25).toString()+"px"),this.__elementSvgChartCurLine[0].setAttribute("y1",a.toString()+"px"),this.__elementSvgChartCurLine[0].setAttribute("x2",(i+25).toString()+"px"),this.__elementSvgChartCurLine[0].setAttribute("y2",a.toString()+"px"),s<t&&(a=193),s>e&&(a=19),this.__elementSvgChartCurText[0].textContent=g,this.__elementSvgChartCurText[0].setAttribute("y",(a+4).toString()+"px"),this.__positionRight){this.__elementSvgChartCurText.css("text-anchor","start"),this.__elementSvgChartCurText[0].setAttribute("x",(i+30).toString()+"px");var p=S(n-(i+30),g);this.__elementSvgChartCurText.css("font-size",p.toString()+"px")}else{this.__elementSvgChartCurText.css("text-anchor","end"),this.__elementSvgChartCurText[0].setAttribute("x",(i-30).toString()+"px");p=S(i-30-_,g);this.__elementSvgChartCurText.css("font-size",p.toString()+"px")}}else this.__elementSvgChartCurLine.css("visibility","hidden"),this.__elementSvgChartCurText.css("visibility","hidden");function S(t,e){if(t<0)s=0;else for(var i=200,s=16;i>t&&s>4;){var a=document.createElement("canvas").getContext("2d");a.font="bold "+s.toString()+"px sans-serif",i=a.measureText(e).width,s-=2}return s}}}e.AverageChart=i}(i=e.Analytics||(e.Analytics={})),e.registerEx("AverageChart","TcHmi.Controls.Analytics",i.AverageChart)}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));