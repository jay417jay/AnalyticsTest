var TcHmi;!function(e){!function(t){!function(t){class s extends e.Controls.Helpers.Popup{constructor(t,s){if(super(t),this.__showUsermanagementButtons={editUser:!1,userManagement:!1,contentPermissions:!1,dataSourceManagement:!1},this.__menuControl=s,this.__elementButtons=this.__element.getElementsByClassName("TcHmi_Controls_Helpers_Popup-content")[0],!this.__elementButtons)throw new Error("Invalid Template.html");this.__elementButtons.classList.add("tchmi-analytics-menu-popup-content");const o=e.Server.getCurrentUser(),r=null!=o?o:"unkown";this.__applyTextToElement("headerText",`${this.__menuControl.getHelloAlias()} ${r}`,this.__elementHeader),this.setCloseButton(!0),this.__getApiAccessForDomains(),setTimeout(()=>{this.__processUserManagementPopup()},15)}__performPromptAction(e){}setUserPermissionAlias(t){var s=e.ValueConverter.toString(t);s!==this.__userPermissionAlias&&(this.__userPermissionAlias=s,this.__processUserPermissionAlias())}getUserPermissionAlias(){this.__userPermissionAlias}__processUserPermissionAlias(){null!=this.__userPermissionsButton&&this.__userPermissionsButton.setText(this.__userPermissionAlias)}setSourceManagerAlias(t){var s=e.ValueConverter.toString(t);s!==this.__sourceManagerAlias&&(this.__sourceManagerAlias=s,this.__processSourceManagerAlias())}getSourceManagerAlias(){this.__sourceManagerAlias}__processSourceManagerAlias(){null!=this.__sourceManagerButton&&this.__sourceManagerButton.setText(this.__sourceManagerAlias)}setLayoutControllerAlias(t){var s=e.ValueConverter.toString(t);s!==this.__layoutControllerAlias&&(this.__layoutControllerAlias=s,this.__processLayoutControllerAlias())}getLayoutControllerAlias(){return this.__layoutControllerAlias}__processLayoutControllerAlias(){null!=this.__layoutControllersButton&&this.__layoutControllersButton.setText(this.__layoutControllerAlias)}__createButtons(){var t,s,o,r,n,i,a,_,l,u,m,h,d;null===(t=this.__elementFeedback)||void 0===t||t.remove(),this.__elementFeedback=void 0;let c=!0;this.__menuControl.getAllowSwitchUser()?(void 0===e.Controls.get(this.__parentControl.getId()+".SwitchUser")&&(this.__switchUserButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".SwitchUser",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::Switch user%/l%"},this.__parentControl),this.__switchUserButton&&(this.__destroyers.push(e.EventProvider.register(this.__parentControl.getId()+".SwitchUser.onPressed",this.__onSwitchUser())),this.__elementButtons.append(this.__switchUserButton.getElement()[0]))),c=!1,null===(s=this.__switchUserButton)||void 0===s||s.getElement().removeClass("not-displayed")):null===(o=this.__switchUserButton)||void 0===o||o.getElement().addClass("not-displayed"),this.__showUsermanagementButtons.editUser?(void 0===e.Controls.get(this.__parentControl.getId()+".EditUserProperties")&&(this.__editUserPropertiesButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".EditUserProperties",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::Edit user properties%/l%"},this.__parentControl),this.__editUserPropertiesButton&&(this.__destroyers.push(e.EventProvider.register(this.__parentControl.getId()+".EditUserProperties.onPressed",this.__onEditUserProperties())),this.__elementButtons.append(this.__editUserPropertiesButton.getElement()[0]))),c=!1,null===(r=this.__editUserPropertiesButton)||void 0===r||r.getElement().removeClass("not-displayed")):null===(n=this.__editUserPropertiesButton)||void 0===n||n.getElement().addClass("not-displayed"),this.__showUsermanagementButtons.userManagement?(void 0===e.Controls.get(this.__parentControl.getId()+".UserManagement")&&(this.__manageUserGroupsButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".UserManagement",{"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiUserManagement::User management%/l%"},this.__parentControl),this.__manageUserGroupsButton&&(this.__destroyers.push(e.EventProvider.register(this.__parentControl.getId()+".UserManagement.onPressed",this.__onUserManagement())),c=!1,this.__elementButtons.append(this.__manageUserGroupsButton.getElement()[0]))),c=!1,null===(i=this.__manageUserGroupsButton)||void 0===i||i.getElement().removeClass("not-displayed")):null===(a=this.__manageUserGroupsButton)||void 0===a||a.getElement().addClass("not-displayed"),this.__showUsermanagementButtons.contentPermissions?(void 0===e.Controls.get(this.__parentControl.getId()+".UserPermissions")&&(this.__userPermissionsButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".UserPermissions",{"data-tchmi-text":this.__userPermissionAlias},this.__parentControl),this.__userPermissionsButton&&(this.__destroyers.push(e.EventProvider.register(this.__parentControl.getId()+".UserPermissions.onPressed",this.__onPermissions())),c=!1,this.__elementButtons.append(this.__userPermissionsButton.getElement()[0]))),c=!1,null===(_=this.__userPermissionsButton)||void 0===_||_.getElement().removeClass("not-displayed")):null===(l=this.__userPermissionsButton)||void 0===l||l.getElement().addClass("not-displayed"),this.__showUsermanagementButtons.dataSourceManagement?(void 0===e.Controls.get(this.__parentControl.getId()+".SourceManager")&&(this.__sourceManagerButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".SourceManager",{"data-tchmi-text":this.__sourceManagerAlias},this.__parentControl),this.__sourceManagerButton&&(this.__destroyers.push(e.EventProvider.register(this.__parentControl.getId()+".SourceManager.onPressed",this.__onSourceManager())),c=!1,this.__elementButtons.append(this.__sourceManagerButton.getElement()[0]))),c=!1,null===(u=this.__sourceManagerButton)||void 0===u||u.getElement().removeClass("not-displayed")):null===(m=this.__sourceManagerButton)||void 0===m||m.getElement().addClass("not-displayed"),this.__showUsermanagementButtons.contentPermissions?(void 0===e.Controls.get(this.__parentControl.getId()+".LayoutControllers")&&(this.__layoutControllersButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__parentControl.getId()+".LayoutControllers",{"data-tchmi-text":this.__layoutControllerAlias},this.__parentControl),this.__layoutControllersButton&&(this.__destroyers.push(e.EventProvider.register(this.__parentControl.getId()+".LayoutControllers.onPressed",this._onLayoutController())),c=!1,this.__elementButtons.append(this.__layoutControllersButton.getElement()[0]))),c=!1,null===(h=this.__layoutControllersButton)||void 0===h||h.getElement().removeClass("not-displayed")):null===(d=this.__layoutControllersButton)||void 0===d||d.getElement().addClass("not-displayed"),c&&(this.__elementFeedback=document.createElement("div"),this.__elementFeedback.innerText=this.__menuControl.getFeedbackNothingToConfigureAlias(),this.__elementButtons.append(this.__elementFeedback))}__getApiAccessForDomains(){e.Server.readSymbol("ListDomains",t=>{var s,o;const r=null===(o=null===(s=t.response)||void 0===s?void 0:s.commands)||void 0===o?void 0:o[0].readValue;if(t.error===e.Errors.NONE&&r){const t=[];for(const[e,s]of Object.entries(r))(null==s?void 0:s.authExtension)&&t.push(e);const s={editUser:!1,userManagement:!1,contentPermissions:!1,dataSourceManagement:!1};let o=0;t.forEach(r=>{e.Server.UserManagement.getApiAccess({domain:r},r=>{o++,r.error===e.Errors.NONE&&r.result&&((r.result.updateUser.changeOwnPassword||r.result.updateUser.addGroups&&r.result.updateUser.removeGroups||r.result.updateUser.locale||r.result.updateUser.timeZone)&&(s.editUser=!0),(r.result.addUser.general||r.result.removeUser.general||r.result.updateUser.addGroups&&r.result.updateUser.removeGroups)&&(s.userManagement=!0));var n=e.Server.getGroupsOfCurrentUser();null!=n&&(n.some(e=>"Administrators"==e)&&n.some(e=>"__SystemUsers"==e)||n.some(e=>"__SystemAdministrators"==e))&&(s.dataSourceManagement=!0),n.some(e=>"__SystemAdministrators"==e)&&(s.contentPermissions=!0),o>=t.length&&(this.__showUsermanagementButtons=s,this.__createButtons())})})}})}processUserManagementPopup(){this.__getApiAccessForDomains();try{setTimeout(()=>{this.__processUserManagementPopup()},25)}catch(e){return}}__processUserManagementPopup(){const t=$(document.body).find(".TcHmi_Controls_Beckhoff_TcHmiUserManagement-template-usermanagement-popup"),s=e.Server.getCurrentUser(),o=null!=s?s:"unkown";this.__applyTextToElement("headerText",`${this.__menuControl.getHelloAlias()} ${o}`,this.__elementHeader),this.__menuControl.getAllowSwitchUser()&&t.find('[data-tchmi-text*="Switch user"]').find("span").text(this.__menuControl.getSwitchUserAlias()),this.__showUsermanagementButtons.userManagement&&t.find('[data-tchmi-text*="User management"]').find("span").text(this.__menuControl.getUserManagementAlias()),this.__showUsermanagementButtons.editUser&&t.find('[data-tchmi-text*="Edit user properties"]').find("span").text(this.__menuControl.getEditUserPropertiesAlias());const r=e.Controls.get(`${this.__parentControl.getId()}.UserPermissions`);void 0!==r&&r.setText(this.__menuControl.getUserPermissionAlias()),t.find(".cancelbutton").find("span").text(this.__menuControl.getCloseAlias())}show(){super.show()}__onClose(){return()=>{this.hide()}}__onSwitchUser(){return()=>{this.__menuControl.__onSwitchUser()}}__onEditUserProperties(){return()=>{this.__menuControl.__onEditUserProperties()}}__onUserManagement(){return()=>{this.__menuControl.__onUserManagement()}}__onPermissions(){return()=>{this.__menuControl._onPermissions()}}__onSourceManager(){return()=>{this.__menuControl._onSourceManager()}}_onLayoutController(){return()=>{this.__menuControl._onLayoutController()}}}t.UserManagementPopup=s}(t.Analytics||(t.Analytics={}))}(e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));