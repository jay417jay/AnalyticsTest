var TcHmi;!function(t){!function(t){!function(t){class e extends t.LayoutElement{constructor(t,e,i){super(t,e),this.enlargeTriggerHorizontal=.25,this.shrinkTriggerHorizontal=.5,this.enlargeTriggerVertical=.25,this.shrinkTriggerVertical=.5,this.__undoRedoManager=i}checkMovement(t,e,i,o,r){const l=this.__layoutProps.ElCtrlElement.offset().left+this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().left,s=this.__layoutProps.ElCtrlElement.offset().top+this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().top,n=l+i.offsetLeft,_=s+i.offsetTop,d=l+i.offsetLeft+i.offsetWidth,h=s+i.offsetTop+i.offsetHeight;if(this.__layout.removeColorBorder(this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx]),n+10<l||_+10<s||d>l+this.__layout.containerWidth?this.__layout.addColorBorder(this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx],!0):this.__layout.addColorBorder(this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx],!1),"left"===o){if(l+(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx)*(e.cS-1.5)>n&&e.cS>=2)return this.__checkLeftSideMoving(t.id)&&(e.cS--,e.cE--,this.__layout.setElementGridDimensions(t,e)),"moving-left"}if("top"===r){if(s+(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx)*(e.rS-1.5)>_&&e.rS>=2)return this.__checkTopSideMoving(t.id,_)&&(e.rS--,e.rE--,this.__layout.setElementGridDimensions(t,e),this.__layout.checkRemoveLastRow(t.id)&&(this.__layout.changeRowNumber(-1),this.__layout.showGridLines())),"moving-top"}return l+(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx)*(e.cE-.5)<d&&e.cE<=this.__layoutProps.numberOfColumns&&"right"===o?(this.__checkRightSideMoving(t.id)&&(e.cS++,e.cE++,this.__layout.setElementGridDimensions(t,e)),"moving-right"):s+(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx)*(e.rE-.5)<h&&e.rE<=this.__layoutProps.numberOfRows&&"bottom"===r?(this.__checkBottomSideMoving(t.id,h)&&(e.rS++,e.rE++,this.__layout.setElementGridDimensions(t,e)),"moving-bottom"):""}checkScaling(e,i,o,r,l,s,n,_){const d=this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().left,h=this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().top;if(this.__layout.removeColorBorder(this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx]),this.__layout.addColorBorder(this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx],!1),d+e.offsetLeft+e.offsetWidth-(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx)*this.shrinkTriggerHorizontal>l&&o>1){const t=this.__layout.getElementGridDimensions(e);t.cE--,this.__layout.setElementGridDimensions(e,t),n="left",this.shrinkTriggerHorizontal=.5,this.enlargeTriggerHorizontal=.5}if(h+e.offsetTop+e.offsetHeight-(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx)*this.shrinkTriggerVertical>s&&r>1){const t=this.__layout.getElementGridDimensions(e);t.rE--,this.__layout.setElementGridDimensions(e,t),_="top",this.enlargeTriggerVertical=.5,this.shrinkTriggerVertical=.5,this.__layout.checkRemoveLastRow(e.id)&&(this.__layout.changeRowNumber(-1),this.__layout.showGridLines())}if(d+e.offsetLeft+e.offsetWidth+(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx)*this.enlargeTriggerHorizontal<l&&o<=this.__layoutProps.numberOfColumns){if(this.__checkRightSideScaling(e.id)){const t=this.__layout.getElementGridDimensions(e);t.cE++,this.__layout.setElementGridDimensions(e,t),n="right"}else this.__layout.addColorBorder(this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx],!0);this.enlargeTriggerHorizontal=.25,this.shrinkTriggerHorizontal=.75}if(h+e.offsetTop+e.offsetHeight+(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx)*this.enlargeTriggerVertical<s&&r<=this.__layoutProps.numberOfRows){if(this.__slideDownElements(e.id,1)){const t=this.__layout.getElementGridDimensions(e);t.rE++,this.__layout.setElementGridDimensions(e,t)}else{const t=this.__layout.getElementGridDimensions(e);t.rS--,this.__layout.setElementGridDimensions(e,t)}this.__layoutProps.displayMode==t.I_SE_DisplayMode.SMARTPHONE&&this.__layout.changeRowNumber(1),_="bottom",this.shrinkTriggerVertical=.75,this.enlargeTriggerVertical=.25}return this.cursorX=l,`scale-${n}-${_}`}__checkTopSideMoving(t,e){const i=this.__layout.getCurrentLayout(t);let o=[];const r=i.find(t=>"selected"===t.id).cS,l=i.find(t=>"selected"===t.id).cE,s=i.find(t=>"selected"===t.id).rS;for(let t=0;t<i.length;t++)"selected"!==i[t].id&&!(i[t].cS<r&&i[t].cE<=r||i[t].cS>=l&&i[t].cE>l)&&i[t].rE<=s&&i[t].id!=this.__layoutProps.ElElementTemplateRoot[0].children[this.__layoutProps.grabbedElIdx].id&&o.push(i[t]);if(o.sort((t,e)=>e.rE-t.rE),1===s)return!1;if(!(o.length>0))return!0;if(o[0].rE<s)return!0;for(let t=1;t<o.length;t++)if(o[0].rE!==o[t].rE){for(let e=o.length;e>t;e--)o.pop();break}return this.__moveElementsUp(i,o,t,e),!1}__moveElementsUp(t,e,i,o){const r=t.find(t=>t.id===i);e.sort((t,e)=>t.rS-e.rS);let l=0;for(let t=0;t<e.length;t++)e[t].rE-e[t].rS>l&&(l=e[t].rE-e[t].rS);const s=e[e.length-1];if(o<this.__layoutProps.ElCtrlElement.offset().top+this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().top+(s.rS-1)*this.__layoutProps.rowHeightPx+(s.rS-1)*this.__layoutProps.gridGapPx+((s.rE-s.rS)*this.__layoutProps.rowHeightPx+(s.rE-s.rS-1)*this.__layoutProps.gridGapPx)/2){const t=this.__checkForUpperElements(r,e);t<l&&t>=0?this.__layout.repositioningElement(r,-t,0):this.__layout.repositioningElement(r,-l,0);for(let t=0;t<e.length;t++){const i=r.rE-e[t].rS;(e[t].cS>=r.cS&&e[t].cE<=r.cE||this.__slideDownElements(e[t].id,i))&&this.__layout.repositioningElement(e[t],i,0)}}}__checkForUpperElements(t,e){const i=this.__layout.getCurrentLayout(t.id);let o=[];const r=i.find(t=>"selected"===t.id).cS,l=i.find(t=>"selected"===t.id).cE,s=i.find(t=>"selected"===t.id).rS;for(let t=0;t<i.length;t++)if(!(i[t].cS<r&&i[t].cE<=r||i[t].cS>=l&&i[t].cE>l)&&i[t].rE<=s){let r=!1;for(let o=0;o<e.length;o++)e[o].id===i[t].id&&(r=!0);r||i[t].id===this.__layoutProps.ElElementTemplateRoot[0].children[this.__layoutProps.grabbedElIdx].id||o.push(i[t])}if(0===o.length)return-1;return-(this.__layout.getNumberOfRows(o)-t.rS)}__checkBottomSideMoving(t,e){const i=this.__layout.getCurrentLayout(t);let o=[];const r=i.find(t=>"selected"===t.id).rE,l=i.find(t=>"selected"===t.id).cS,s=i.find(t=>"selected"===t.id).cE;for(let t=0;t<i.length;t++)"selected"!==i[t].id&&!(i[t].cS<l&&i[t].cE<=l||i[t].cS>=s&&i[t].cE>s)&&i[t].rS>=r&&i[t].id!=this.__layoutProps.ElElementTemplateRoot[0].children[this.__layoutProps.grabbedElIdx].id&&o.push(i[t]);if(r===this.__layoutProps.numberOfRows)return this.__layout.changeRowNumber(1),this.__layout.showGridLines(),!0;if(o.sort((t,e)=>t.rS-e.rS),!(o.length>0))return!0;if(o[0].rS>r)return!0;for(let t=1;t<o.length;t++)if(o[0].rS!==o[t].rS){for(let e=o.length;e>t;e--)o.pop();break}return this.__moveElementsDown(i,o,t,e),!1}__moveElementsDown(t,e,i,o){const r=t.find(t=>t.id===i),l=r.rE-r.rS;e.sort((t,e)=>t.rS-e.rS);let s=100,n=0;for(let t=0;t<e.length;t++)e[t].rE-e[t].rS<s&&(s=e[t].rE-e[t].rS,n=t);const _=e[n];if(e.splice(n,1),o>this.__layoutProps.ElCtrlElement.offset().top+this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().top+(_.rS-1)*this.__layoutProps.rowHeightPx+(_.rS-1)*this.__layoutProps.gridGapPx+((_.rE-_.rS)*this.__layoutProps.rowHeightPx+(_.rE-_.rS-1)*this.__layoutProps.gridGapPx)/2){if(!_.vis)return void this.__slideDownElements(i,Math.floor((_.rE-_.rS)/2),!1);const t=this.__checkForUpperElements(_,[r]);let o=0;if(t<l&&t>=0){let i=_.rE-_.rS;for(let t=0;t<e.length;t++){e[t].rE-e[t].rS<=i&&e[t].cS>=r.cS&&e[t].cE<=r.cE&&this.__layout.repositioningElement(e[t],r.rS-e[t].rS,0)}this.__slideDownElements(r.id,_.rE-r.rS-t)&&this.__layout.repositioningElement(r,_.rE-r.rS-t,0)}else{this.__layout.repositioningElement(_,-l,0),o=s;let t=_.rE-_.rS;for(let i=0;i<e.length;i++){e[i].rE-e[i].rS<=t&&e[i].cS>=r.cS&&e[i].cE<=r.cE&&this.__layout.repositioningElement(e[i],_.rS-e[i].rS,0)}this.__slideDownElements(r.id,o)&&this.__layout.repositioningElement(r,o,0)}}}__checkLeftSideMoving(t){const e=this.__layout.getCurrentLayout(t);let i=[];const o=e.find(t=>"selected"===t.id).rS,r=e.find(t=>"selected"===t.id).rE,l=e.find(t=>"selected"===t.id).cS;for(let t=0;t<e.length;t++)"selected"!==e[t].id&&!(e[t].rS<o&&e[t].rE<=o||e[t].rS>=r&&e[t].rE>r)&&e[t].cE<=l&&e[t].id!=this.__layoutProps.ElElementTemplateRoot[0].children[this.__layoutProps.grabbedElIdx].id&&i.push(e[t]);if(i.sort((t,e)=>e.cE-t.cE),1===l)return!1;if(!(i.length>0))return!0;if(i[0].cE<l)return!0;let s=i[0].cE-i[0].cS;for(let t=0;t<i.length;t++)i[t].cE===i[0].cE&&i[t].cE-i[t].cS>s&&i[t].cE>e.find(t=>"selected"===t.id).cS-s&&(s=i[t].cE-i[t].cS);for(let t=1;t<i.length;t++)i[t].cE<=e.find(t=>"selected"===t.id).cS-s&&(i.splice(t,1),t--);return this.__moveElementsLeft(e,i,t),!1}__moveElementsLeft(t,e,i){const o=t.find(t=>t.id===i);e.sort((t,e)=>t.rS-e.rS),this.__slideDownElements(e[0].id,o.rE-e[0].rS,!0)&&this.__layout.repositioningElement(e[0],o.rE-e[0].rS,0),this.__layout.repositioningElement(o,0,-1),o.cS--,o.cE--,this.__slideDownElements(o.id,0)}__checkRightSideMoving(t){const e=this.__layout.getCurrentLayout(t);let i=[];const o=e.find(t=>"selected"===t.id).rS,r=e.find(t=>"selected"===t.id).rE,l=e.find(t=>"selected"===t.id).cE;for(let t=0;t<e.length;t++)"selected"!==e[t].id&&!(e[t].rS<o&&e[t].rE<=o||e[t].rS>=r&&e[t].rE>r)&&e[t].cS>=l&&"grid-buffer-cell-id"!=e[t].id&&e[t].id!=this.__layoutProps.ElElementTemplateRoot[0].children[this.__layoutProps.grabbedElIdx].id&&i.push(e[t]);if(i.sort((t,e)=>t.cS-e.cS),l===this.__layoutProps.numberOfColumns+1)return!1;if(!(i.length>0))return!0;if(i[0].cS>l)return!0;for(let t=1;t<i.length;t++)if(i[0].cS!==i[t].cS)for(let e=i.length;e>t;e--)i.pop();let s=i[0].cE-i[0].cS;for(let t=0;t<i.length;t++)i[t].cS===i[0].cS&&i[t].cE-i[t].cS>s&&i[t].cS<e.find(t=>"selected"===t.id).cE+s&&(s=i[t].cE-i[t].cS);for(let t=1;t<i.length;t++)i[t].cS>=e.find(t=>"selected"===t.id).cE+s&&(i.splice(t,1),t--);return this.__moveElementsRight(e,i,t),!1}__moveElementsRight(t,e,i){const o=t.find(t=>t.id===i);e.sort((t,e)=>t.rS-e.rS),this.__slideDownElements(e[0].id,o.rE-e[0].rS,!0)&&this.__layout.repositioningElement(e[0],o.rE-e[0].rS,0),this.__layout.repositioningElement(o,0,1),o.cS++,o.cE++,this.__slideDownElements(o.id,0)}__slideDownElements(t,e,i=!1){const o=this.__layout.getCurrentLayout(t);let r=this.__getCollidingElementsSlideDown(o);r.sort((t,e)=>t.rS-e.rS);const l=o.find(t=>"selected"===t.id).rE;this.__checkBottomSideSliding(o,r,e);let s=e;if(!(r.length>0))return this.__layout.repositioningElement(o.find(e=>e.id===t),e,0),!1;if(r[0].rS>l+e)return!0;if(r[0].rS>l&&(s=e-(r[0].rS-l)),r=this.__checkStartColumns(r,e,l),0===e){r.sort((t,e)=>t.rS-e.rS);let e=0;for(let i=0;i<r.length;i++)r[i].rS<o.find(e=>e.id===t).rE&&e<o.find(e=>e.id===t).rE-r[0].rS&&(e=o.find(e=>e.id===t).rE-r[0].rS);for(let t=0;t<r.length;t++)this.__slideDownElements(r[t].id,e,i)&&this.__layout.repositioningElement(r[t],e,0);return!1}r.sort((t,e)=>e.rE-e.rS-(t.rE-t.rS));for(let e=0;e<r.length;e++)if(this.__slideDownElements(r[e].id,s,i))this.__layout.repositioningElement(r[e],s,0);else if(i){let i={};i.affectedElementID=r[e].id,i.premiseElement=JSON.parse(JSON.stringify(o.find(e=>e.id===t))),this.__layoutProps.ruleSet.push(i)}return this.__layout.repositioningElement(o.find(e=>e.id===t),e,0),!1}__getCollidingElementsSlideDown(t){let e=[];const i=t.find(t=>"selected"===t.id).cS,o=t.find(t=>"selected"===t.id).cE,r=t.find(t=>"selected"===t.id).rS;for(let l=0;l<t.length;l++)"selected"!==t[l].id&&!(t[l].cS<i&&t[l].cE<=i||t[l].cS>=o&&t[l].cE>o)&&t[l].rS>r&&"grid-buffer-cell-id"!=t[l].id&&e.push(t[l]);return e}__checkBottomSideSliding(t,e,i){let o=t.find(t=>"selected"===t.id).rE;for(let t=0;t<e.length;t++)e[t].rE>o&&(o=e[t].rE);o>=this.__layoutProps.numberOfRows&&(this.__layout.changeRowNumber(o+i-this.__layoutProps.numberOfRows),this.__layout.showGridLines())}__checkStartColumns(t,e,i){for(let o=1;o<t.length;o++)if(t[0].rS!==t[o].rS){if((t[o].cS<t[0].cS&&t[o].cE<=t[0].cS||t[o].cS>=t[0].cE&&t[o].cE>t[0].cE)&&t[o].rS<t[0].rE+e){let r=i+e-t[o].rS;r>0&&this.__slideDownElements(t[o].id,r)&&this.__layout.repositioningElement(t[o],r,0),t.splice(o,1),o--;continue}t.splice(o,1),o--}return t}slideUpElements(){let t=this.__layout.getCurrentLayout();-1!==t.findIndex(t=>"grid-buffer-cell-id"===t.id)&&t.splice(t.findIndex(t=>"grid-buffer-cell-id"===t.id),1),t.sort((t,e)=>t.rS-e.rS);for(let e=0;e<t.length;e++){let i=this.__layoutProps.ElCtrlElement.find(`#${t[e].id}`)[0],o=t[e];if(!i.id.includes("grid-buffer-cell-id")&&null!=i&&null!=o)for(;this.__checkTopSideSlideUp(o.id,t);)o.rS--,o.rE--,this.__layout.setElementGridDimensions(i,o)}this.__undoRedoManager.addNewLayoutChange(this.__layout.getCurrentLayoutWithoutBuffer())}__checkTopSideSlideUp(t,e){const i=e.find(e=>e.id===t).cS,o=e.find(e=>e.id===t).cE,r=e.find(e=>e.id===t).rS;let l=[];for(let s=0;s<e.length;s++)e[s].id!==t&&!(e[s].cS<i&&e[s].cE<=i||e[s].cS>=o&&e[s].cE>o)&&e[s].rE<=r&&l.push(e[s]);return l.sort((t,e)=>e.rE-t.rE),1!==r&&(!(l.length>0)||l[0].rE<r)}__checkRightSideScaling(t){const e=this.__layout.getCurrentLayout(t);let i=[];const o=e.find(t=>"selected"===t.id).rS,r=e.find(t=>"selected"===t.id).rE,l=e.find(t=>"selected"===t.id).cE;if(l===this.__layoutProps.numberOfColumns+1)return!1;for(let t=0;t<e.length;t++)"selected"!=e[t].id&&!(e[t].rS<o&&e[t].rE<=o||e[t].rS>=r&&e[t].rE>r)&&e[t].cS>=l&&i.push(e[t]);if(i.sort((t,e)=>t.cS-e.cS),!(i.length>0))return!0;if(i[0].cS>l)return!0;for(let t=1;t<i.length;t++)if(i[0].cS!==i[t].cS)for(let e=i.length;e>t;e--)i.pop();return i.sort((t,e)=>t.rS-e.rS),this.__slideDownElements(i[0].id,r-i[0].rS,!0)&&this.__layout.repositioningElement(i[0],r-i[0].rS,0),!0}}t.MovementExaminer=e}(t.Analytics||(t.Analytics={}))}(t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));