var TcHmi;!function(t){!function(e){!function(e){class o extends e.LayoutElement{constructor(t,o,i,s){super(t,o),this.__cursorPressedVisiblilty=!1,this.__cursorPressedScaling=!1,this.__cursorTouchMovingInit=!1,this.__cursorPressedMoving=!1,this.__movingLeftBfr=0,this.__movingTopBfr=0,this.__movingRightBfr=0,this.__movingBottomBfr=0,this.__slideUpElements=!1,this.__touchMovingTimeDelta=300,this.__movementExaminer=i,this.__undoRedoManager=s,this.__layoutRestorer=new e.LayoutRestorer(this.__layout,this.__layoutProps)}get CursorPressedMoving(){return this.__cursorPressedMoving}get CursorPressedScaling(){return this.__cursorPressedScaling}setControlVisibility(t){let e=this;return o=>{o.preventDefault(),e.__layoutProps.grabbedElIdx=t;const i=this.__layout.getCurrentLayout().find(t=>t.id===this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx].id),s=this.__layoutProps.ElElementTemplateRoot.find("#"+this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx].id)[0],r=null==s?void 0:s.querySelector(".tchmi-layout-manager-cell-visible-button");i.vis?(i.vis=!1,null==r||r.classList.add("tchmi-layout-manager-cell-invisible-button"),s.classList.add("tchmi-layout-manager-grid-cell-transparent"),s.classList.remove("tchmi-layout-manager-grid-cell-invisible"),s.classList.remove("tchmi-layout-manager-grid-cell-visible")):(i.vis=!0,null==r||r.classList.remove("tchmi-layout-manager-cell-invisible-button"),s.classList.add("tchmi-layout-manager-grid-cell-visible"),s.classList.remove("tchmi-layout-manager-grid-cell-invisible"),s.classList.remove("tchmi-layout-manager-grid-cell-transparent")),this.__layout.calcCurrentLayout(),this.__cursorPressedVisiblilty=!0}}mousedownMoving(t){let e=this;return o=>{e.__cursorPressedScaling||e.__cursorPressedVisiblilty||e.__cursorPressedMoving||(this.__layoutProps.grabbedElIdx=t,"mousedown"!==o.type||e.__cursorTouchMovingInit?"touchstart"===o.type&&(e.__cursorTouchMovingInit=!0,e.__movementExaminer.cursorX=o.touches[0].pageX,e.__movementExaminer.cursorY=o.touches[0].pageY,setTimeout(()=>this.__touchStartMovingHandling(o.touches[0].pageX,o.touches[0].pageY),e.__touchMovingTimeDelta)):(e.__movementExaminer.cursorX=o.pageX,e.__movementExaminer.cursorY=o.pageY,e.__processMousdownMoving()))}}__processMousdownMoving(){this.__cursorPressedMoving=!0,this.__layoutProps.automaticLayoutChanges=[],this.__addLayoutToBuffer();const t=this.__layoutProps.ElElementTemplateRoot[0].getElementsByClassName("tchmi-layout-manager-grid-buffer-cell")[0],e=this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx];this.__layout.copyElementsGridPosition(t,e),this.__setBufferElementStyle(e,t),t.style.visibility="visible",setTimeout(()=>t.classList.add("tchmi-layout-manager-grid-buffer-cell-moving"),50),this.__movingLeftBfr=e.offsetLeft,this.__movingRightBfr=e.offsetLeft+e.offsetWidth,this.__movingTopBfr=e.offsetTop,this.__movingBottomBfr=e.offsetTop+e.offsetHeight,e.style.position="absolut",e.style.width=`${e.offsetWidth}px`,e.style.height=`${e.offsetHeight}px`,e.classList.add("tchmi-layout-manager-grid-cell-moving"),this.__layout.calcCurrentLayout(),this.__createPositionMarkerCells(),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").removeClass("tchmi-layout-manager-grid-cell-resizing")}__touchStartMovingHandling(t,e){this.__cursorTouchMovingInit&&t-20<this.__movementExaminer.cursorX&&this.__movementExaminer.cursorX<t+20&&e-20<this.__movementExaminer.cursorY&&this.__movementExaminer.cursorY<e+20&&(this.__cursorTouchMovingInit=!1,this.__processMousdownMoving())}mousedownScaling(t){let e=this;return o=>{e.__cursorPressedScaling=!0,e.__cursorPressedMoving=!1,e.__layoutProps.grabbedElIdx=t,e.__layoutProps.automaticLayoutChanges=[],e.__addLayoutToBuffer();const i=e.__layoutProps.ElElementTemplateRoot[0].getElementsByClassName("tchmi-layout-manager-grid-buffer-cell")[0],s=e.__layoutProps.ElElementTemplateRoot.children()[e.__layoutProps.grabbedElIdx];e.__layout.copyElementsGridPosition(i,s),s.classList.add("tchmi-layout-manager-grid-cell-moving"),this.__setBufferElementStyle(s,i),i.style.visibility="visible",e.__layout.calcCurrentLayout(),e.__createPositionMarkerCells(),e.__movementExaminer.shrinkTriggerHorizontal=.5,e.__movementExaminer.enlargeTriggerHorizontal=.25,e.__movementExaminer.shrinkTriggerVertical=.5,e.__movementExaminer.enlargeTriggerVertical=.25,this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").removeClass("tchmi-layout-manager-grid-cell-resizing")}}__setBufferElementStyle(e,o){var i;let s=t.Controls.get(null===(i=e.children[0])||void 0===i?void 0:i.id).getBorderRadius();return null!=s&&(o.style.borderBottomLeftRadius=`${s.bottomLeft}${s.bottomLeftUnit}`,o.style.borderTopLeftRadius=`${s.topLeft}${s.topLeftUnit}`,o.style.borderTopRightRadius=`${s.topRight}${s.topRightUnit}`,o.style.borderBottomRightRadius=`${s.bottomRight}${s.bottomRightUnit}`),o}mousemove(){let t=this;return e=>{if(this.__cursorTouchMovingInit){const t=this.__getCursorPosition(e);this.__movementExaminer.cursorX=t.clientX,this.__movementExaminer.cursorY=t.clientY,this.__cursorPressedMoving=!1}else if(!this.__cursorPressedVisiblilty){-1!=this.__layoutProps.grabbedElIdx&&(e.preventDefault(),e.stopPropagation());let o="";t.__cursorPressedScaling?o=t.__scaleGridElement(e):t.__cursorPressedMoving&&(o=t.__moveGridElement(e)),""!=o&&(this.__layoutRestorer.restoreLayout(o),this.__compareLayouts(),t.__slideUpElements&&(t.__layout.calcCurrentLayout(),t.__movementExaminer.slideUpElements(),t.__layout.calcCurrentLayout()))}}}__compareLayouts(){const t=this.__getShortedLayout(),e=JSON.stringify(t);for(let t=0;t<this.__layoutProps.automaticLayoutChanges.length;t++)if(e===this.__layoutProps.automaticLayoutChanges[t])return void this.__layoutProps.automaticLayoutChanges.splice(t+1,this.__layoutProps.automaticLayoutChanges.length-t);e!=this.__layoutProps.automaticLayoutChanges[this.__layoutProps.automaticLayoutChanges.length-1]&&this.__layoutProps.automaticLayoutChanges.push(e)}__addLayoutToBuffer(){const t=this.__getShortedLayout();this.__layoutProps.automaticLayoutChanges.push(JSON.stringify(t))}__getShortedLayout(){const t=this.__layout.getCurrentLayout();let e=t.findIndex(t=>"selected"===t.id);return-1!=e&&t.splice(e,1),e=t.findIndex(t=>"grid-buffer-cell-id"===t.id),-1!=e&&t.splice(e,1),t}mouseup(){return t=>{if(this.__layoutProps.eventListenerManager.removeEventListeners("LayoutManagerMouseMove"),this.__cursorTouchMovingInit)return t.cancelable&&t.preventDefault(),void(this.__cursorTouchMovingInit=!1);if(this.__cursorPressedScaling&&this.__layoutProps.displayMode===e.I_SE_DisplayMode.SMARTPHONE&&this.__layout.checkForGapsSmartphone(),!this.__cursorPressedMoving&&!this.__cursorPressedScaling||this.__cursorPressedVisiblilty)return void(this.__cursorPressedVisiblilty=!1);this.__cursorPressedMoving=!1,this.__cursorPressedScaling=!1;const o=this.__layoutProps.ElElementTemplateRoot[0].getElementsByClassName("tchmi-layout-manager-grid-buffer-cell")[0],i=this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx];i.style.position="",i.style.zIndex="",i.style.width="",i.style.height="",i.style.left="",i.style.height="",this.__layout.copyElementsGridPosition(i,o),i.classList.remove("tchmi-layout-manager-grid-cell-moving"),o.style.visibility="hidden",o.classList.remove("tchmi-layout-manager-grid-buffer-cell-moving"),this.__layout.removeColorBorder(this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx]),this.__layoutProps.displayMode!=e.I_SE_DisplayMode.SMARTPHONE&&this.__layout.removeUnusedRows(),this.__removePositionMarkerCells(),this.__layout.calcCurrentLayout(),this.__layoutProps.ruleSet=[],this.__undoRedoManager.addNewLayoutChange(this.__layout.getCurrentLayoutWithoutBuffer()),this.__layoutProps.grabbedElIdx=-1,this.__storeCurrentTempLayout()}}__storeCurrentTempLayout(){const t={layoutValue:[]};t.layoutValue=this.__layout.getCurrentLayout(),t.interactiveControls=this.__layoutProps.interactiveCtrls,t.layoutID=this.__layoutProps.layoutID,e.Utilities.setPersistentData(`${this.__layoutProps.userLayoutKey}`,JSON.stringify(t),null,e.StorageType.LocalStorage)}__createPositionMarkerCells(){const t=this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx],e=this.__layout.getCurrentLayout();for(let o=0;o<e.length;o++){const i=e[o];if("selected"===i.id||"grid-buffer-cell-id"===i.id||i.id===this.__layoutProps.ElElementTemplateRoot[0].children[this.__layoutProps.grabbedElIdx].id||!i.vis)continue;const s=document.createElement("div");s.classList.add("tchmi-layout-manager-grid-position-marker-cell"),s.id=`grid-position-marker-cell-id-${o}`,this.__setBufferElementStyle(t,s),this.__layoutProps.ElElementTemplateRoot[0].append(s),this.__layout.setElementGridDimensions(s,i)}}__removePositionMarkerCells(){this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-position-marker-cell").css("opacity","0");let t=this;setTimeout((function(){t.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-position-marker-cell").remove()}),200)}__moveGridElement(t){const e=this.__getCursorPosition(t),o=e.clientX,i=e.clientY;let s=this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx];s.style.position="absolute",s.style.gridArea="",s.style.zIndex="10",s.style.left=o-this.__movementExaminer.cursorX+this.__movingLeftBfr+"px",s.style.top=i-this.__movementExaminer.cursorY+this.__movingTopBfr+"px",this.__movingLeftBfr=this.__movingLeftBfr+o-this.__movementExaminer.cursorX,this.__movingTopBfr=this.__movingTopBfr+i-this.__movementExaminer.cursorY;let r=this.__getHorizontalMovingDirection(o),l=this.__getVerticalMovingDirection(i);if(""===r&&""===l)return"";const a=this.__layoutProps.ElElementTemplateRoot[0].getElementsByClassName("tchmi-layout-manager-grid-buffer-cell")[0],n=this.__setBlueContainerDimensions(a);return this.__movementExaminer.checkMovement(a,n,s,r,l)}__getCursorPosition(t){let e,o=0;return"mousemove"===t.type?(e=t.pageX,o=t.pageY):(e=t.touches[0].pageX,o=t.touches[0].pageY),{clientX:e,clientY:o}}__getHorizontalMovingDirection(t){let e="";return this.__movementExaminer.cursorX<t?(e="right",this.__movementExaminer.cursorX=t):this.__movementExaminer.cursorX>t&&(e="left",this.__movementExaminer.cursorX=t),e}__getVerticalMovingDirection(t){let e="";return this.__movementExaminer.cursorY<t?(e="bottom",this.__movementExaminer.cursorY=t):this.__movementExaminer.cursorY>t&&(e="top",this.__movementExaminer.cursorY=t),e}__scaleGridElement(e){const o=this.__getCursorPosition(e),i=o.clientX,s=o.clientY;const r=this.__layoutProps.ElElementTemplateRoot[0].getElementsByClassName("tchmi-layout-manager-grid-buffer-cell")[0],l=this.__setBlueContainerDimensions(r),a=this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx],n=this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().left,_=this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().top;a.style.width=i-n-a.offsetLeft+"px",a.style.height=s-_-a.offsetTop+"px";const u=null==a?void 0:a.querySelector(".tchmi-layout-manager-cell-edit-mask");null!=u&&(u.style.position="absolut",u.style.left="0px",u.style.top="0px",u.style.width=`${i-n-a.offsetLeft}px`,u.style.height=`${s-_-a.offsetTop}px`);const m=t.ValueConverter.toNumber(l.cE)-t.ValueConverter.toNumber(l.cS),h=t.ValueConverter.toNumber(l.rE)-t.ValueConverter.toNumber(l.rS);return this.__movementExaminer.checkScaling(r,l,m,h,i,s,"","")}__setBlueContainerDimensions(t){let e={id:"grid-buffer-cell"};if(e=this.__layout.getElementGridDimensions(t),e.rE<=e.rS){const e=this.__layout.getElementGridDimensions(t);e.rE++,this.__layout.setElementGridDimensions(t,e)}if(e.cE<=e.cS){const e=this.__layout.getElementGridDimensions(t);e.cE++,this.__layout.setElementGridDimensions(t,e)}return e}enableLayoutEditing(){if(!this.__layoutProps.isEditing){if(this.__layoutProps.isEditing=!0,this.__layoutProps.ElEditHeaderWrapper.addClass("opened"),this.__layoutProps.ElEditHeader.addClass("opened"),this.__layoutProps.ElSelectedIndicator.css({display:""}),setTimeout(()=>{this.__layout.updateIndicatorPosition()},400),this.dispatchEvent(new CustomEvent(e.EventNames.addInteractiveListener)),this.dispatchEvent(new CustomEvent(e.EventNames.processDarkMode)),this.__layoutProps.interactivityLock&&this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-edit-mask").removeClass("tchmi-layout-manager-cell-edit-mask-hidden"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-drop-button").css("visibility","visible"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-resizer").css("visibility","visible"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-visible-button").css("visibility","visible"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").css("cursor","move"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-buffer-cell").removeClass("tchmi-layout-manager-grid-cell-invisible"),this.__layoutProps.displayMode===e.I_SE_DisplayMode.SMARTPHONE){let t=[];if(""!=this.__layoutProps.editedFullSmartphoneLayout?t=JSON.parse(this.__layoutProps.editedFullSmartphoneLayout):""!=this.__layoutProps.generatedFullSmartphoneLayout&&(t=JSON.parse(this.__layoutProps.generatedFullSmartphoneLayout)),null==t)return;let e=0;for(let o=0;o<this.__layoutProps.ElElementTemplateRoot.children().length;o++){let i=this.__layoutProps.ElElementTemplateRoot.children()[o],s={};i.id.includes("grid-buffer-cell-id")||null==t||(s=t.find(t=>t.id==i.id),null!=s&&(e+=s.rE-s.rS,e>this.__layoutProps.numberOfRows&&this.__layout.changeRowNumber(e-this.__layoutProps.numberOfRows),this.__layout.setElementGridDimensions(i,s)))}this.__layout.changeRowNumber(1)}else{let t=this.__layout.getCurrentLayout(),e=this.__layout.getNumberOfRows(t);this.__layoutProps.numberOfRows<e&&this.__layout.changeRowNumber(e-this.__layoutProps.numberOfRows)}this.__layout.showGridLines()}}disableLayoutEditing(){if(this.__layoutProps.isEditing)if(this.__layoutProps.isEditing=!1,this.__layoutProps.ElEditHeaderWrapper.removeClass("opened"),this.__layoutProps.ElEditHeader.removeClass("opened"),this.__layoutProps.ElSelectedIndicator.css({display:"none"}),this.__layoutProps.ElGridContainer.css({width:"100%"}),this.dispatchEvent(new CustomEvent(e.EventNames.resetInteractiveListener)),this.__layout.hideGridLines(),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-edit-mask").addClass("tchmi-layout-manager-cell-edit-mask-hidden"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-drop-button").css("visibility","hidden"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-resizer").css("visibility","hidden"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-visible-button").css("visibility","hidden"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").css("cursor",""),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-buffer-cell").addClass("tchmi-layout-manager-grid-cell-invisible"),this.__layoutProps.displayMode===e.I_SE_DisplayMode.SMARTPHONE){this.__layout.checkForGapsSmartphone();const t=this.__layout.getCurrentLayout().sort((t,e)=>e.rE-t.rE)[0].rE-1;t<=this.__layoutProps.numberOfRows&&this.__layout.changeRowNumber(t-this.__layoutProps.numberOfRows)}else this.reduceScrollbar()}reduceScrollbar(){let t=this.__layout.getCurrentLayout();t.sort((t,e)=>e.rE-t.rE);for(let e=0;e<t.length;e++)(t[e].id.includes("grid-buffer-cell-id")||!1===t[e].vis)&&(t.splice(e,1),e--);let e=this.__layout.getNumberOfRows(t)-1;this.__layoutProps.numberOfRows>e&&this.__layout.changeRowNumber(e-this.__layoutProps.numberOfRows)}}e.LayoutEditor=o}(e.Analytics||(e.Analytics={}))}(t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));