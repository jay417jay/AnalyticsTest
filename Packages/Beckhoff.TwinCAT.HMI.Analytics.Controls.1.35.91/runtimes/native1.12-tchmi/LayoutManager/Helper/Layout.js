var TcHmi;!function(t){!function(e){!function(e){class o extends EventTarget{constructor(t,e){super(),this._currentLayoutAtt=[],this.containerWidth=0,this.__containerHeight=0,this.parentID="",this.id="",this.__isAddedToTopMostLayer=!1,this.__layoutProps=t,this.__parentLMControl=e}getNumberOfRows(t){let o=0,s=0;for(let i=0;i<t.length;i++)t[i].rE>o&&(o=t[i].rE),this.__layoutProps.displayMode===e.I_SE_DisplayMode.SMARTPHONE&&0==t[i].vis&&1==t[i].cS&&t[i].cE>=2&&(s+=t[i].rE-t[i].rS);return o-s}changeRowNumber(t){this.__layoutProps.numberOfRows=this.__layoutProps.numberOfRows+t,this.__layoutProps.ElElementTemplateRoot[0].style.gridTemplateRows=`repeat(${this.__layoutProps.numberOfRows},${this.__layoutProps.rowHeightPx})px`,t>=0?(this.__layoutProps.height<this.__layoutProps.numberOfRows*(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx+1)||"%"==this.__layoutProps.defaultHeightUnit)&&(this.__layoutProps.height=this.__layoutProps.numberOfRows*(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx)):this.__layoutProps.height=this.__layoutProps.numberOfRows*(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx),this.setGridDimensions(),this.__layoutProps.isEditing&&this.showGridLines()}setGridDimensions(){this.containerWidth=this.__layoutProps.ElGridContainer.outerWidth(),this.__layoutProps.displayMode===e.I_SE_DisplayMode.SMARTPHONE?(this.__layoutProps.gridGapPx=10,this.__layoutProps.columnWidthPx=this.containerWidth/this.__layoutProps.numberOfColumns-this.__layoutProps.gridGapPx-10,this.__layoutProps.ElElementTemplateRoot[0].style.gridTemplateColumns=`repeat(${this.__layoutProps.numberOfColumns},${this.__layoutProps.columnWidthPx}px)`,this.__layoutProps.ElElementTemplateRoot[0].style.gridGap=`${this.__layoutProps.gridGapPx}px`,this.__layoutProps.rowHeightPx=this.__layoutProps.usePredefinedRowHeight?this.__layoutProps.predefinedRowHeightPx:this.__layoutProps.columnWidthPx/4,this.__layoutProps.ElElementTemplateRoot[0].style.gridTemplateRows=`repeat(${this.__layoutProps.numberOfRows},${this.__layoutProps.rowHeightPx}px)`):(this.__layoutProps.columnWidthPx=this.containerWidth/(this.__layoutProps.numberOfColumns*(1+this.__layoutProps.ctrlDistanceHelper/100)),this.__layoutProps.ElElementTemplateRoot[0].style.gridTemplateColumns=`repeat(${this.__layoutProps.numberOfColumns},${this.__layoutProps.columnWidthPx}px)`,this.__layoutProps.gridGapPx=this.__layoutProps.columnWidthPx*this.__layoutProps.ctrlDistanceHelper/100,this.__layoutProps.ElElementTemplateRoot[0].style.gridGap=`${this.__layoutProps.gridGapPx}px`,this.__layoutProps.rowHeightPx=this.__layoutProps.usePredefinedRowHeight?this.__layoutProps.predefinedRowHeightPx:this.__layoutProps.columnWidthPx,this.__layoutProps.ElElementTemplateRoot[0].style.gridTemplateRows=`repeat(${this.__layoutProps.numberOfRows},${this.__layoutProps.rowHeightPx}px)`),this.__layoutProps.ElElementTemplateRoot[0].style.left=`${.5*this.__layoutProps.gridGapPx}px`}scaleGridSVGArea(){this.__layoutProps.ElSvgContainer[0].style.height=`${this.__layoutProps.ElElementTemplateRoot[0].getBoundingClientRect().height}px`}setDisplayMode(t){if(null!=t)return void(this.__layoutProps.displayMode=t);const o=window.innerWidth;window.innerHeight;o<this.__layoutProps.mobileViewTriggerWidth?this.__layoutProps.displayMode=e.I_SE_DisplayMode.SMARTPHONE:this.__layoutProps.displayMode=e.I_SE_DisplayMode.MONITOR}showGridLines(){this.scaleGridSVGArea(),this.__layoutProps.ElSvgContainer[0].style.visibility="visible",this.__layoutProps.ElCtrlElement.find(this.__layoutProps.ElSvgContainer[0]).empty();const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","100%"),t.setAttribute("height","100%"),this.__layoutProps.ElSvgContainer[0].append(t);const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","1"),e.setAttribute("y1","1"),e.setAttribute("x2","1"),e.setAttribute("y2",`${this.__layoutProps.numberOfRows*this.__layoutProps.rowHeightPx+this.__layoutProps.numberOfRows*this.__layoutProps.gridGapPx}`),e.classList.add("tchmi-layout-manager-grid-line"),t.append(e);const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("y1","1"),o.setAttribute("x1","1"),o.setAttribute("y2","1"),o.setAttribute("x2",`${this.__layoutProps.numberOfColumns*this.__layoutProps.columnWidthPx+this.__layoutProps.numberOfColumns*this.__layoutProps.gridGapPx}`),o.classList.add("tchmi-layout-manager-grid-line"),t.append(o);for(let e=1;e<this.__layoutProps.numberOfColumns;e++){const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",`${this.__layoutProps.columnWidthPx*e+this.__layoutProps.gridGapPx*e}`),o.setAttribute("y1","1"),o.setAttribute("x2",`${this.__layoutProps.columnWidthPx*e+this.__layoutProps.gridGapPx*e}`),o.setAttribute("y2",`${this.__layoutProps.numberOfRows*this.__layoutProps.rowHeightPx+(this.__layoutProps.numberOfRows-1)*this.__layoutProps.gridGapPx}`),o.classList.add("tchmi-layout-manager-grid-line"),t.append(o)}for(let e=1;e<this.__layoutProps.numberOfRows;e++){const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("y1",`${this.__layoutProps.rowHeightPx*e+this.__layoutProps.gridGapPx*e}`),o.setAttribute("x1","1"),o.setAttribute("y2",`${this.__layoutProps.rowHeightPx*e+this.__layoutProps.gridGapPx*e}`),o.setAttribute("x2",`${this.__layoutProps.numberOfColumns*(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx)}`),o.classList.add("tchmi-layout-manager-grid-line"),t.append(o)}const s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",`${this.__layoutProps.numberOfColumns*(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx)-1}`),s.setAttribute("y1","1"),s.setAttribute("x2",`${this.__layoutProps.numberOfColumns*(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx)-1}`),s.setAttribute("y2",`${this.__layoutProps.numberOfRows*this.__layoutProps.rowHeightPx+(this.__layoutProps.numberOfRows-1)*this.__layoutProps.gridGapPx}`),s.classList.add("tchmi-layout-manager-grid-line"),t.append(s)}hideGridLines(){this.__layoutProps.ElSvgContainer[0].style.visibility="hidden"}setControlsOpacity(){for(let t=0;t<this.__layoutProps.ElElementTemplateRoot.children().length;t++)(this.__layoutProps.ElElementTemplateRoot.children()[t].classList.contains("tchmi-layout-manager-grid-cell-transparent")||this.__layoutProps.ElElementTemplateRoot.children()[t].classList.contains("tchmi-layout-manager-grid-cell-invisible"))&&(this.__layoutProps.isEditing?(this.__layoutProps.ElElementTemplateRoot.children()[t].classList.add("tchmi-layout-manager-grid-cell-transparent"),this.__layoutProps.ElElementTemplateRoot.children()[t].classList.remove("tchmi-layout-manager-grid-cell-invisible"),this.__layoutProps.ElElementTemplateRoot.children()[t].classList.remove("tchmi-layout-manager-grid-cell-visible")):(this.__layoutProps.ElElementTemplateRoot.children()[t].classList.add("tchmi-layout-manager-grid-cell-invisible"),this.__layoutProps.ElElementTemplateRoot.children()[t].classList.remove("tchmi-layout-manager-grid-cell-visible"),this.__layoutProps.ElElementTemplateRoot.children()[t].classList.remove("tchmi-layout-manager-grid-cell-transparent")))}getCurrentLayoutWithoutBuffer(){return this._currentLayoutAtt.length>0?this._currentLayoutAtt.filter(t=>"grid-buffer-cell-id"!==t.id):[]}getCurrentLayout(t){if(this._currentLayoutAtt.length>0){let e=JSON.stringify(this._currentLayoutAtt),o=JSON.parse(e);if(void 0!==t)if("grid-buffer-cell-id"==t){let e=o.find(e=>e.id==t),s=JSON.stringify(o.find(e=>e.id==t));null!=e?(o.find(e=>e.id==t).id="selected",o.push(JSON.parse(s))):console.log("something unexpected 1")}else{let e=JSON.stringify(o.find(e=>e.id==t));if(null!=e){let t=JSON.parse(e);t.id="selected",o.push(t)}else console.log("something unexpected 2");o.splice(o.findIndex(t=>t.id==this.__layoutProps.ElElementTemplateRoot[0].children[this.__layoutProps.grabbedElIdx].id),1)}return o}return this._currentLayoutAtt}calcCurrentLayout(){let t=[];for(let e=0;e<this.__layoutProps.ElElementTemplateRoot.children().length;e++){const o=this.__layoutProps.ElElementTemplateRoot.children()[e];let s={};s.id=o.id,s=this.getElementGridDimensions(o),null!=s&&(s.id.includes("grid-position-marker-cell-id")||(o.classList.contains("tchmi-layout-manager-grid-cell-visible")?s.vis=!0:s.vis=!1,t.push(s)))}this._currentLayoutAtt=t}generateLayoutHash(){const t=this.getCurrentLayout(),e=[],o=this;return t.forEach((function(t){const s=t.id.replace("_GridElement",""),i=o.__layoutProps.ElCtrlElement.find(`#${s}`).data("tchmiType");if(null!=e.find(t=>t.cType==i))e.find(t=>t.cType==i).cnt++;else{const t={};t.cType=i,t.cnt=1,e.push(t)}})),e}setElementGridDimensions(t,e){null!=t&&null!=e&&(this.__convertGridPosToPixelPos(t,e),this._currentLayoutAtt.find(e=>e.id==t.id)?(this._currentLayoutAtt.find(e=>e.id==t.id).cS=e.cS,this._currentLayoutAtt.find(e=>e.id==t.id).cE=e.cE,this._currentLayoutAtt.find(e=>e.id==t.id).rS=e.rS,this._currentLayoutAtt.find(e=>e.id==t.id).rE=e.rE):t.id.includes("grid-position-marker-cell-id")||this.calcCurrentLayout())}getElementGridDimensions(t){return this.__convertPixelPosToGridPos(t)}copyElementsGridPosition(t,e){const o=this.__convertPixelPosToGridPos(e);null!==o&&this.__convertGridPosToPixelPos(t,o)}__convertPixelPosToGridPos(e){const o=t.ValueConverter.toNumber(e.style.left.replace("px","")),s=t.ValueConverter.toNumber(e.style.top.replace("px","")),i=t.ValueConverter.toNumber(e.style.width.replace("px","")),l=t.ValueConverter.toNumber(e.style.height.replace("px","")),r=this.__layoutProps.ElElementTemplateRoot[0].offsetLeft;let a=this.__layoutProps.ElElementTemplateRoot[0].offsetTop;const n={};return n.cS=Math.round((o+r)/(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx))+1,n.cE=Math.round((o+i+r)/(this.__layoutProps.columnWidthPx+this.__layoutProps.gridGapPx))+1,n.rS=Math.round((s+a)/(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx))+1,n.rE=Math.round((s+l+a)/(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx))+1,n.id=e.id,1===n.cS&&1===n.cE&&1===n.rS&&1===n.rE?null:n}__convertGridPosToPixelPos(t,e){const o=`${0+(e.cS-1)*this.__layoutProps.columnWidthPx+(e.cS-1)*this.__layoutProps.gridGapPx}px`,s=`${0+(e.rS-1)*this.__layoutProps.rowHeightPx+(e.rS-1)*this.__layoutProps.gridGapPx}px`,i=`${(e.cE-e.cS)*this.__layoutProps.columnWidthPx+(e.cE-e.cS-1)*this.__layoutProps.gridGapPx}px`,l=`${(e.rE-e.rS)*this.__layoutProps.rowHeightPx+(e.rE-e.rS-1)*this.__layoutProps.gridGapPx}px`;t.style.position="absolut",t.style.left=o,t.style.top=s,t.style.width=i,t.style.height=l;const r=t.querySelector(".tchmi-layout-manager-cell-edit-mask");null!=r&&(r.style.position="absolut",r.style.left="0px",r.style.top="0px",r.style.width=i,r.style.height=l)}setEditHeaderTheme(){this.__layoutProps.ElEditHeader.toggleClass("dark",this.__layoutProps.darkMode),this.__layoutProps.ElEditHeader.find("*").toggleClass("dark",this.__layoutProps.darkMode),this.__layoutProps.ElEditButton.toggleClass("dark",this.__layoutProps.darkMode)}updateIndicatorPosition(){let t,o,s;switch(this.__layoutProps.displayMode){case e.I_SE_DisplayMode.MONITOR:s=this.__layoutProps.ElDesktopButton.position().top+this.__layoutProps.ElDesktopButton.outerHeight()+2,t=this.__layoutProps.ElDesktopButton[0].clientWidth,o=this.__layoutProps.ElDesktopButton.position().left+parseInt(this.__layoutProps.ElDesktopButton.css("margin-left"),10);break;case e.I_SE_DisplayMode.SMARTPHONE:s=this.__layoutProps.ElMobileButton.position().top+this.__layoutProps.ElMobileButton.outerHeight()+2,t=this.__layoutProps.ElMobileButton[0].clientWidth,o=this.__layoutProps.ElMobileButton.position().left+parseInt(this.__layoutProps.ElMobileButton.css("margin-left"),10)}this.__layoutProps.ElSelectedIndicator.css({top:`${s}px`,width:`${t}px`,left:`${o}px`})}resetLayout(o=!1){this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").addClass("tchmi-layout-manager-grid-cell-resizing"),this.__layoutProps.isLayoutReset=!0,this.__layoutProps.editedFullSmartphoneLayout="",o&&(this.__layoutProps.userLayoutKey=`${t.Server.getCurrentUser()}__${this.parentID}__${this.id}__${this.__layoutProps.displayMode}`,this.__layoutProps.generatedFullSmartphoneLayout=""),e.Utilities.deletePersistentData(`AnalyticsKey_${this.__layoutProps.userLayoutKey}`,e.StorageType.LocalStorage),this.dispatchEvent(new CustomEvent(e.EventNames.requestDashboardLayout))}checkCtrlPosition(t,e,o){if(null==t||null==t.rS)return!1;for(let o=0;o<e.length;o++){const s=e[o];if("selected"!==s.id&&s.id!==t.id&&null!=s.cS&&!(s.rE<=t.rS||s.rS>=t.rE||s.cE<=t.cS||s.cS>=t.cE))return!1}if(o){const e=this.__layoutProps.ElElementTemplateRoot.find("#"+t.id)[0];this.setElementGridDimensions(e,t)}return!0}repositioningElement(t,e,o){if(null!=t){let s=this.__layoutProps.ElElementTemplateRoot.find("#"+t.id)[0];t.cS+=o,t.cE+=o,t.rS+=e,t.rE+=e,e>0&&this.__layoutProps.numberOfRows<t.rE&&this.changeRowNumber(t.rE-this.__layoutProps.numberOfRows),this.setElementGridDimensions(s,t)}}checkForGapsSmartphone(){const t=this.getCurrentLayout();if(0==t.length)return;let e=0;e=this.__layoutProps.isEditing?t.findIndex(t=>t.id===this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx].id):t.findIndex(t=>"grid-buffer-cell-id"===t.id),-1!=e&&t.splice(e,1),t.sort((t,e)=>t.rS-e.rS);let o=t.length-1,s=0;if(!this.__layoutProps.isEditing){for(let e=0;e<o;e++)t[e].vis||(t.splice(e,1),o--,e--);t[0].rS>1&&(s+=t[0].rS-1),this.repositioningElement(t[0],-s,0)}let i=s;for(let e=1;e<t.length;e++)t[e].rS>t[e-1].rE&&(s=t[e].rS-t[e-1].rE,i<s&&(i=s)),this.repositioningElement(t[e],-s,0);this.changeRowNumber(-i)}setGridElStyle(t,e){if(null!=e){this.setElementGridDimensions(t,e);const o=t.querySelector(".tchmi-layout-manager-cell-visible-button");e.vis?(t.classList.add("tchmi-layout-manager-grid-cell-visible"),t.classList.remove("tchmi-layout-manager-grid-cell-invisible"),t.classList.remove("tchmi-layout-manager-grid-cell-transparent"),null==o||o.classList.remove("tchmi-layout-manager-cell-invisible-button")):this.__layoutProps.isEditing?(t.classList.add("tchmi-layout-manager-grid-cell-transparent"),t.classList.remove("tchmi-layout-manager-grid-cell-visible"),t.classList.remove("tchmi-layout-manager-grid-cell-invisible"),null==o||o.classList.add("tchmi-layout-manager-cell-invisible-button")):(t.classList.add("tchmi-layout-manager-grid-cell-invisible"),t.classList.remove("tchmi-layout-manager-grid-cell-visible"),t.classList.remove("tchmi-layout-manager-grid-cell-transparent"),null==o||o.classList.add("tchmi-layout-manager-cell-invisible-button")),e.rE-1>this.__layoutProps.numberOfRows&&(this.__layoutProps.isEditing||e.vis)&&this.changeRowNumber(e.rE-this.__layoutProps.numberOfRows-1)}}createBufferCellElement(){const t=document.createElement("div");t.classList.add("tchmi-layout-manager-grid-buffer-cell"),t.id="grid-buffer-cell-id";this.setElementGridDimensions(t,{}),this.__layoutProps.ElElementTemplateRoot[0].append(t)}checkRemoveLastRow(t){const e=this.getCurrentLayout(t),o=e.find(t=>"selected"===t.id).rE;let s=e.findIndex(t=>"selected"===t.id);return e.splice(s,1),s=e.findIndex(t=>"grid-buffer-cell-id"===t.id),e.splice(s,1),s=e.findIndex(t=>t.id===this.__layoutProps.ElElementTemplateRoot.children()[this.__layoutProps.grabbedElIdx].id),e.splice(s,1),this.getNumberOfRows(e)<o}removeUnusedRows(){const t=this.getCurrentLayout(),e=this.getNumberOfRows(t);this.__layoutProps.numberOfRows>e&&this.changeRowNumber(-(this.__layoutProps.numberOfRows-(e+1)))}addColorBorder(t,e,o=!1){this.removeColorBorder(t),e?t.classList.add("tchmi-layout-manager-tchmi-red-border"):t.classList.add("tchmi-layout-manager-tchmi-green-border"),o&&setTimeout(()=>this.removeColorBorder(t),3e3)}removeColorBorder(t){t.classList.remove("tchmi-layout-manager-tchmi-red-border"),t.classList.remove("tchmi-layout-manager-tchmi-green-border")}}e.Layout=o}(e.Analytics||(e.Analytics={}))}(t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={}));