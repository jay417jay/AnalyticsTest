var TcHmi;!function(t){let e;!function(e){let o;!function(o){class s extends t.Controls.System.TcHmiContainerControl{constructor(e,s,i){super(e,s,i),this.__layoutProps=new o.LayoutProperties,this.__helperClassesEventManager=new t.Controls.Analytics.EventListenerManager,this.__widthBfr=0,this.__animationFrameId=null,this.__alwaysShowEditButton=!0,this.__showEditButtonTopRight=!1,this.__disableAnimations=!1,this.__showUsernameButton=!0,this.__showAddCustomCtrlButton=!0,this.__showAddChartButton=!0,this.__silentLayoutStore=!1,this.__localizedElements=new Map,this.__localizationReader=void 0,this.__destroyLocalizationWatch=null,this.__localKeys={Save_Sucess:"Save_Sucess",Save_Error:"Save_Error",Save_Cancel:"Save_Cancel",Exit_Cancel:"Exit_Cancel",Current_User:"Current_User",Interactivity_Lock:"Interactivity_Lock",Add:"Add"},this.__layoutCache=[],this.__firstCustomCtrlTypeName="",this.__customCtrlDisplayName="",this.__onResized=()=>{let t=this;return(e,o)=>{if(this.__layoutProps.height=this.__element[0].getBoundingClientRect().height,this.__layoutProps.width=this.__width,t.__layoutProps.layoutInitialized){if(t.__layoutEditor.CursorPressedMoving||t.__layoutEditor.CursorPressedScaling)return;t.__onWindowSizeChanged()}else super.__attach(),TCHMI_DESIGNER&&(this.__elementTemplateRoot[0].style.height=`${this.__element[0].getBoundingClientRect().height}px`,this.__element.find(".tchmi-layout-manager-grid-container").css("transition","none"),this.__element.find(".tchmi-layout-manager-grid-container").css("margin","0px"))}},this.__onUserChanged=()=>(t,e)=>{this.__updateUser()},this.__onResolverForCustomCtrlTypesWatchCallback=e=>{!1===this.__isAttached&&this.__suspendObjectResolver("CustomCtrlTypes"),tchmi_equal(e.value,this.__customCtrlTypes)||(this.__customCtrlTypes=e.value||null,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getCustomCtrlTypes"]),this.__processCustomCtrlTypes())}}get isEditable(){return this.__layoutProps.isEditing}get allowLayoutEdit(){return this.__layoutProps.allowLayoutEdit}get layoutID(){return this.__layoutProps.layoutID}get layoutIDWithoutDisplayMode(){return e.IDParser.GetLayoutIDWithoutDisplayMode(this.__layoutProps.layoutID)}__previnit(){if(super.__previnit(),this.__elementTemplateRoot=this.__element.find(".tchmi-layout-manager-grid"),this.__svgContainer=this.__element.find(".tchmi-layout-manager-svg-grid"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-container-template")),0===this.__elementTemplateRoot.length)throw new Error("Invalid Template.html");for(let t=0;t<this.__children.length;t++)this.__elementTemplateRoot[0].appendChild(this.__children[t].getElement()[0]);this.__layoutProps.ElCtrlElement=this.__element,this.__layoutProps.ElElementTemplateRoot=this.__elementTemplateRoot,this.__layoutProps.ElSvgContainer=this.__svgContainer,this.__layoutProps.widthUnit=this.__widthUnit,this.__layoutProps.heightUnit=this.__heightUnit,this.__layoutProps.ElGridContainer=this.__element.find(".tchmi-layout-manager-grid-container"),this.__layoutProps.ElDesktopButton=this.__element.find(".tchmi-layout-manager-desktop-button"),this.__layoutProps.ElEditButton=this.__element.find(".tchmi-layout-manager-edit-button"),this.__layoutProps.ElMobileButton=this.__element.find(".tchmi-layout-manager-mobile-button"),this.__layoutProps.ElSelectedIndicator=this.__element.find(".tchmi-selected-indicator"),this.__layoutProps.ElEditHeader=this.__element.find(".tchmi-layout-manager-edit-header"),this.__layoutProps.ElEditHeaderWrapper=this.__element.find(".tchmi-layout-manager-edit-header-wrapper"),this.__adjustEditButtonVisibility(!1)}__init(){super.__init();let e=this.__element[0].querySelectorAll("[data-tchmi-localized-content-key]");for(let t=0,o=e.length;t<o;t++){let o=e[t],s=o.dataset.tchmiLocalizedContentKey;s&&this.__localizedElements.set(o,{key:s,parameters:null})}if(this.__destroyLocalizationWatch=this.__localization.watch(e=>{if(e.error===t.Errors.NONE&&e.reader){this.__localizationReader=e.reader;for(const[t,o]of this.__localizedElements){let s=e.reader.get(o.key);o.key.includes("Tooltip")?t.title=tchmi_decode_control_characters(s):t.textContent=tchmi_decode_control_characters(s)}}}),super.__attach(),TCHMI_DESIGNER)this.__alwaysShowEditButton=!1,this.__elementTemplateRoot.addClass("tchmi-layout-manager-grid-none");else{this.__initalizeAttributes(),this.__layout.parentID=JSON.parse(JSON.stringify(this.__parent.getId())),this.__layout.setDisplayMode(),this.__layout.setGridDimensions(),this.__storeDefaultControlParameter(),"%"===this.__heightUnit&&(this.__desktopLayoutGenerator.ctrlPositioner.originalHeight=this.__height),this.__processButtonSize(),this.__updateRedoUndoButtons(),this.__layout.setEditHeaderTheme(),this.__updateUser(),this.__requestDashboardLayout(),this.__resetInteractiveListener(),this.__elementTemplateRoot[0].style.opacity="0";for(let t=0;t<this.__elementTemplateRoot[0].children.length;t++){let e=this.__elementTemplateRoot[0].children[t];null!=e&&(e.style.visibility="hidden")}const e=t.Controls.getVersion("TcHmi.Controls.System.TcHmiContainerControl");(null==e||e.major<=1&&e.minor<=12&&e.build<=754&&e.revision<=4)&&setInterval(()=>{this.__watchCtrlSize()},500)}}__initalizeAttributes(){this.__layout=new o.Layout(this.__layoutProps,this),this.__layout.id=this.getId(),this.__undoRedoManager=new o.UndoRedoManager(this.__layout,this.__layoutProps),this.__mobileLayoutGenerator=new o.MobileLayoutGenerator(this.__layout,this.__layoutProps),this.__desktopLayoutGenerator=new o.DesktopLayoutGenerator(this.__layout,this.__layoutProps),this.__hotKeyHandler=new o.HotKeyEventlistener(this.__layout,this.__layoutProps),this.__interactiveControlHandler=new o.InteractiveControlHandler(this.__layout,this.__layoutProps,this.__id),this.__storeHandler=new o.LayoutStoreHandler(this.__layout,this.__layoutProps,this.__undoRedoManager),this.__movementExaminer=new o.MovementExaminer(this.__layout,this.__layoutProps,this.__undoRedoManager),this.__layoutEditor=new o.LayoutEditor(this.__layout,this.__layoutProps,this.__movementExaminer,this.__undoRedoManager),this.__helperClassesEventManager.addEventListener(this.__layout,o.EventNames.requestDashboardLayout,()=>this.__requestDashboardLayout()),this.__helperClassesEventManager.addEventListener(this.__hotKeyHandler,o.EventNames.storeDashboard,()=>this.storeDashboardLayout(null)),this.__helperClassesEventManager.addEventListener(this.__interactiveControlHandler,o.EventNames.setEditMode,()=>this.setEditMode(!this.__layoutProps.isEditing)),this.__helperClassesEventManager.addEventListener(this.__interactiveControlHandler,o.EventNames.controlDropped,()=>this.__onControlDropped()),this.__helperClassesEventManager.addEventListener(this.__hotKeyHandler,o.EventNames.setEditMode,()=>this.__setEditMode(!this.__layoutProps.isEditing,!0)),this.__helperClassesEventManager.addEventListener(this.__hotKeyHandler,o.EventNames.slideUpElements,()=>this.__movementExaminer.slideUpElements()),this.__helperClassesEventManager.addEventListener(this.__hotKeyHandler,o.EventNames.undoAction,()=>this.__undoRedoManager.undoLastAction()),this.__helperClassesEventManager.addEventListener(this.__hotKeyHandler,o.EventNames.redoAction,()=>this.__undoRedoManager.redoLastAction()),this.__helperClassesEventManager.addEventListener(this.__undoRedoManager,o.EventNames.createLayout,()=>this.__createDashboardLayout()),this.__helperClassesEventManager.addEventListener(this.__desktopLayoutGenerator,o.EventNames.storeDashboard,t=>this.storeDashboardLayout(t.detail)),this.__helperClassesEventManager.addEventListener(this.__layoutEditor,o.EventNames.addInteractiveListener,()=>this.__addInteractiveListener()),this.__helperClassesEventManager.addEventListener(this.__layoutEditor,o.EventNames.processDarkMode,()=>this.__processDarkMode()),this.__helperClassesEventManager.addEventListener(this.__layoutEditor,o.EventNames.resetInteractiveListener,()=>this.__resetInteractiveListener()),this.__helperClassesEventManager.addEventListener(this.__storeHandler,o.EventNames.layoutReceived,this.__onLayoutReceivedCallback()),this.__helperClassesEventManager.addEventListener(this.__storeHandler,o.EventNames.layoutStored,this.__onLayoutStored()),this.__helperClassesEventManager.addEventListener(this.__undoRedoManager,o.EventNames.updateRedoUndoButton,()=>{this.__updateRedoUndoButtons()}),this.__helperClassesEventManager.addEventListener(this.__layoutProps.ElCtrlElement[0],o.EventNames.displayModeChanging,()=>{this.__onDisplayModeChanging()}),this.__helperClassesEventManager.addEventListener(this.__layoutProps.ElCtrlElement[0],o.EventNames.displayModeChanged,()=>{this.__onDisplayModeChanged()}),setTimeout(()=>{this.__layoutProps.layoutInitialized||this.__onLayoutReceived()(new CustomEvent(null))},1e4)}__attach(){super.__attach(),this.__resizeDestroyEvent=t.EventProvider.register(this.__id+".onResized",this.__onResized()),this.__userChangedDestroyEvent=t.EventProvider.register("onUserChanged",this.__onUserChanged()),this.__processShowEditButtonTopRight()}__detach(){var t;super.__detach(),this.__layoutProps.eventListenerManager.removeEventListeners(),this.__resizeDestroyEvent&&(this.__resizeDestroyEvent(),this.__resizeDestroyEvent=void 0),this.__userChangedDestroyEvent&&(this.__userChangedDestroyEvent(),this.__userChangedDestroyEvent=void 0),null===(t=this.__menuCtrl)||void 0===t||t.removeCurrentLayoutManager(this)}destroy(){this.__keepAlive||(super.destroy(),this.__helperClassesEventManager.removeEventListeners(),this.__layoutProps.eventListenerManager.removeEventListeners())}__updateUser(){const e=t.Server.getCurrentUser();this.__layoutProps.userLayoutKey=`${e}__${this.__layout.parentID}__${this.__layout.id}__${this.__layoutProps.displayMode}`;const o=this.__layoutProps.ElEditHeader.find(".tchmi-layout-manager-username-button");o&&o[0]&&(o[0].title=`${this.__localizationReader.get(this.__localKeys.Current_User)} ${e}`)}__addChild(t,e){var o,s;const i=this.__elementTemplateRoot.children().eq(e-1);if(super.__addChild(t,e),void 0===e||e<0)this.__elementTemplateRoot[0].appendChild(t.getElement()[0]);else{if(0===e)return this.__elementTemplateRoot.prepend(t.getElement()),void((null===(o=this.__layoutProps)||void 0===o?void 0:o.layoutInitialized)&&setTimeout(()=>this.__addChildToLayout(t),100));0!==i.length&&i.after(t.getElement())}this.__elementTemplateRoot[0].appendChild(t.getElement()[0]),(null===(s=this.__layoutProps)||void 0===s?void 0:s.layoutInitialized)&&setTimeout(()=>this.__addChildToLayout(t),100)}__adjustEditButtonVisibility(t){if(!TCHMI_DESIGNER&&this.__alwaysShowEditButton&&!1===t&&this.__layoutProps.allowLayoutEdit)this.__layoutProps.ElEditButton.css({"background-color":"","background-size":"60% 60%","border-radius":"7px",margin:"5px","z-index":"1000"}).prependTo(this.__layoutProps.ElCtrlElement);else{const t=this.__layoutProps.ElEditHeader.find(".tchmi-layout-manager-right-container").find(".tchmi-layout-manager-button-container")[1];this.__layoutProps.ElEditButton.css({"background-color":"transparent","background-size":"","border-radius":"",position:"",margin:"",right:"","z-index":""}).appendTo(t)}this.__adjustEditButtonTopRight(t)}__adjustEditButtonTopRight(t){if(!TCHMI_DESIGNER)if(this.__showEditButtonTopRight&&this.__alwaysShowEditButton&&!1===t){const t=this.__layoutProps.ElCtrlElement[0].getBoundingClientRect(),e=t.top,s=e>55?e-55:0,i=document.documentElement.clientWidth-t.right;this.__layoutProps.ElEditButton.css({top:o.Str.px(s),right:o.Str.px(i),position:"fixed"})}else this.__layoutProps.ElEditButton.css({top:"",right:"",position:""})}__addChildToLayout(t){const e=this.__layoutCache.find(t=>t.UserLayoutID==this.__layoutProps.userLayoutKey);let s=null,i=!0;if(null!=e&&e.StoredLayout){s=JSON.parse(e.StoredLayout).find(e=>e.id==`${t.getId()}_GridElement`),i=null==s}this.__layoutProps.displayMode==o.I_SE_DisplayMode.LAPTOP||this.__layoutProps.displayMode==o.I_SE_DisplayMode.MONITOR?this.__desktopLayoutGenerator.addControl(t,s):this.__layoutProps.displayMode==o.I_SE_DisplayMode.SMARTPHONE&&this.__mobileLayoutGenerator.addControl(t),this.__addInteractiveCtrlToLayout(t,i),this.__refreshOnControlChange(),this.__processDarkMode()}__refreshOnControlChange(){this.__layoutProps.isEditing?(this.__layoutProps.interactivityLock&&this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-edit-mask").removeClass("tchmi-layout-manager-cell-edit-mask-hidden"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-drop-button").css("visibility","visible"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-resizer").css("visibility","visible"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-cell-visible-button").css("visibility","visible"),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").css("cursor","move"),this.__addInteractiveListener()):this.__resetInteractiveListener()}__removeChild(t){super.__removeChild(t);for(let e of this.__layoutProps.ElElementTemplateRoot[0].children)e.id==`${t.getId()}_GridElement`&&this.__layoutProps.ElElementTemplateRoot[0].removeChild(e)}setHeaderColorDark(e){let o=t.ValueConverter.toObject(e);null===o&&(o=this.getAttributeDefaultValueInternal("HeaderColorDark")),o!==this.__headerColorDark&&(this.__headerColorDark=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getHeaderColorDark"]),this.__processHeaderColor())}getHeaderColorDark(){return this.__headerColorDark}setHeaderColorLight(e){let o=t.ValueConverter.toObject(e);null===o&&(o=this.getAttributeDefaultValueInternal("HeaderColorLight")),o!==this.__headerColorLight&&(this.__headerColorLight=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getHeaderColorLight"]),this.__processHeaderColor())}getHeaderColorLight(){return this.__headerColorLight}__processHeaderColor(){var t,e,o,s,i,a;this.__layoutProps.darkMode?(null===(t=this.__layoutProps.ElEditHeader)||void 0===t||t.css("background",null===(e=this.__headerColorDark)||void 0===e?void 0:e.color),this.__layoutProps.ElEditHeader.find(".tchmi-layout-manager-header-line").css("background",null===(o=this.__headerColorLight)||void 0===o?void 0:o.color)):(null===(s=this.__layoutProps.ElEditHeader)||void 0===s||s.css("background",null===(i=this.__headerColorLight)||void 0===i?void 0:i.color),this.__layoutProps.ElEditHeader.find(".tchmi-layout-manager-header-line").css("background",null===(a=this.__headerColorDark)||void 0===a?void 0:a.color))}setGridLineColor(e){let o=t.ValueConverter.toObject(e);null===o&&(o=this.getAttributeDefaultValueInternal("GridLineColor")),o!==this.__gridLineColor&&(this.__gridLineColor=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getGridLineColor"]),this.__processGridLineColor())}getGridLineColor(){return this.__gridLineColor}__processGridLineColor(){this.__layoutProps.ElSvgContainer.css("--layout-manager-grid-stroke-color",this.__gridLineColor.color)}setDarkMode(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("DarkMode")),o!==this.__layoutProps.darkMode&&(this.__layoutProps.darkMode=o,this.__processDarkMode(),t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getDarkMode"]))}getDarkMode(){return this.__layoutProps.darkMode}__processDarkMode(){var t;this.__layoutProps.darkMode?(this.__element.find(".tchmi-layout-manager-cell-drop-button").addClass("tchmi-layout-manager-cell-drop-button-dark"),this.__element.find(".tchmi-layout-manager-cell-resizer").addClass("tchmi-layout-manager-cell-resizer-dark")):(this.__element.find(".tchmi-layout-manager-cell-resizer").removeClass("tchmi-layout-manager-cell-resizer-dark"),this.__element.find(".tchmi-layout-manager-cell-drop-button").removeClass("tchmi-layout-manager-cell-drop-button-dark")),null===(t=this.__layout)||void 0===t||t.setEditHeaderTheme(),this.__processHeaderColor()}setMenuControlSymbol(e){let o=t.ValueConverter.toObject(e);null===o&&(o=this.getAttributeDefaultValueInternal("MenuControlSymbol")),o!==this.__menuCtrl&&(this.__menuCtrl=o,this.__processMenuControlSymbol(),t.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"MenuControlSymbol"}))}getMenuControlSymbol(){return this.__menuCtrl}__processMenuControlSymbol(){null!=this.__menuCtrl?(this.__menuCtrl.addCurrentLayoutManager(this),this.__layoutProps.hasMenuCtrl=!0):this.__layoutProps.hasMenuCtrl=!1}setMobileViewWidth(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("MobileViewWidth")),o!==this.__layoutProps.mobileViewTriggerWidth&&(this.__layoutProps.mobileViewTriggerWidth=o,this.__processDarkMode(),t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getMobileViewWidth"]))}getMobileViewWidth(){return this.__layoutProps.mobileViewTriggerWidth}setMonitorViewWidth(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("MonitorViewWidth")),o!==this.__layoutProps.monitorViewTriggerWidth&&(this.__layoutProps.monitorViewTriggerWidth=o,this.__processDarkMode(),t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getMonitorViewWidth"]))}getMonitorViewWidth(){return this.__layoutProps.monitorViewTriggerWidth}setDefaultViewportHeight(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("DefaultViewportHeight")),o!==this.__layoutProps.defaultVPHeight&&(this.__layoutProps.defaultVPHeight=o,t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getDefaultViewportHeight"]))}getDefaultViewportHeight(){return this.__layoutProps.defaultVPHeight}setDefaultViewportWidth(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("DefaultViewportWidth")),o!==this.__layoutProps.defaultVPWidth&&(this.__layoutProps.defaultVPWidth=o,t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getDefaultViewportWidth"]))}getDefaultViewportWidth(){return this.__layoutProps.defaultVPWidth}setDefaultControlDistance(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("DefaultControlDistance")),o!==this.__layoutProps.defaultVPWidth&&(this.__layoutProps.absolutCtrlDistance=o,this._processDefaultControlDistance(o),t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getDefaultControlDistance"]))}_processDefaultControlDistance(t){switch(this.__layoutProps.absolutCtrlDistance){case 10:this.__layoutProps.ctrlDistanceHelper=o.GridGap.XS;break;case 40:this.__layoutProps.ctrlDistanceHelper=o.GridGap.S;break;case 80:this.__layoutProps.ctrlDistanceHelper=o.GridGap.M;break;case 120:this.__layoutProps.ctrlDistanceHelper=o.GridGap.L;break;case 160:this.__layoutProps.ctrlDistanceHelper=o.GridGap.XL;break;default:this.__layoutProps.absolutCtrlDistance<10?this.__layoutProps.ctrlDistanceHelper=o.GridGap.XS:this.__layoutProps.absolutCtrlDistance>100?this.__layoutProps.ctrlDistanceHelper=o.GridGap.XL:this.__layoutProps.absolutCtrlDistance>100&&(this.__layoutProps.ctrlDistanceHelper=this.__layoutProps.absolutCtrlDistance/2)}}getDefaultControlDistance(){return this.__layoutProps.absolutCtrlDistance}setSortingType(e){let o=t.ValueConverter.toString(e);null===o&&(o=this.getAttributeDefaultValueInternal("SortingType")),o!==this.__layoutProps.sortingType&&(this.__layoutProps.sortingType=o,t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getSortingType"]))}getSortingType(){return this.__layoutProps.sortingType}setColumnNumber(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("ColumnNumber")),o!==this.__layoutProps.customColumnNumber&&(this.__layoutProps.customColumnNumber=o,t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getColumnNumber"]),this.__layoutProps.layoutInitialized&&this.__createDashboardLayout())}getColumnNumber(){return this.__layoutProps.customColumnNumber}setAllowLayoutEdit(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("AllowLayoutEdit")),o!==this.__layoutProps.allowLayoutEdit&&(this.__layoutProps.allowLayoutEdit=o,this.__processAllowLayoutEdit(),t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getAllowLayoutEdit"]))}getAllowLayoutEdit(){return this.__layoutProps.allowLayoutEdit}__processAllowLayoutEdit(){var t;!this.__layoutProps.allowLayoutEdit&&this.__layoutProps.isEditing&&this.__setEditMode(!this.__layoutProps.isEditing),this.__processAllowLayoutEdit&&null!=this.__hotKeyHandler&&(null===(t=this.__layoutProps)||void 0===t?void 0:t.allowKeyboardShortcuts)?(this.__layoutProps.eventListenerManager.addEventListener(document,"keydown",this.__hotKeyHandler.onkeyDown(),!1,"hotkey"),this.__layoutProps.eventListenerManager.addEventListener(document,"keyup",this.__hotKeyHandler.onkeyUp(),!1,"hotkey")):this.__layoutProps.eventListenerManager.removeEventListeners("hotkey"),null!=this.__layoutProps.ElEditButton&&this.__adjustEditButtonVisibility(this.__layoutProps.isEditing)}setDefaultLayout(e){let o=t.ValueConverter.toString(e);null===o&&(o=this.getAttributeDefaultValueInternal("DefaultLayout")),o!==this.__defaultLayout&&(this.__defaultLayout=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDefaultLayout"]),this.__processDefaultLayout())}getDefaultLayout(){return this.__defaultLayout}__processDefaultLayout(){}setShowPopupMessages(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("ShowPopupMessages")),o!==this.__showPopupMessages&&(this.__showPopupMessages=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowPopupMessages"]),this.__processShowPopupMessages())}getShowPopupMessages(){return this.__showPopupMessages}__processShowPopupMessages(){}setInteractivityLock(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("InteractivityLock")),o!==this.__layoutProps.interactivityLock&&(this.__layoutProps.interactivityLock=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getInteractivityLock"]),this.__processInteractivityLock())}getInteractivityLock(){return this.__layoutProps.interactivityLock}__processInteractivityLock(){const t=this.__elementTemplateRoot.find(".tchmi-layout-manager-cell-edit-mask");this.__layoutProps.isEditing&&(t.toggleClass("tchmi-layout-manager-cell-edit-mask-hidden",!this.__layoutProps.interactivityLock),t.prop("title",this.__layoutProps.interactivityLock?this.__localizationReader.get(this.__localKeys.Interactivity_Lock):""))}setButtonSize(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("ButtonSize")),o!==this.__layoutProps.buttonSize&&(this.__layoutProps.buttonSize=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getButtonSize"]),this.__processButtonSize())}getButtonSize(){return this.__layoutProps.buttonSize}__processButtonSize(){var t;const e=null===(t=this.__layoutProps.ElCtrlElement)||void 0===t?void 0:t.find(".tchmi-layout-manager-header-button");null==e||e.length<1||(e.css("height",`${this.__layoutProps.buttonSize}`),this.__layout.updateIndicatorPosition())}setAlwaysShowEditButton(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("AlwaysShowEditButton")),o!==this.__alwaysShowEditButton&&(this.__alwaysShowEditButton=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getAlwaysShowEditButton"]),this.__processAlwaysShowEditButton())}getAlwaysShowEditButton(){return this.__alwaysShowEditButton}__processAlwaysShowEditButton(){null!=this.__layoutProps.ElEditButton&&this.__adjustEditButtonVisibility(this.__layoutProps.isEditing)}setShowEditButtonTopRight(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("ShowEditButtonTopRight")),o!==this.__showEditButtonTopRight&&(this.__showEditButtonTopRight=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowEditButtonTopRight"]),this.__processShowEditButtonTopRight())}getShowEditButtonTopRight(){return this.__showEditButtonTopRight}__processShowEditButtonTopRight(){null!=this.__layoutProps.ElEditButton&&this.__adjustEditButtonVisibility(this.__layoutProps.isEditing)}setDisableAnimations(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("DisableAnimations")),o!==this.__disableAnimations&&(this.__disableAnimations=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDisableAnimations"]),this.__processDisableAnimations())}getDisableAnimations(){return this.__disableAnimations}__processDisableAnimations(){var t;null===(t=this.__layoutProps.ElCtrlElement)||void 0===t||t.toggleClass("tchmi-layout-manager-no-animation",this.__disableAnimations)}setShowUsernameButton(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("ShowUsernameButton")),o!==this.__showUsernameButton&&(this.__showUsernameButton=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowUsernameButton"]),this.__processShowUsernameButton())}getShowUsernameButton(){return this.__showUsernameButton}__processShowUsernameButton(){var t,e;const o=null===(t=this.__layoutProps.ElEditHeader)||void 0===t?void 0:t.find(".tchmi-layout-manager-username-button");if(null==o||!o.length)return;o.css("display",this.__showUsernameButton?"":"none");const s=o.closest(".tchmi-layout-manager-button-container"),i=s.children().toArray().every(t=>"none"===$(t).css("display"));s.prev(".tchmi-layout-manager-header-line").css("display",i?"none":""),null===(e=this.__layout)||void 0===e||e.updateIndicatorPosition()}setUseCustomRowHeight(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("UseCustomRowHeight")),o!==this.__layoutProps.usePredefinedRowHeight&&(this.__layoutProps.usePredefinedRowHeight=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getUseCustomRowHeight"]),this.__processUseCustomRowHeight())}getUseCustomRowHeight(){return this.__layoutProps.usePredefinedRowHeight}__processUseCustomRowHeight(){this.__layoutProps.layoutInitialized&&this.__onWindowSizeChanged()}setCustomRowHeight(e){let o=t.ValueConverter.toNumber(e);null===o&&(o=this.getAttributeDefaultValueInternal("CustomRowHeight")),o!==this.__layoutProps.predefinedRowHeightPx&&(this.__layoutProps.predefinedRowHeightPx=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getCustomRowHeight"]),this.__processCustomRowHeight())}getCustomRowHeight(){return this.__layoutProps.predefinedRowHeightPx}__processCustomRowHeight(){this.__layoutProps.layoutInitialized&&this.__onWindowSizeChanged()}setShowAddChartButton(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("ShowAddChartButton")),o!==this.__showAddChartButton&&(this.__showAddChartButton=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowAddChartButton"]),this.__processShowAddChartButton())}getShowAddChartButton(){return this.__showAddChartButton}__processShowAddChartButton(){var t;const e=null===(t=this.__layoutProps.ElEditHeader)||void 0===t?void 0:t.find(".tchmi-layout-manager-add-chart-button");null!=e&&e.length&&(this.__showAddChartButton?e.removeClass("tchmi-layout-manager-header-button-hidden"):e.addClass("tchmi-layout-manager-header-button-hidden"))}setShowAddCustomCtrlButton(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("ShowAddCustomCtrlButton")),o!==this.__showAddCustomCtrlButton&&(this.__showAddCustomCtrlButton=o,t.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowAddCustomCtrlButton"]),this.__processShowAddCustomCtrlButton())}getShowAddCustomCtrlButton(){return this.__showAddCustomCtrlButton}__processShowAddCustomCtrlButton(){var t;const e=null===(t=this.__layoutProps.ElEditHeader)||void 0===t?void 0:t.find(".tchmi-layout-manager-add-custom-ctrl-button");null!=e&&e.length&&(this.__showAddCustomCtrlButton?e.removeClass("tchmi-layout-manager-header-button-hidden"):e.addClass("tchmi-layout-manager-header-button-hidden"))}setCustomCtrlTypes(e){let o=t.ValueConverter.toObject(e);null===o&&(o=this.getAttributeDefaultValueInternal("CustomCtrlTypes"));let s=this.__objectResolvers.get("CustomCtrlTypes");s&&(s.watchDestroyer&&s.watchDestroyer(),s.resolver.destroy());let i=new t.Symbol.ObjectResolver(o);this.__objectResolvers.set("CustomCtrlTypes",{resolver:i,watchCallback:this.__onResolverForCustomCtrlTypesWatchCallback,watchDestroyer:i.watch(this.__onResolverForCustomCtrlTypesWatchCallback)})}getCustomCtrlTypes(){return this.__customCtrlTypes}__processCustomCtrlTypes(){null!=this.__customCtrlTypes&&this.__customCtrlTypes.length>0&&(this.__firstCustomCtrlTypeName=this.__customCtrlTypes[0].sControlName,this.__customCtrlDisplayName=this.__customCtrlTypes[0].sDisplayName)}setAllowKeyboardShortcuts(e){let o=t.ValueConverter.toBoolean(e);null===o&&(o=this.getAttributeDefaultValueInternal("AllowKeyboardShortcuts")),o!==this.__layoutProps.allowKeyboardShortcuts&&(this.__layoutProps.allowKeyboardShortcuts=o,this.__processAllowKeyboardShortcuts(),t.EventProvider.raise(this.__id+".onFunctionResultChanged",["getAllowKeyboardShortcuts"]))}getAllowKeyboardShortcuts(){return this.__layoutProps.allowKeyboardShortcuts}__processAllowKeyboardShortcuts(){this.__processAllowLayoutEdit()}storeDashboardLayout(e){if((this.__layoutEditor.CursorPressedMoving||this.__layoutEditor.CursorPressedScaling)&&this.__showPopupMessages)return void o.Popup.createPopup(this.__localizationReader.get(this.__localKeys.Save_Cancel),CustomElements.PopupStatus.ALARM,5e3);const s={},i={},a={layoutValue:[]};if(i.userLayoutID=this.__layoutProps.userLayoutKey,i.layoutID=this.__layoutProps.layoutID,i.userID=t.Server.getCurrentUser(),i.contentID=this.__layout.parentID,i.displayMode=o.I_SE_DisplayMode[this.__layoutProps.displayMode],a.layoutID=this.__layoutProps.layoutID,a.layoutValue=null==e?this.__layout.getCurrentLayout():e,null!=a.layoutValue)for(const t of a.layoutValue){const e=this.__elementTemplateRoot.find(`#${t.id.replace("_GridElement","")}`);null!=e&&e.length>0&&(t.type=e[0].getAttribute("data-tchmi-type"))}this.__layoutProps.displayMode===o.I_SE_DisplayMode.SMARTPHONE&&""!=this.__layoutProps.generatedFullSmartphoneLayout&&(this.__layoutProps.isEditing&&(this.__layoutProps.editedFullSmartphoneLayout=JSON.stringify(this.__layout.getCurrentLayout())),""!=this.__layoutProps.editedFullSmartphoneLayout?a.layoutValue=JSON.parse(this.__layoutProps.editedFullSmartphoneLayout):a.layoutValue=JSON.parse(this.__layoutProps.generatedFullSmartphoneLayout)),a.layoutHash=this.__layout.generateLayoutHash(),a.interactiveControls=this.__layoutProps.interactiveCtrls,s.userLayoutStoreEntry=i,s.layoutStoreEntry=a,this.__storeHandler.storeDashboardLayout(s),this.__layoutProps.displayMode===o.I_SE_DisplayMode.SMARTPHONE?this.__mobileLayoutGenerator.generatedLayout=JSON.stringify(a.layoutValue):this.__desktopLayoutGenerator.generatedLayout=JSON.stringify(a.layoutValue),this.__layoutProps.automaticLayoutChanges=[];const r=this.__layoutCache.find(t=>t.UserLayoutID==this.__layoutProps.userLayoutKey);null!=r&&(r.CurrentLayout=JSON.stringify(this.__layout.getCurrentLayout()),r.StoredLayout=JSON.stringify(this.__layout.getCurrentLayout()))}__onLayoutStored(){return t=>{const e=t.detail;e&&!this.__silentLayoutStore&&this.__showPopupMessages?o.Popup.createPopup(this.__localizationReader.get(this.__localKeys.Save_Sucess),CustomElements.PopupStatus.OK,5e3):!e&&this.__showPopupMessages&&o.Popup.createPopup(this.__localizationReader.get(this.__localKeys.Save_Error),CustomElements.PopupStatus.ALARM,5e3),this.__silentLayoutStore=!1}}__requestDashboardLayout(){const e=o.Utilities.getPersistentData(this.__layoutProps.userLayoutKey,o.StorageType.LocalStorage);if(null!=e&&""!=e)return void setTimeout(()=>this.__processTempLayout(e),20);const s=`${t.Server.getCurrentUser()}__${this.__layout.parentID}__${this.__layoutProps.displayMode}`;this.__storeHandler.requestDashboardLayout(this.__layoutProps.userLayoutKey,s)}__processTempLayout(t){const e=new CustomEvent("BackupLayoutEvent",{detail:t});this.__onLayoutReceived()(e),this.setEditMode(!0)}__onLayoutReceivedCallback(){return t=>{this.__onLayoutReceived()(t);const s=JSON.parse(t.detail);if(null!=s){const t=this.__layoutCache.find(t=>t.UserLayoutID===this.__layoutProps.userLayoutKey);null!=t&&(t.StoredLayout=JSON.stringify(s.layoutValue))}o.Utilities.__getPersistentDataFromSerExt(e.IDParser.GetLayoutIDWithoutDisplayMode(this.layoutID))}}__onLayoutReceived(){let t=this;return e=>{var s;if(null!=e.detail){const o=JSON.parse(e.detail);null!=o&&(t.__layoutProps.isUserSpecificLayout=!0,t.__layoutProps.requestedLayout=JSON.stringify(o.layoutValue),t.__layoutProps.layoutID=o.layoutID,t.__interactiveControlHandling(o.interactiveControls))}else null!=this.__defaultLayout&&this.__layoutProps.displayMode!=o.I_SE_DisplayMode.SMARTPHONE?(t.__layoutProps.isUserSpecificLayout=!0,t.__layoutProps.requestedLayout=this.__defaultLayout,t.__layoutProps.layoutID=""):(t.__layoutProps.isUserSpecificLayout=!1,t.__layoutProps.requestedLayout="",t.__layoutProps.layoutID="");""==t.__layoutProps.layoutID&&(t.__layoutProps.layoutID=t.__layoutProps.userLayoutKey),t.__createDashboardLayout(),t.__layoutProps.requestedLayout="",this.__layoutProps.displayMode===o.I_SE_DisplayMode.SMARTPHONE||this.__layoutProps.isEditing||null===(s=this.__layoutEditor)||void 0===s||s.reduceScrollbar()}}__interactiveControlHandling(e){e=void 0===e?[]:e;for(const s of this.__layoutProps.interactiveCtrls){const i=this.__element.find("#"+s.cId)[0];if(null==i||e.some(t=>t.cId===s.cId)){const e=t.Controls.get(s.cId.toString().replace("_GridElement",""));e instanceof o.DataChart&&e.updateChartID()}else this.__layoutProps.ElElementTemplateRoot[0].removeChild(i)}for(const t of e)this.__layoutProps.interactiveCtrls.some(e=>e.cId===t.cId)||this.__interactiveControlHandler.createControl(this,t.cId.replace("_GridElement",""),t.cType);this.__layoutProps.interactiveCtrls=e}addChart(){this.__interactiveControlHandler.createControl(this,null,"TcHmi.Controls.Analytics.DataChart","New charting ")}__addInteractiveCtrlToLayout(t,e){const o=this.__layoutProps.interactiveCtrls.some(e=>e.cId.includes(t.getId())),s=this.__layout.getCurrentLayout().filter(e=>e.id.includes(t.getId()));if(o&&s.length>0)if(this.__silentLayoutStore=!0,this.__layoutProps.requestedLayout&&""!=this.__layoutProps.requestedLayout){const t=JSON.parse(this.__layoutProps.requestedLayout);t.push(s[0]),e&&this.storeDashboardLayout(t)}else e&&this.storeDashboardLayout(null)}__onControlDropped(){if(this.__silentLayoutStore=!0,this.__layoutProps.requestedLayout&&""!=this.__layoutProps.requestedLayout){const t=JSON.parse(this.__layoutProps.requestedLayout);this.storeDashboardLayout(t)}else this.storeDashboardLayout(null);this.__refreshOnControlChange()}__updateRedoUndoButtons(){const t=this.__element.find(".tchmi-layout-manager-undo-button"),e=this.__element.find(".tchmi-layout-manager-redo-button");null==t||t.toggleClass("tchmi-layout-manager-header-button-disabled",!this.__undoRedoManager.canUndo),null==e||e.toggleClass("tchmi-layout-manager-header-button-disabled",!this.__undoRedoManager.canRedo)}__onDisplayModeChanging(){if(this.__hasUnsavedChanges())switch(this.__layoutProps.displayMode){case o.I_SE_DisplayMode.SMARTPHONE:this.__mobileLayoutGenerator.editedLayout=JSON.stringify(this.__layout.getCurrentLayout());break;default:this.__desktopLayoutGenerator.editedLayout=JSON.stringify(this.__layout.getCurrentLayout())}}__onDisplayModeChanged(){const e=this.__layoutCache.find(t=>t.UserLayoutID==this.__layoutProps.userLayoutKey);null!=e&&(e.CurrentLayout=JSON.stringify(this.__layout.getCurrentLayout()),e.UserLayoutChanges=JSON.parse(JSON.stringify(this.__undoRedoManager.userLayoutChanges)),e.UserLayoutChangesIdx=this.__undoRedoManager.userLayoutChangesIdx),this.__layoutProps.userLayoutKey=`${t.Server.getCurrentUser()}__${this.__layout.parentID}__${this.__layout.id}__${this.__layoutProps.displayMode}`;const o=this.__layoutCache.find(t=>t.UserLayoutID==this.__layoutProps.userLayoutKey);null!=o?(this.__undoRedoManager.reset(),this.__layoutProps.isUserSpecificLayout=!0,this.__layoutProps.requestedLayout=o.CurrentLayout,this.__desktopLayoutGenerator.editedLayout="",this.__desktopLayoutGenerator.generatedLayout="",this.__interactiveControlHandling(this.__layoutProps.interactiveCtrls),""!=o.LayoutID&&(this.__layoutProps.layoutID=o.LayoutID.toString()),this.__createDashboardLayout(),this.__layoutProps.requestedLayout="",this.__undoRedoManager.reset(),this.__undoRedoManager.userLayoutChangesIdx=o.UserLayoutChangesIdx,this.__undoRedoManager.userLayoutChanges=o.UserLayoutChanges,this.__updateRedoUndoButtons()):(this.__desktopLayoutGenerator.generatedLayout="",this.__requestDashboardLayout(),this.__undoRedoManager.reset())}__onWindowSizeChanged(){if(this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").addClass("tchmi-layout-manager-grid-cell-resizing"),this.__layoutProps.isEditing)switch(this.__layoutProps.displayMode){case o.I_SE_DisplayMode.MONITOR:this.__layoutProps.ElGridContainer.css({width:"100%"});break;case o.I_SE_DisplayMode.SMARTPHONE:const t=Math.min(this.__layoutProps.mobileViewTriggerWidth,this.__layoutProps.ElEditHeader.width());this.__layoutProps.ElGridContainer.css({width:`${t}px`})}else this.__layout.setDisplayMode();this.__desktopLayoutGenerator.hasDisplaySizeChanged=!0,this.__layout.setGridDimensions();let t=this.__layout.getCurrentLayout(),e=t.findIndex(t=>t.id.includes("grid-buffer-cell-id"));-1!=e&&t.splice(e,1);for(let e=0;e<t.length;e++){let o=this.__layoutProps.ElCtrlElement.find(`#${t[e].id}`)[0];null!=o&&null!=t[e]&&this.__layout.setGridElStyle(o,t[e])}this.__layoutProps.height=this.__layoutProps.numberOfRows*(this.__layoutProps.rowHeightPx+this.__layoutProps.gridGapPx),this.__layoutProps.ElCtrlElement[0],this.__layoutProps.isEditing?this.__layout.showGridLines():this.__layout.scaleGridSVGArea(),this.__layoutProps.ElCtrlElement.find(".tchmi-layout-manager-grid-cell").removeClass("tchmi-layout-manager-grid-cell-resizing"),this.__layout.updateIndicatorPosition()}__watchCtrlSize(){null!=this.__layoutProps.ElCtrlElement[0]&&this.__layoutProps.ElCtrlElement[0].getBoundingClientRect().width!=this.__widthBfr&&(setTimeout(()=>this.__onWindowSizeChanged(),500),this.__widthBfr=this.__layoutProps.ElCtrlElement[0].getBoundingClientRect().width)}storeAndExitLayoutEditor(){this.storeDashboardLayout(null),this.__layoutProps.isEditing&&this.__setEditMode(!this.__layoutProps.isEditing)}setAccessPermissions(t){this.setAccessConfig(t),this.__processAccessConfig()}__processAccessConfig(){super.__processAccessConfig();const e=t.Server.getGroupsOfCurrentUser(),o=this.getAccessConfig().filter(t=>e.find(e=>e==t.group));if(null!=o){const e=o.some(e=>e.accessright==t.AccessRight.operate&&e.permission==t.Permission.allow),s=o.some(e=>e.accessright==t.AccessRight.observe&&e.permission==t.Permission.allow),i=o.some(e=>e.accessright==t.AccessRight.observe&&e.permission==t.Permission.deny);e||s||i?e?this.setAllowLayoutEdit(!0):(s||i)&&this.setAllowLayoutEdit(!1):this.setAllowLayoutEdit(!0)}}__addInteractiveListener(){try{this.__resetInteractiveListener();for(let t=0;t<this.__elementTemplateRoot.children().length;t++){if("tchmi-layout-manager-grid-buffer-cell"===this.__elementTemplateRoot.children()[t].className)continue;const e=this.__elementTemplateRoot.children()[t].querySelector(".tchmi-layout-manager-cell-resizer");null!=e&&(this.__layoutProps.eventListenerManager.addEventListener(e,"mousedown",this.__layoutEditor.mousedownScaling(t)),this.__layoutProps.eventListenerManager.addEventListener(e,"touchstart",this.__layoutEditor.mousedownScaling(t)));const o=this.__elementTemplateRoot.children()[t].querySelector(".tchmi-layout-manager-cell-visible-button");null!=o&&(this.__layoutProps.eventListenerManager.addEventListener(o,"mousedown",this.__layoutEditor.setControlVisibility(t)),this.__layoutProps.eventListenerManager.addEventListener(o,"touchstart",this.__layoutEditor.setControlVisibility(t)));const s=this.__elementTemplateRoot.children()[t].querySelector(".tchmi-layout-manager-cell-drop-button");null!=s&&(this.__layoutProps.eventListenerManager.addEventListener(s,"mousedown",this.__interactiveControlHandler.removeCtrl(t)),this.__layoutProps.eventListenerManager.addEventListener(s,"touchstart",this.__interactiveControlHandler.removeCtrl(t))),this.__layoutProps.eventListenerManager.addEventListener(this.__elementTemplateRoot.children()[t],"mousedown",this.__layoutEditor.mousedownMoving(t)),this.__layoutProps.eventListenerManager.addEventListener(this.__elementTemplateRoot.children()[t],"touchstart",this.__layoutEditor.mousedownMoving(t))}}catch(t){console.info("No eventlistener set included")}this.__layoutProps.eventListenerManager.addEventListener(this.__layoutProps.ElGridContainer[0],"mousedown",()=>this.__addMouseMoveEvent(),!1),this.__layoutProps.eventListenerManager.addEventListener(this.__layoutProps.ElGridContainer[0],"touchstart",()=>this.__addMouseMoveEvent(),!1),this.__layoutProps.eventListenerManager.addEventListener(document,"mouseup",this.__layoutEditor.mouseup()),this.__layoutProps.eventListenerManager.addEventListener(document,"touchend",this.__layoutEditor.mouseup()),this.__layoutProps.eventListenerManager.addEventListener(document,"mouseleave",this.__layoutEditor.mouseup());const t=this.__layoutProps.ElEditHeader.find(".tchmi-layout-manager-header-button");this.__layoutProps.eventListenerManager.addEventListener(t[0],"click",()=>this.__undoRedoManager.undoLastAction()),this.__layoutProps.eventListenerManager.addEventListener(t[1],"click",()=>this.__undoRedoManager.redoLastAction()),this.__layoutProps.eventListenerManager.addEventListener(t[2],"click",()=>this.resetLayout()),this.__layoutProps.eventListenerManager.addEventListener(t[3],"click",()=>this.__movementExaminer.slideUpElements()),this.__layoutProps.eventListenerManager.addEventListener(t[4],"click",()=>this.addChart()),this.__layoutProps.eventListenerManager.addEventListener(t[5],"click",()=>this.__interactiveControlHandler.createControl(this,null,this.__firstCustomCtrlTypeName,`New ${this.__customCtrlDisplayName}`)),null!=this.__localizationReader&&(t[5].title=`${this.__localizationReader.get(this.__localKeys.Add)} ${this.__customCtrlDisplayName}`),this.__layoutProps.eventListenerManager.addEventListener(this.__layoutProps.ElDesktopButton[0],"click",()=>{this.onDisplayModeButtonClicked(o.I_SE_DisplayMode.MONITOR)}),this.__layoutProps.eventListenerManager.addEventListener(this.__layoutProps.ElMobileButton[0],"click",()=>{this.onDisplayModeButtonClicked(o.I_SE_DisplayMode.SMARTPHONE)}),this.__layoutProps.eventListenerManager.addEventListener(t[9],"click",()=>this.storeAndExitLayoutEditor()),this.__layoutProps.eventListenerManager.addEventListener(t[10],"click",()=>this.storeDashboardLayout(null))}__addMouseMoveEvent(){this.__layoutProps.eventListenerManager.addEventListener(document,"mousemove",this.__layoutEditor.mousemove(),!1,"LayoutManagerMouseMove"),this.__layoutProps.eventListenerManager.addEventListener(document,"touchmove",this.__layoutEditor.mousemove(),{passive:!1},"LayoutManagerMouseMove")}__resetInteractiveListener(){var t;this.__layoutProps.eventListenerManager.removeEventListeners(),this.__layoutProps.eventListenerManager.addEventListener(this.__layoutProps.ElEditButton[0],"click",()=>this.__setEditMode(!this.__layoutProps.isEditing)),this.__layoutProps.eventListenerManager.addEventListener(window,"beforeunload",this.__unsavedChangesHandling()),this.__processAllowLayoutEdit&&(null===(t=this.__layoutProps)||void 0===t?void 0:t.allowKeyboardShortcuts)&&(this.__layoutProps.eventListenerManager.addEventListener(document,"keydown",this.__hotKeyHandler.onkeyDown(),!1,"hotkey"),this.__layoutProps.eventListenerManager.addEventListener(document,"keyup",this.__hotKeyHandler.onkeyUp(),!1,"hotkey"))}onDisplayModeButtonClicked(t){if(!this.__layoutProps.isEditing)return;switch(t){case o.I_SE_DisplayMode.MONITOR:this.__layoutProps.ElGridContainer.css({width:"100%"});break;case o.I_SE_DisplayMode.SMARTPHONE:const t=Math.min(this.__layoutProps.mobileViewTriggerWidth,this.__layoutProps.ElEditHeader.width());this.__layoutProps.ElGridContainer.css({width:`${t}px`})}this.__layoutProps.displayMode=t,this.__layout.updateIndicatorPosition(),this.__animationFrameId&&(cancelAnimationFrame(this.__animationFrameId),this.__animationFrameId=null);let e=null;const s=this.__disableAnimations?0:500,i=o=>{e||(e=o);const a=o-e;this.__onWindowSizeChanged(),a<s?this.__animationFrameId=requestAnimationFrame(i):(this.__layout.setDisplayMode(t),this.__animationFrameId=null)};this.__animationFrameId=requestAnimationFrame(i)}setEditMode(t){this.__setEditMode(t)}__setEditMode(e,s=!1){if(this.__element.find(".tchmi-layout-manager-grid-cell").addClass("tchmi-layout-manager-grid-cell-resizing"),e)this.__layoutProps.allowLayoutEdit?(this.__layoutEditor.enableLayoutEditing(),this.__adjustEditButtonVisibility(!0)):console.info("Edit Layout not allowed. Please check properties");else{if((this.__layoutEditor.CursorPressedMoving||this.__layoutEditor.CursorPressedScaling)&&this.__showPopupMessages)return void o.Popup.createPopup(this.__localizationReader.get(this.__localKeys.Exit_Cancel),CustomElements.PopupStatus.ALARM,5e3);this.__layoutEditor.disableLayoutEditing(),this.__adjustEditButtonVisibility(!1),setTimeout(()=>{this.__onWindowSizeChanged()},500)}this.__processInteractivityLock(),this.__layout.setControlsOpacity(),this.__element.find(".tchmi-layout-manager-grid-cell").addClass("tchmi-layout-manager-grid-cell-resizing"),this.__layoutProps.ElEditButton.toggleClass("active",this.__layoutProps.isEditing),t.EventProvider.raise(this.__id+".onEditModeChanged")}__storeDefaultControlParameter(){for(let e=0;e<this.__elementTemplateRoot.children().length;e++){this.__layoutProps.defaultCtrlStyle[`${this.__elementTemplateRoot.children()[e].id}_GridElement`]=this.__elementTemplateRoot.children()[e].getAttribute("style");let s={},i=this.__elementTemplateRoot.children()[e].style.left;if(null!=i)s.left=Number.parseFloat(i),i.includes("%")?s.leftUnit=o.LengthUnit.PERCENT:s.leftUnit=o.LengthUnit.PIXEL;else{let t=this.__elementTemplateRoot.children()[e].style.right;s.left=this.__layoutProps.defaultVPWidth-Number.parseFloat(t),null!=t&&(t.includes("%")?s.leftUnit=o.LengthUnit.PERCENT:s.leftUnit=o.LengthUnit.PIXEL)}let a=this.__elementTemplateRoot.children()[e].style.top;if(null!=a)s.top=Number.parseFloat(a),a.includes("%")?s.topUnit=o.LengthUnit.PERCENT:s.topUnit=o.LengthUnit.PIXEL;else{let t=this.__elementTemplateRoot.children()[e].style.bottom;s.top=this.__layoutProps.defaultVPHeight-Number.parseFloat(t),null!=t&&(t.includes("%")?s.topUnit=o.LengthUnit.PERCENT:s.topUnit=o.LengthUnit.PIXEL)}let r=this.__elementTemplateRoot.children()[e].style.width;null!=r&&(r.includes("%")?(s.width=t.ValueConverter.toNumber(r.replace("%","")),s.widthUnit=o.LengthUnit.PERCENT):(s.width=t.ValueConverter.toNumber(r.replace("px","")),s.widthUnit=o.LengthUnit.PIXEL));let l=this.__elementTemplateRoot.children()[e].style.height;null!=l&&(l.includes("%")?(s.height=t.ValueConverter.toNumber(l.replace("%","")),s.heightUnit=o.LengthUnit.PERCENT):(s.height=t.ValueConverter.toNumber(l.replace("px","")),s.heightUnit=o.LengthUnit.PIXEL)),s.id=`${this.__elementTemplateRoot.children()[e].id}_GridElement`,this.__layoutProps.defaultCtrlPosition.push(s)}this.__layoutProps.defaultCtrlPosition.sort((t,e)=>t.top-e.top)}resetLayout(t=!1){this.__mobileLayoutGenerator.editedLayout="",this.__desktopLayoutGenerator.editedLayout="",this.__mobileLayoutGenerator.generatedLayout="",this.__desktopLayoutGenerator.generatedLayout="",this.__mobileLayoutGenerator.editedLayout="",this.__desktopLayoutGenerator.editedLayout="",this.__layoutProps.mobileLayoutInitialized=!1,t&&(this.__layoutCache=[]),this.__layout.resetLayout(t),t&&this.__processAccessConfig()}__createDashboardLayout(){var t;if(this.__layout.setGridDimensions(),this.__layoutProps.displayMode==o.I_SE_DisplayMode.SMARTPHONE?((null===(t=this.__layoutProps.requestedLayout)||void 0===t?void 0:t.length)>0&&(this.__layoutProps.generatedFullSmartphoneLayout=this.__layoutProps.requestedLayout),this.__mobileLayoutGenerator.createLayout(),this.__layoutProps.isEditing||this.__layout.checkForGapsSmartphone()):this.__desktopLayoutGenerator.createLayout(),this.__layoutProps.isEditing&&(this.__layout.showGridLines(),this.__addInteractiveListener()),this.__layoutProps.layoutInitialized||(this.__layout.createBufferCellElement(),this.__layoutProps.ElElementTemplateRoot[0].style.opacity="1",this.__layoutProps.layoutInitialized=!0),this.__desktopLayoutGenerator.hasDisplaySizeChanged=!1,this.__layoutProps.isLayoutReset=!1,this.__layout.calcCurrentLayout(),this.__layoutProps.isEditing&&this.__layout.changeRowNumber(1),null==this.__layoutCache.find(t=>t.UserLayoutID==this.__layoutProps.userLayoutKey)){const t={};t.CurrentLayout=JSON.stringify(this.__layout.getCurrentLayout()),t.UserLayoutID=this.__layoutProps.userLayoutKey.toString(),t.LayoutID=this.__layoutProps.layoutID.toString(),t.DisplayMode=this.__layoutProps.displayMode,this.__layoutCache.push(t)}}__unsavedChangesHandling(){return t=>{this.__hasUnsavedChanges()&&t.preventDefault()}}__hasUnsavedChanges(){var t;const e=null!=(null===(t=this.__layoutCache)||void 0===t?void 0:t.find(t=>t.UserLayoutChangesIdx>0)),o=this.__undoRedoManager.canUndo;return e||o}__addLocalizedElement(t,e,...o){let s={key:e};0!==o.length&&(s.parameters=o),this.__localizedElements.set(t,s)}__removeLocalizedElement(t){this.__localizedElements.delete(t)}}o.LayoutManager=s}(o=e.Analytics||(e.Analytics={}))}(e=t.Controls||(t.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("LayoutManager","TcHmi.Controls.Analytics",TcHmi.Controls.Analytics.LayoutManager);