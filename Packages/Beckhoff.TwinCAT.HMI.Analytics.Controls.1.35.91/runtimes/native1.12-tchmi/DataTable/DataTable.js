var TcHmi,__awaiter=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(l,a){function r(e){try{n(i.next(e))}catch(e){a(e)}}function o(e){try{n(i.throw(e))}catch(e){a(e)}}function n(e){var t;e.done?l(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}n((i=i.apply(e,t||[])).next())}))};!function(e){let t;!function(t){let s;!function(t){class s extends e.Controls.Analytics.AnalyticsControl{constructor(t,s,i){super(t,s,i),this.__processTableExecuting=0,this.__columnSortings=[],this.__columnWidth=[],this.__oldResults=[],this.__oldDataMatrix=[],this.__columnDragging=!1,this.__onResized=()=>(e,t)=>{super.__getScaleFactor();if(0==this.__hasLicense)return;let s=this.__fontsizeTitle;this.__showTitle||(s=0),this.__tableHeight=this.getRenderedHeight()-s-15,this.__tableWidth=this.getRenderedWidth()-10,this.__elContainer.css("height",this.__tableHeight),this.__elContainer.css("width",this.__tableWidth);this.__elSection.css("left",(this.getRenderedWidth()-50)/2+"px"),this.__elSection.css("top",(this.getRenderedHeight()-50)/2+"px")},this.__onResolverForResultsWatchCallback=t=>{this.__isAttached||this.__suspendObjectResolver("Results"),t.error===e.Errors.NONE?tchmi_equal(t.value,this.__results)||(this.__results=t.value||null,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getResults"]),this.__processResults()):e.Log.error(`[Source=Control, Module=TcHmi.Controls.Analytics.DataTable, Id=${this.getId()}, Attribute=Results] Resolving symbols from object failed with error: ${e.Log.buildMessage(t.details)}`)},this.__hasEditable=null}__previnit(){super.__previnit(),0!=this.__hasLicense&&(this.__defaultWidth=470,this.__defaultHeight=310,this.__elContainer=this.__elementTemplateRoot.find(".tchmi-datatable-container"),this.__elTable=this.__elContainer.find(".tchmi-datatable-table"),this.__elColumnSeparator=$([]),this.__elTableRow=$([]),this.__elTableCell=$([]),this.__elTableCellHeader=$([]),this.__elTableCellValue=$([]),this.__elTableCellText=$([]),this.__elTableCellHeaderText=$([]),this.__elTableCellValueText=$([]),this.__elSection=this.__elementTemplateRoot.find(".tchmi-datatable-section"),this.__elSaveButton=this.__elementTemplateRoot.find(".tchmi-datatable-save-button"),this.__columnSortingKey=this.__secureId+"_clmSorting",this.__loadSortingInfo())}__init(){let e=[new t.Property(this,"TableType","Table Type",t.E_DataType.COMBOBOX,{comboBoxOptions:[{value:"Horizontal",displayName:"Horizontal"},{value:"Vertical",displayName:"Vertical"}]}),new t.Property(this,"AmountDecimals","AmountDecimals",t.E_DataType.UINTEGER),new t.Property(this,"ShowMilliseconds","Show Milliseconds",t.E_DataType.BOOLEAN),new t.Property(this,"FontsizeHeader","Fontsize Header",t.E_DataType.UINTEGER),new t.Property(this,"FontsizeItem","Fontsize Item",t.E_DataType.UINTEGER),new t.Property(this,"DynamicFontSizeItem","Dynamic Fontsize Item",t.E_DataType.BOOLEAN)];super.setEditableProperties(e),super.__init(),this.__columnWidthkey=this.__secureId+"_columnWidth",t.Utilities.getPersistentData(this.__columnWidthkey)&&(this.__columnWidth=JSON.parse("["+t.Utilities.getPersistentData(this.__columnWidthkey)+"]")),this.addEventListener(this.__elementTemplateRoot[0],"mousemove",this.__mouseTouchMove()),this.addEventListener(this.__elementTemplateRoot[0],"touchmove",this.__mouseTouchMove()),this.addEventListener(this.__elSaveButton[0],"click",this.__saveButtonClicked()),this.addOtherElementClickedEvent(this.__elementTemplateRoot[0],()=>{this.__closeChangeParameters()})}__attach(){super.__attach(),this.__onResized()(null,null),null!=this.__results&&this.__processTable()}__detach(){super.__detach(),cancelAnimationFrame(this.__processTableExecuting)}destroy(){this.__keepAlive||super.destroy()}__processFontColor(){this.__elementsText=this.__elementTemplateRoot.find(".tchmi-analytics-text"),super.__processFontColor.call(this)}__processColorGradient(){this.__processColor()}__processColor(){if(this.__isAttached){var e=this.GetColorGradientLighter(this.hexToRgbA(this.__controlColorMiddleTable),this.__colorGradient),t="linear-gradient("+this.__controlColorMiddleTable+","+e+" 35% ,"+this.__controlColorMiddleTable+")";this.__elTableCellHeader.css("background",t);var s=this.GetColorGradientLighter(this.hexToRgbA(this.__itemColor),this.__colorGradient),i="linear-gradient("+this.__itemColor+","+s+" 35%,"+this.__itemColor+")";this.__elTableCellValue.css("background",i);this.GetColorGradientLighter(this.hexToRgbA(this.__itemColor),this.__colorGradient),this.__itemColor,this.__itemColor}}setTableType(t){let s=t;null!==s?s!==this.__tableType&&(this.__tableType=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getTableType"]),this.__processTableType()):s=this.getAttributeDefaultValueInternal("TableType")}getTableType(){return this.__tableType}__processTableType(){"Vertical"===this.__tableType&&(this.__columnSortings=[],t.Utilities.deletePersistentData(this.__columnSortingKey)),this.__processTable(!0)}setItemColor(t){var s=e.ValueConverter.toString(this.rgbaToHex(t.color));null===s&&(s=this.getAttributeDefaultValueInternal("ItemColor")),s!==this.__itemColor&&(this.__itemColor=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getItemColor"]),this.__processItemColor())}getItemColor(){return this.rgbaToHex(this.__itemColor)}__processItemColor(){this.__processColor()}setControlColorMiddleTable(t){var s=e.ValueConverter.toString(this.rgbaToHex(t.color));null===s&&(s=this.getAttributeDefaultValueInternal("ControlColorMiddleTable")),s!==this.__controlColorMiddleTable&&(this.__controlColorMiddleTable=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getControlColorMiddleTable"]),this.__processColor())}getControlColorMiddleTable(){return this.rgbaToHex(this.__controlColorMiddleTable)}setControlColorDarkTable(t){var s=e.ValueConverter.toString(this.rgbaToHex(t.color));null===s&&(s=this.getAttributeDefaultValueInternal("ControlColorDarkTable")),s!==this.__controlColorDarkTable&&(this.__controlColorDarkTable=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getControlColorDarkTable"]),this.__processColor())}getControlColorDarkTable(){return this.rgbaToHex(this.__controlColorDarkTable)}getFontsizeHeader(){return this.__fontsizeHeader}setFontsizeHeader(t){var s=e.ValueConverter.toNumber(t);null===s&&(s=this.getAttributeDefaultValueInternal("FontsizeHeader")),s!==this.__fontsizeHeader&&(this.__fontsizeHeader=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getFontsizeHeader"]),this.__processFontsizeHeader())}__processFontsizeHeader(){null!=this.__fontsizeHeader&&(this.__elTableCellHeaderText.css("font-size",this.__fontsizeHeader+"px"),e.EventProvider.raise(`${this.__id}.onResized`,null))}getFontsizeItem(){return this.__fontsizeItem}setFontsizeItem(t){var s=e.ValueConverter.toNumber(t);null===s&&(s=this.getAttributeDefaultValueInternal("FontsizeItem")),s!==this.__fontsizeItem&&(this.__fontsizeItem=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getFontsizeItem"]),this.__processFontsizeItem())}__processFontsizeItem(){null!=this.__fontsizeItem&&(this.__elTableCellValueText.css("font-size",this.__fontsizeItem+"px"),e.EventProvider.raise(`${this.__id}.onResized`,null))}setMonthAlias(t){var s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("MonthAlias")),s!==this.__monthAlias&&(this.__monthAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getMonthAlias"]),this.__processMonthAlias())}getMonthAlias(){return this.__monthAlias}__processMonthAlias(){t.DCTimestruct.monthAlias=this.__monthAlias,this.__processTable()}setResults(t){var s=e.ValueConverter.toObject(t);this.__resultsSymbols=s,null===s&&(s=this.getAttributeDefaultValueInternal("Results")),this.__rawResults=s;let i=this.__objectResolvers.get("Results");i&&(i.watchDestroyer&&i.watchDestroyer(),i.resolver.destroy());let l=new e.Symbol.ObjectResolver(s);this.__objectResolvers.set("Results",{resolver:l,watchCallback:this.__onResolverForResultsWatchCallback,watchDestroyer:l.watch(this.__onResolverForResultsWatchCallback)})}getResults(){return this.__results}__processResults(){this.__elContainer.css("visibility","visible"),this.__elSection.css("display","none"),this.__processTable()}setDynamicFontSizeItem(t){var s=e.ValueConverter.toBoolean(t);null!==s?s!==this.__dynamicFontSizeItem&&(this.__dynamicFontSizeItem=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDynamicFontSizeItem"]),this.__processDynamicFontSizeItem()):s=this.getAttributeDefaultValueInternal("DynamicFontSizeItem")}getDynamicFontSizeItem(){return this.__dynamicFontSizeItem}__processDynamicFontSizeItem(){this.__processTable()}__processAmountDecimals(){super.__processAmountDecimals(),this.__processTable()}setNotAllMappedAlias(t){var s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("NotAllMappedAlias")),s!==this.__notAllMappedAlias&&(this.__notAllMappedAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getNotAllMappedAlias"]),this.__processNotAllMappedAlias())}getNotAllMappedAlias(){return this.__notAllMappedAlias}__processNotAllMappedAlias(){}setErrorParametersAlias(t){var s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("ErrorParametersAlias")),s!==this.__errorParametersAlias&&(this.__errorParametersAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getErrorParametersAlias"]),this.__processErrorParametersAlias())}getErrorParametersAlias(){return this.__errorParametersAlias}__processErrorParametersAlias(){}setSuccessParametersAlias(t){var s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("SuccessParametersAlias")),s!==this.__successParametersAlias&&(this.__successParametersAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getSuccessParametersAlias"]),this.__processSuccessParametersAlias())}getSuccessParametersAlias(){return this.__successParametersAlias}__processSuccessParametersAlias(){}setChangeParametersAlias(t){var s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("ChangeParametersAlias")),s!==this.__changeParametersAlias&&(this.__changeParametersAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getChangeParametersAlias"]),this.__processChangeParametersAlias())}getChangeParametersAlias(){return this.__changeParametersAlias}__processChangeParametersAlias(){}setResetColumnSizeAlias(t){var s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("ResetColumnSizeAlias")),s!==this.__resetColumnSizeAlias&&(this.__resetColumnSizeAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getResetColumnSizeAlias"]),this.__processResetColumnSizeAlias())}getResetColumnSizeAlias(){return this.__resetColumnSizeAlias}__processResetColumnSizeAlias(){}setShowMilliseconds(t){let s=e.ValueConverter.toBoolean(t);null===s&&(s=this.getAttributeDefaultValueInternal("ShowMilliseconds")),s!==this.__showMilliseconds&&(this.__showMilliseconds=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getShowMilliseconds"]),this.__processShowMilliseconds())}getShowMilliseconds(){return this.__showMilliseconds}__processShowMilliseconds(){}setDayAlias(t){var s=e.ValueConverter.toString(t);null===s&&(s=this.getAttributeDefaultValueInternal("DayAlias")),s!==this.__dayAlias&&(this.__dayAlias=s,e.EventProvider.raise(`${this.__id}.onFunctionResultChanged`,["getDayAlias"]),this.__processDayAlias())}getDayAlias(){return this.__dayAlias}__processDayAlias(){}__setHasEditable(e){e!==this.__hasEditable&&(this.__hasEditable=e,this.__processHasEditable())}__processHasEditable(){let e=[new t.EditAreaItem("tchmi-analytics-edit-properties",this.__editPropertiesAlias,'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/AnalyticsControl/Images/properties.png")',null,super.__onPropertiesClicked())];this.__hasEditable&&e.push(new t.EditAreaItem("tchmi-data-table-change-parameters",this.__changeParametersAlias,'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/AnalyticsControl/Images/edit.png")',null,this.__changeParametersClicked())),e.push(new t.EditAreaItem("tchmi-data-table-reset-column-size",this.__resetColumnSizeAlias,'url("/Beckhoff.TwinCAT.HMI.Analytics.Controls/AnalyticsControl/Icons/reset.svg")',"tchmi-analytics-background-size-contain",this.__resetColumnSizeClicked())),super.__createEditArea(e)}__processTable(e=!1){e&&(cancelAnimationFrame(this.__processTableExecuting),this.__processTableExecuting=0,this.__processTableDirectly(e)),0===this.__processTableExecuting&&(this.__processTableExecuting=requestAnimationFrame(()=>{this.__processTableExecuting=0,this.__processTableDirectly(e)}))}__processTableDirectly(e=!1){if(!this.__isAttached||null==this.__results)return;let t,s=this.__getResultMatrix();t="Vertical"===this.__tableType?s[0].map((e,t)=>s.map(e=>e[t])):s,(e||this.__resultsShapeChanged())&&this.__redrawTable(t,s),this.__updateTable(t,e),this.__oldDataMatrix=t,this.__oldResults=this.__results}__redrawTable(e,s){this.removeEventListeners("table"),this.__elTable[0].innerHTML="",this.__paramReconfigureList=[];for(let i=0;i<e.length;++i){let l=document.createElement("tr");l.className="tchmi-datatable-row";let r=!0;for(let o=0;o<e[i].length;++o){let n,_=e[i][o],h=document.createElement("td");if(_ instanceof a?(h.className="tchmi-datatable-cell tchmi-datatable-cell-value tchmi-analytics-text",r=!1):h.className="tchmi-datatable-cell tchmi-datatable-cell-header tchmi-analytics-text",h.style.color=this.__fontColor,_ instanceof a&&_.editable)if(n=document.createElement("input"),n.className="tchmi-datatable-cell-text",this.__parametersChanging){let e;n.className+=" tchmi-datatable-cell-input-changing",e="Vertical"===this.__tableType?s[o]:s[i],this.addEventListener(n,"mousedown",this.__cellClicked(e,_.symbol),!1,"table"),this.addEventListener(n,"keydown",this.__cellKeyPressed(),!1,"table"),this.addEventListener(n,"mouseenter",this.__cellMouseEnter(),!1,"table"),this.addEventListener(n,"mouseleave",this.__cellMouseLeave(),!1,"table")}else n.style.pointerEvents="none";else n=document.createElement("div"),n.className="tchmi-datatable-cell-text";if("Vertical"===this.__tableType||0===o||e[i][o]instanceof a||""===e[i][o].value)h.appendChild(n);else{let e=document.createElement("div");e.className="tchmi-datatable-cell-text-container";let s=document.createElement("div");s.className="tchmi-analytics-control-arrow-filled-icon tchmi-datatable-sorting-icon tchmi-analytics-svg-mask",s.style.backgroundColor=this.__fontColor;let l=this.__columnSortings.find(e=>e.rowIdx===i&&e.clmIdx===o);void 0!==l&&(l.type===t.SortingType.DESC?s.className+=" tchmi-datatable-sorting-icon-desc":l.type===t.SortingType.ASC&&(s.className+=" tchmi-datatable-sorting-icon-asc")),e.appendChild(n),h.appendChild(e),h.appendChild(s),h.style.cursor="pointer",this.addEventListener(h,"mousedown",this.__onSubheaderCellClicked(o,i),!1,"table")}if(l.appendChild(h),0===i&&o<e[i].length-1){let e=document.createElement("div");e.className="tchmi-datatable-header-separator",this.addEventListener(e,"mousedown",this.__clmSepMouseOrTouchDown(o),!0,"table"),this.addEventListener(e,"touchstart",this.__clmSepMouseOrTouchDown(o),!0,"table"),this.addEventListener(document,"mouseup",this.__mouseOrTouchUp(),!0,"table"),this.addEventListener(document,"touchend",this.__mouseOrTouchUp(),!0,"table"),h.appendChild(e)}}!r&&this.__parametersChanging&&(this.addEventListener(l,"mouseenter",this.__rowMouseEnter(),!1,"table"),this.addEventListener(l,"mouseleave",this.__rowMouseLeave(),!1,"table")),this.__elTable[0].appendChild(l)}if(this.__elContainer=this.__elementTemplateRoot.find(".tchmi-datatable-container"),this.__elTable=this.__elContainer.find(".tchmi-datatable-table"),this.__elColumnSeparator=this.__elContainer.find(".tchmi-datatable-header-separator"),this.__elTableRow=this.__elContainer.find(".tchmi-datatable-row"),this.__elTableCell=this.__elContainer.find(".tchmi-datatable-cell"),this.__elTableCellHeader=this.__elContainer.find(".tchmi-datatable-cell-header"),this.__elTableCellValue=this.__elContainer.find(".tchmi-datatable-cell-value"),this.__elTableCellText=this.__elTableCell.find(".tchmi-datatable-cell-text"),this.__elTableCellHeaderText=this.__elTableCellHeader.find(".tchmi-datatable-cell-text"),this.__elTableCellValueText=this.__elTableCellValue.find(".tchmi-datatable-cell-text"),this.__processColor(),e.length>0&&this.__columnWidth.length!==e[0].length){let s=100/e[0].length;this.__columnWidth=t.Utilities.getFilledArray(e[0].length,s)}this.__columnWidth.forEach((e,t,s)=>{$(this.__elTableRow[0]).find(".tchmi-datatable-cell")[t].style.width=e+"%"}),this.__elTableCellHeader.css("font-size",this.__fontsizeHeader+"px"),this.__elTableCellValue.css("font-size",this.__fontsizeItem+"px")}__updateTable(e,t){for(let s=0;s<e.length;++s)for(let i=0;i<e[s].length;++i){const l=i,a=e[s][l];if(void 0===this.__oldDataMatrix[s]||void 0===this.__oldDataMatrix[s][l]||!tchmi_equal(a.value,this.__oldDataMatrix[s][l].value)||t){const e=$(this.__elTableRow[s]).find(".tchmi-datatable-cell-text");this.__writeCellData(e[i],a,t),this.__dynamicFontSizeItem&&this.scaleDownFontToFit(e[i])}}}__getResultMatrix(){let e,s=[],r=!0;this.__results.length>0&&(e=this.__results[0].datavalues.map(e=>e.displayName));let o=!1,n=this.__getMaxColumns(),_=0,h=[];for(let t=0;t<this.__results.length;++t){let c=this.__results[t],u=new i(c.name,this.__rawResults[t].reconfigure);u.push(new l(""));let d=new i(c.name,this.__rawResults[t].reconfigure);d.push(new l(c.name));let m=1;for(let s=0;s<c.datavalues.length;++s){let i=c.datavalues[s],n=this.__rawResults[t].datavalues[s].sValue;u.push(new l(i.displayName)),d.push(new a(t,i.sKey,i.sValue,i.editable,n)),i.editable&&(o=!0),(e.length<s||i.displayName!==e[s])&&(r=!0),++m}for(let e=c.datavalues.length;e<n;++e)u.push(new l("")),d.push(new a(t,"","",!1,"")),++m;r?(s.push(u),h.push(!0),e=c.datavalues.map(e=>e.displayName),r=!1,_+=2):++_,h.push(!1),s.push(d)}this.__setHasEditable(o);try{this.__columnSortings.forEach(e=>{if(e.type===t.SortingType.NONE)return;e={clmIdx:e.clmIdx,rowIdx:e.rowIdx+1,type:e.type};let i=h.indexOf(!0,e.rowIdx);-1===i&&(i=s.length);let l=s.slice(e.rowIdx,i);l.sort((s,i)=>{var l,a;e.type===t.SortingType.ASC?(l=i[e.clmIdx].value,a=s[e.clmIdx].value):e.type===t.SortingType.DESC&&(l=s[e.clmIdx].value,a=i[e.clmIdx].value);var r=parseFloat(l),o=parseFloat(a);return isNaN(r)||isNaN(o)||(l=r,a=o),l<a?-1:l>a?1:0});for(let t=e.rowIdx;t<i;++t)s[t]=l[t-e.rowIdx]})}catch(e){this.__columnSortings=[],t.Utilities.deletePersistentData(this.__columnSortingKey)}return s}__getMaxColumns(){let e=0;for(let t=0;t<this.__results.length;++t)e<this.__results[t].datavalues.length&&(e=this.__results[t].datavalues.length);return e}__resultsShapeChanged(){if(this.__results.length!==this.__oldResults.length)return!0;for(var e=0;e<this.__results.length;++e)if(this.__results[e].datavalues.length!==this.__oldResults[e].datavalues.length)return!0;return!1}__writeCellData(e,t,s){if(t instanceof a&&"eClass"===t.name){var i=this.__itemColor;switch(t.value){case 1:i="#008000";break;case 2:i="#FFFF00";break;case 3:i="#EF0000"}var l="linear-gradient("+i+","+this.GetColorGradientLighter(this.hexToRgbA(i),this.__colorGradient)+" 35%,"+i+")";e.style.background=l}else if(t instanceof a){if(!this.__parametersChanging||s){const s=`Row${t.dataTableItemIdx}_${t.name}`,i=super.getFormattedString(t.value,this.__monthAlias,this.__dayAlias,this.__showMilliseconds,s);t.editable?e.value=i:e.innerHTML=i}}else{let s=t.value;null==s&&(s=""),e.innerHTML=String(s)}}__saveSortingInfo(){let e=JSON.stringify(this.__columnSortings);const s=this.__parent instanceof t.LayoutManager?this.__parent.layoutIDWithoutDisplayMode:null;t.Utilities.setPersistentData(this.__columnSortingKey,e,s)}__loadSortingInfo(){let e=t.Utilities.getPersistentData(this.__columnSortingKey);null==e&&(e="[]"),this.__columnSortings=JSON.parse(e)}__rowMouseEnter(){return function(e){let t=$(this).find(".tchmi-datatable-cell");for(let e=0;e<t.length;++e)t.addClass("tchmi-datatable-row-hover-cell")}}__rowMouseLeave(){return function(){let e=$(this).find(".tchmi-datatable-cell");for(let t=0;t<e.length;++t)e.removeClass("tchmi-datatable-row-hover-cell")}}__cellClicked(e,t){let s=this;return function(){s.addEventListener(this,"focusout",()=>{s.removeEventListeners(`EditableFocus_${t}`);const i=s.__paramReconfigureList.find(t=>t.moduleItem===e);if(void 0===i)s.__paramReconfigureList.push({moduleItem:e,symbols:[{paramSymbol:t,value:this.value}]});else{const e=i.symbols.find(e=>e.paramSymbol===t);void 0===e?i.symbols.push({paramSymbol:t,value:this.value}):e.value=this.value}},!1,`EditableFocus_${t}`)}}__cellKeyPressed(){return function(e){"Enter"==e.code&&$(this).blur()}}__cellMouseEnter(){return function(){$(this.parentElement).addClass("tchmi-datatable-cell-hover")}}__cellMouseLeave(){return function(){$(this.parentElement).removeClass("tchmi-datatable-cell-hover")}}__changeParametersClicked(){let e=this;return()=>{e.__toggleChangeParameters()}}__toggleChangeParameters(){this.__parametersChanging=!this.__parametersChanging,this.__parametersChanging?this.__elSaveButton.css("visibility","visible"):this.__elSaveButton.css("visibility","hidden"),this.__processTable(!0)}__closeChangeParameters(){this.__parametersChanging=!1,this.__elSaveButton.css("visibility","hidden"),this.__processTable(!0)}__saveButtonClicked(){let s=this;return function(){return __awaiter(this,void 0,void 0,(function*(){const i=e=>new Promise(t=>setTimeout(t,e));let l=!1,a=!1;for(let r of s.__paramReconfigureList){let o=0,n=0;for(let i of r.symbols)if(t.Utilities.isSymbol(i.paramSymbol)){let _=i.paramSymbol.substring(3,i.paramSymbol.length-4);e.Symbol.write(_,e.SymbolType.Server,i.value,i=>{if(n++,i.error!==e.Errors.NONE&&(a=!0,s.Log('Could not write symbol "'+_+'". '+i.details.reason)),n==o){if(t.Utilities.isSymbol(r.moduleItem.reconfigureSymbol)){let t=r.moduleItem.reconfigureSymbol;t=t.substring(3,t.length-4),e.Symbol.write(t,e.SymbolType.Server,!0,i=>{i.error!==e.Errors.NONE&&(a=!0,s.Log('Could not write symbol "'+t+'".'))})}else l=!0,s.Log('Could not trigger reconfigure of module "'+r.moduleItem.name+'". The symbol might not be mapped or is in wrong format: "'+r.moduleItem.reconfigureSymbol+'".');if(s.__paramReconfigureList[s.__paramReconfigureList.length-1]==r){let e;e=l?s.__notAllMappedAlias:a?s.__errorParametersAlias:s.__successParametersAlias,s.__createPopup(e),s.__elSaveButton.css("visibility","hidden"),s.__closeChangeParameters()}}}),o++}else l=!0,s.Log('Could not write symbol "'+i.paramSymbol+'" because it is not a valid symbol.');yield i(100)}}))}}__resetColumnSizeClicked(){let e=this;return()=>{e.__columnWidth=[];const s=this.__parent instanceof t.LayoutManager?this.__parent.layoutIDWithoutDisplayMode:null;t.Utilities.setPersistentData(e.__columnWidthkey,"",s),e.__processTable(!0)}}__onSubheaderCellClicked(e,s){let i=this;return function(l){if(l.srcElement.classList.contains("tchmi-datatable-header-separator"))return;let a=$(this.getElementsByClassName("tchmi-datatable-sorting-icon")[0]),r=i.__columnSortings.find(e=>e.rowIdx===s);if(void 0===r&&(r={clmIdx:e,rowIdx:s,type:t.SortingType.NONE},i.__columnSortings.push(r)),e!==r.clmIdx){r.clmIdx=e,r.type=t.SortingType.ASC;let l=$(i.__elTableRow[s]).find(".tchmi-datatable-cell");$(l).find(".tchmi-datatable-sorting-icon").removeClass(["tchmi-datatable-sorting-icon-asc","tchmi-datatable-sorting-icon-desc"]),a.addClass("tchmi-datatable-sorting-icon-asc")}else switch(r.type){case t.SortingType.NONE:r.type=t.SortingType.DESC,a.addClass("tchmi-datatable-sorting-icon-desc");break;case t.SortingType.DESC:r.type=t.SortingType.ASC,a.removeClass("tchmi-datatable-sorting-icon-desc"),a.addClass("tchmi-datatable-sorting-icon-asc");break;case t.SortingType.ASC:r.type=t.SortingType.NONE,a.removeClass("tchmi-datatable-sorting-icon-asc")}i.__saveSortingInfo(),i.__processTable()}}__clmSepMouseOrTouchDown(e){let s=this;return function(i){s.__columnDragging=!0,s.__dragStartPos=t.Utilities.getPosition(s.__elementTemplateRoot[0],i),s.__dragColumnIdx=e}}__mouseTouchMove(){let e=this;return function(s){if(e.__columnDragging){let i=t.Utilities.getPosition(e.__elementTemplateRoot[0],s);e.__move(i)}}}__move(e){let t=this.__dragStartPos.distanceTo(e).x,s=100/this.__tableWidth*t,i=this.__elColumnSeparator[this.__dragColumnIdx],l=i.parentElement,a=i.parentElement.nextSibling,r=.2*(100/(this.__elColumnSeparator.length+1)),o=this.__columnWidth[this.__dragColumnIdx],n=this.__columnWidth[this.__dragColumnIdx+1];n-s<r?s=n-r:o+s<r&&(s=r-o),l.style.width=this.__columnWidth[this.__dragColumnIdx]+s+"%",a.style.width=this.__columnWidth[this.__dragColumnIdx+1]-s+"%"}__mouseOrTouchUp(){let e=this;return function(s){if(e.__columnDragging){e.__columnDragging=!1;let s=e.__elColumnSeparator[e.__dragColumnIdx],i=s.parentElement,l=s.parentElement.nextSibling;e.__columnWidth[e.__dragColumnIdx]=parseFloat(i.style.width),e.__columnWidth[e.__dragColumnIdx+1]=parseFloat(l.style.width);const a=e.__parent instanceof t.LayoutManager?e.__parent.layoutIDWithoutDisplayMode:null;t.Utilities.setPersistentData(e.__columnWidthkey,""+e.__columnWidth,a),e.__elTableCellHeaderText.css("font-size",e.__fontsizeHeader+"px"),e.__elTableCellValueText.css("font-size",e.__fontsizeItem+"px"),e.__processTable()}}}}t.DataTable=s;class i extends Array{constructor(e,t){super(),this._name=e,this._reconfigureSymbol=t}get name(){return this._name}get reconfigureSymbol(){return this._reconfigureSymbol}}t.TableItem=i;class l{constructor(e){this._value=e}get value(){return this._value}}t.TableCell=l;class a extends l{constructor(e,t,s,i,l){super(s),this._dataTableItemIdx=e,this._name=t,this._editable=i,this._symbol=l}get dataTableItemIdx(){return this._dataTableItemIdx}get name(){return this._name}get editable(){return this._editable}get symbol(){return this._symbol}}t.TableCellValue=a}(s=t.Analytics||(t.Analytics={})),t.registerEx("DataTable","TcHmi.Controls.Analytics",s.DataTable)}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));